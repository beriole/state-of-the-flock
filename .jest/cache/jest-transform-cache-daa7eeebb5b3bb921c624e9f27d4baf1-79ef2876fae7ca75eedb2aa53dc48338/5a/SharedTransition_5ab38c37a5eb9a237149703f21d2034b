3522bb479f37452c4d406a8cfd219e91
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SharedTransition = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _animation = require("../../animation");
var _commonTypes = require("../animationBuilder/commonTypes");
var _commonTypes2 = require("../../commonTypes");
var _ProgressTransitionManager = require("./ProgressTransitionManager");
var _UpdateLayoutAnimations = require("../../UpdateLayoutAnimations");
var _util = require("../../animation/util");
var SUPPORTED_PROPS = ['width', 'height', 'originX', 'originY', 'transform', 'borderRadius', 'borderTopLeftRadius', 'borderTopRightRadius', 'borderBottomLeftRadius', 'borderBottomRightRadius'];
var SharedTransition = exports.SharedTransition = function () {
  function SharedTransition() {
    (0, _classCallCheck2.default)(this, SharedTransition);
    this._customAnimationFactory = null;
    this._animation = null;
    this._transitionDuration = 500;
    this._reduceMotion = _commonTypes2.ReduceMotion.System;
    this._customProgressAnimation = undefined;
    this._progressAnimation = undefined;
    this._defaultTransitionType = undefined;
  }
  return (0, _createClass2.default)(SharedTransition, [{
    key: "custom",
    value: function custom(customAnimationFactory) {
      this._customAnimationFactory = customAnimationFactory;
      return this;
    }
  }, {
    key: "progressAnimation",
    value: function progressAnimation(progressAnimationCallback) {
      this._customProgressAnimation = function (viewTag, values, progress) {
        'worklet';

        var newStyles = progressAnimationCallback(values, progress);
        global._notifyAboutProgress(viewTag, newStyles, true);
      };
      return this;
    }
  }, {
    key: "duration",
    value: function duration(_duration) {
      this._transitionDuration = _duration;
      return this;
    }
  }, {
    key: "reduceMotion",
    value: function reduceMotion(_reduceMotion) {
      this._reduceMotion = _reduceMotion;
      return this;
    }
  }, {
    key: "defaultTransitionType",
    value: function defaultTransitionType(transitionType) {
      this._defaultTransitionType = transitionType;
      return this;
    }
  }, {
    key: "registerTransition",
    value: function registerTransition(viewTag, sharedTransitionTag) {
      var isUnmounting = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      if ((0, _util.getReduceMotionFromConfig)(this.getReduceMotion())) {
        return;
      }
      var transitionAnimation = this.getTransitionAnimation();
      var progressAnimation = this.getProgressAnimation();
      if (!this._defaultTransitionType) {
        if (this._customAnimationFactory && !this._customProgressAnimation) {
          this._defaultTransitionType = _commonTypes.SharedTransitionType.ANIMATION;
        } else {
          this._defaultTransitionType = _commonTypes.SharedTransitionType.PROGRESS_ANIMATION;
        }
      }
      var layoutAnimationType = this._defaultTransitionType === _commonTypes.SharedTransitionType.ANIMATION ? _commonTypes.LayoutAnimationType.SHARED_ELEMENT_TRANSITION : _commonTypes.LayoutAnimationType.SHARED_ELEMENT_TRANSITION_PROGRESS;
      (0, _UpdateLayoutAnimations.updateLayoutAnimations)(viewTag, layoutAnimationType, transitionAnimation, sharedTransitionTag, isUnmounting);
      SharedTransition._progressTransitionManager.addProgressAnimation(viewTag, progressAnimation);
    }
  }, {
    key: "unregisterTransition",
    value: function unregisterTransition(viewTag) {
      var isUnmounting = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var layoutAnimationType = this._defaultTransitionType === _commonTypes.SharedTransitionType.ANIMATION ? _commonTypes.LayoutAnimationType.SHARED_ELEMENT_TRANSITION : _commonTypes.LayoutAnimationType.SHARED_ELEMENT_TRANSITION_PROGRESS;
      (0, _UpdateLayoutAnimations.updateLayoutAnimations)(viewTag, layoutAnimationType, undefined, undefined, isUnmounting);
      SharedTransition._progressTransitionManager.removeProgressAnimation(viewTag, isUnmounting);
    }
  }, {
    key: "getReduceMotion",
    value: function getReduceMotion() {
      return this._reduceMotion;
    }
  }, {
    key: "getTransitionAnimation",
    value: function getTransitionAnimation() {
      if (!this._animation) {
        this.buildAnimation();
      }
      return this._animation;
    }
  }, {
    key: "getProgressAnimation",
    value: function getProgressAnimation() {
      if (!this._progressAnimation) {
        this.buildProgressAnimation();
      }
      return this._progressAnimation;
    }
  }, {
    key: "buildAnimation",
    value: function buildAnimation() {
      var animationFactory = this._customAnimationFactory;
      var transitionDuration = this._transitionDuration;
      var reduceMotion = this._reduceMotion;
      this._animation = function (values) {
        'worklet';

        var animations = {};
        var initialValues = {};
        if (animationFactory) {
          animations = animationFactory(values);
          for (var key in animations) {
            if (!SUPPORTED_PROPS.includes(key)) {
              throw new Error(`[Reanimated] The prop '${key}' is not supported yet.`);
            }
          }
        } else {
          for (var propName of SUPPORTED_PROPS) {
            if (propName === 'transform') {
              var matrix = values.targetTransformMatrix;
              animations.transformMatrix = (0, _animation.withTiming)(matrix, {
                reduceMotion: reduceMotion,
                duration: transitionDuration
              });
            } else {
              var capitalizedPropName = `${propName.charAt(0).toUpperCase()}${propName.slice(1)}`;
              var keyToTargetValue = `target${capitalizedPropName}`;
              animations[propName] = (0, _animation.withTiming)(values[keyToTargetValue], {
                reduceMotion: reduceMotion,
                duration: transitionDuration
              });
            }
          }
        }
        for (var _propName in animations) {
          if (_propName === 'transform') {
            initialValues.transformMatrix = values.currentTransformMatrix;
          } else {
            var _capitalizedPropName = _propName.charAt(0).toUpperCase() + _propName.slice(1);
            var keyToCurrentValue = `current${_capitalizedPropName}`;
            initialValues[_propName] = values[keyToCurrentValue];
          }
        }
        return {
          initialValues: initialValues,
          animations: animations
        };
      };
    }
  }, {
    key: "buildProgressAnimation",
    value: function buildProgressAnimation() {
      if (this._customProgressAnimation) {
        this._progressAnimation = this._customProgressAnimation;
        return;
      }
      this._progressAnimation = function (viewTag, values, progress) {
        'worklet';

        var newStyles = {};
        for (var propertyName of SUPPORTED_PROPS) {
          if (propertyName === 'transform') {
            var currentMatrix = values.currentTransformMatrix;
            var targetMatrix = values.targetTransformMatrix;
            var newMatrix = new Array(9);
            for (var i = 0; i < 9; i++) {
              newMatrix[i] = progress * (targetMatrix[i] - currentMatrix[i]) + currentMatrix[i];
            }
            newStyles.transformMatrix = newMatrix;
          } else {
            var PropertyName = propertyName.charAt(0).toUpperCase() + propertyName.slice(1);
            var currentPropertyName = `current${PropertyName}`;
            var targetPropertyName = `target${PropertyName}`;
            var currentValue = values[currentPropertyName];
            var targetValue = values[targetPropertyName];
            newStyles[propertyName] = progress * (targetValue - currentValue) + currentValue;
          }
        }
        global._notifyAboutProgress(viewTag, newStyles, true);
      };
    }
  }], [{
    key: "custom",
    value: function custom(customAnimationFactory) {
      return new SharedTransition().custom(customAnimationFactory);
    }
  }, {
    key: "duration",
    value: function duration(_duration2) {
      return new SharedTransition().duration(_duration2);
    }
  }, {
    key: "progressAnimation",
    value: function progressAnimation(progressAnimationCallback) {
      return new SharedTransition().progressAnimation(progressAnimationCallback);
    }
  }, {
    key: "defaultTransitionType",
    value: function defaultTransitionType(transitionType) {
      return new SharedTransition().defaultTransitionType(transitionType);
    }
  }, {
    key: "reduceMotion",
    value: function reduceMotion(_reduceMotion2) {
      return new SharedTransition().reduceMotion(_reduceMotion2);
    }
  }]);
}();
SharedTransition._progressTransitionManager = new _ProgressTransitionManager.ProgressTransitionManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiU2hhcmVkVHJhbnNpdGlvbiIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX2FuaW1hdGlvbiIsIl9jb21tb25UeXBlcyIsIl9jb21tb25UeXBlczIiLCJfUHJvZ3Jlc3NUcmFuc2l0aW9uTWFuYWdlciIsIl9VcGRhdGVMYXlvdXRBbmltYXRpb25zIiwiX3V0aWwiLCJTVVBQT1JURURfUFJPUFMiLCJkZWZhdWx0IiwiX2N1c3RvbUFuaW1hdGlvbkZhY3RvcnkiLCJfdHJhbnNpdGlvbkR1cmF0aW9uIiwiX3JlZHVjZU1vdGlvbiIsIlJlZHVjZU1vdGlvbiIsIlN5c3RlbSIsIl9jdXN0b21Qcm9ncmVzc0FuaW1hdGlvbiIsInVuZGVmaW5lZCIsIl9wcm9ncmVzc0FuaW1hdGlvbiIsIl9kZWZhdWx0VHJhbnNpdGlvblR5cGUiLCJrZXkiLCJjdXN0b20iLCJjdXN0b21BbmltYXRpb25GYWN0b3J5IiwicHJvZ3Jlc3NBbmltYXRpb24iLCJwcm9ncmVzc0FuaW1hdGlvbkNhbGxiYWNrIiwidmlld1RhZyIsInZhbHVlcyIsInByb2dyZXNzIiwibmV3U3R5bGVzIiwiZ2xvYmFsIiwiX25vdGlmeUFib3V0UHJvZ3Jlc3MiLCJkdXJhdGlvbiIsInJlZHVjZU1vdGlvbiIsImRlZmF1bHRUcmFuc2l0aW9uVHlwZSIsInRyYW5zaXRpb25UeXBlIiwicmVnaXN0ZXJUcmFuc2l0aW9uIiwic2hhcmVkVHJhbnNpdGlvblRhZyIsImlzVW5tb3VudGluZyIsImFyZ3VtZW50cyIsImxlbmd0aCIsImdldFJlZHVjZU1vdGlvbkZyb21Db25maWciLCJnZXRSZWR1Y2VNb3Rpb24iLCJ0cmFuc2l0aW9uQW5pbWF0aW9uIiwiZ2V0VHJhbnNpdGlvbkFuaW1hdGlvbiIsImdldFByb2dyZXNzQW5pbWF0aW9uIiwiU2hhcmVkVHJhbnNpdGlvblR5cGUiLCJBTklNQVRJT04iLCJQUk9HUkVTU19BTklNQVRJT04iLCJsYXlvdXRBbmltYXRpb25UeXBlIiwiTGF5b3V0QW5pbWF0aW9uVHlwZSIsIlNIQVJFRF9FTEVNRU5UX1RSQU5TSVRJT04iLCJTSEFSRURfRUxFTUVOVF9UUkFOU0lUSU9OX1BST0dSRVNTIiwidXBkYXRlTGF5b3V0QW5pbWF0aW9ucyIsIl9wcm9ncmVzc1RyYW5zaXRpb25NYW5hZ2VyIiwiYWRkUHJvZ3Jlc3NBbmltYXRpb24iLCJ1bnJlZ2lzdGVyVHJhbnNpdGlvbiIsInJlbW92ZVByb2dyZXNzQW5pbWF0aW9uIiwiYnVpbGRBbmltYXRpb24iLCJidWlsZFByb2dyZXNzQW5pbWF0aW9uIiwiYW5pbWF0aW9uRmFjdG9yeSIsInRyYW5zaXRpb25EdXJhdGlvbiIsImFuaW1hdGlvbnMiLCJpbml0aWFsVmFsdWVzIiwiaW5jbHVkZXMiLCJFcnJvciIsInByb3BOYW1lIiwibWF0cml4IiwidGFyZ2V0VHJhbnNmb3JtTWF0cml4IiwidHJhbnNmb3JtTWF0cml4Iiwid2l0aFRpbWluZyIsImNhcGl0YWxpemVkUHJvcE5hbWUiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwia2V5VG9UYXJnZXRWYWx1ZSIsImN1cnJlbnRUcmFuc2Zvcm1NYXRyaXgiLCJrZXlUb0N1cnJlbnRWYWx1ZSIsInByb3BlcnR5TmFtZSIsImN1cnJlbnRNYXRyaXgiLCJ0YXJnZXRNYXRyaXgiLCJuZXdNYXRyaXgiLCJBcnJheSIsImkiLCJQcm9wZXJ0eU5hbWUiLCJjdXJyZW50UHJvcGVydHlOYW1lIiwidGFyZ2V0UHJvcGVydHlOYW1lIiwiY3VycmVudFZhbHVlIiwidGFyZ2V0VmFsdWUiLCJQcm9ncmVzc1RyYW5zaXRpb25NYW5hZ2VyIl0sInNvdXJjZXMiOlsiU2hhcmVkVHJhbnNpdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgeyB3aXRoVGltaW5nIH0gZnJvbSAnLi4vLi4vYW5pbWF0aW9uJztcbmltcG9ydCB0eXBlIHtcbiAgU2hhcmVkVHJhbnNpdGlvbkFuaW1hdGlvbnNGdW5jdGlvbixcbiAgU2hhcmVkVHJhbnNpdGlvbkFuaW1hdGlvbnNWYWx1ZXMsXG4gIEN1c3RvbVByb2dyZXNzQW5pbWF0aW9uLFxuICBQcm9ncmVzc0FuaW1hdGlvbixcbiAgTGF5b3V0QW5pbWF0aW9uc09wdGlvbnMsXG59IGZyb20gJy4uL2FuaW1hdGlvbkJ1aWxkZXIvY29tbW9uVHlwZXMnO1xuaW1wb3J0IHtcbiAgTGF5b3V0QW5pbWF0aW9uVHlwZSxcbiAgU2hhcmVkVHJhbnNpdGlvblR5cGUsXG59IGZyb20gJy4uL2FuaW1hdGlvbkJ1aWxkZXIvY29tbW9uVHlwZXMnO1xuaW1wb3J0IHR5cGUgeyBTdHlsZVByb3BzIH0gZnJvbSAnLi4vLi4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgUmVkdWNlTW90aW9uIH0gZnJvbSAnLi4vLi4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgUHJvZ3Jlc3NUcmFuc2l0aW9uTWFuYWdlciB9IGZyb20gJy4vUHJvZ3Jlc3NUcmFuc2l0aW9uTWFuYWdlcic7XG5pbXBvcnQgeyB1cGRhdGVMYXlvdXRBbmltYXRpb25zIH0gZnJvbSAnLi4vLi4vVXBkYXRlTGF5b3V0QW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBnZXRSZWR1Y2VNb3Rpb25Gcm9tQ29uZmlnIH0gZnJvbSAnLi4vLi4vYW5pbWF0aW9uL3V0aWwnO1xuXG5jb25zdCBTVVBQT1JURURfUFJPUFMgPSBbXG4gICd3aWR0aCcsXG4gICdoZWlnaHQnLFxuICAnb3JpZ2luWCcsXG4gICdvcmlnaW5ZJyxcbiAgJ3RyYW5zZm9ybScsXG4gICdib3JkZXJSYWRpdXMnLFxuICAnYm9yZGVyVG9wTGVmdFJhZGl1cycsXG4gICdib3JkZXJUb3BSaWdodFJhZGl1cycsXG4gICdib3JkZXJCb3R0b21MZWZ0UmFkaXVzJyxcbiAgJ2JvcmRlckJvdHRvbVJpZ2h0UmFkaXVzJyxcbl0gYXMgY29uc3Q7XG5cbnR5cGUgQW5pbWF0aW9uRmFjdG9yeSA9IChcbiAgdmFsdWVzOiBTaGFyZWRUcmFuc2l0aW9uQW5pbWF0aW9uc1ZhbHVlc1xuKSA9PiBTdHlsZVByb3BzO1xuXG4vKipcbiAqIEEgU2hhcmVkVHJhbnNpdGlvbiBidWlsZGVyIGNsYXNzLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9zaGFyZWQtZWxlbWVudC10cmFuc2l0aW9ucy9vdmVydmlld1xuICogQGV4cGVyaW1lbnRhbFxuICovXG5leHBvcnQgY2xhc3MgU2hhcmVkVHJhbnNpdGlvbiB7XG4gIHByaXZhdGUgX2N1c3RvbUFuaW1hdGlvbkZhY3Rvcnk6IEFuaW1hdGlvbkZhY3RvcnkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBfYW5pbWF0aW9uOiBTaGFyZWRUcmFuc2l0aW9uQW5pbWF0aW9uc0Z1bmN0aW9uIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgX3RyYW5zaXRpb25EdXJhdGlvbiA9IDUwMDtcbiAgcHJpdmF0ZSBfcmVkdWNlTW90aW9uOiBSZWR1Y2VNb3Rpb24gPSBSZWR1Y2VNb3Rpb24uU3lzdGVtO1xuICBwcml2YXRlIF9jdXN0b21Qcm9ncmVzc0FuaW1hdGlvbj86IFByb2dyZXNzQW5pbWF0aW9uID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIF9wcm9ncmVzc0FuaW1hdGlvbj86IFByb2dyZXNzQW5pbWF0aW9uID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIF9kZWZhdWx0VHJhbnNpdGlvblR5cGU/OiBTaGFyZWRUcmFuc2l0aW9uVHlwZSA9IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzdGF0aWMgX3Byb2dyZXNzVHJhbnNpdGlvbk1hbmFnZXIgPSBuZXcgUHJvZ3Jlc3NUcmFuc2l0aW9uTWFuYWdlcigpO1xuXG4gIHB1YmxpYyBjdXN0b20oY3VzdG9tQW5pbWF0aW9uRmFjdG9yeTogQW5pbWF0aW9uRmFjdG9yeSk6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHRoaXMuX2N1c3RvbUFuaW1hdGlvbkZhY3RvcnkgPSBjdXN0b21BbmltYXRpb25GYWN0b3J5O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHVibGljIHByb2dyZXNzQW5pbWF0aW9uKFxuICAgIHByb2dyZXNzQW5pbWF0aW9uQ2FsbGJhY2s6IEN1c3RvbVByb2dyZXNzQW5pbWF0aW9uXG4gICk6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHRoaXMuX2N1c3RvbVByb2dyZXNzQW5pbWF0aW9uID0gKHZpZXdUYWcsIHZhbHVlcywgcHJvZ3Jlc3MpID0+IHtcbiAgICAgICd3b3JrbGV0JztcbiAgICAgIGNvbnN0IG5ld1N0eWxlcyA9IHByb2dyZXNzQW5pbWF0aW9uQ2FsbGJhY2sodmFsdWVzLCBwcm9ncmVzcyk7XG4gICAgICBnbG9iYWwuX25vdGlmeUFib3V0UHJvZ3Jlc3Modmlld1RhZywgbmV3U3R5bGVzLCB0cnVlKTtcbiAgICB9O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHVibGljIGR1cmF0aW9uKGR1cmF0aW9uOiBudW1iZXIpOiBTaGFyZWRUcmFuc2l0aW9uIHtcbiAgICB0aGlzLl90cmFuc2l0aW9uRHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyByZWR1Y2VNb3Rpb24oX3JlZHVjZU1vdGlvbjogUmVkdWNlTW90aW9uKTogdGhpcyB7XG4gICAgdGhpcy5fcmVkdWNlTW90aW9uID0gX3JlZHVjZU1vdGlvbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyBkZWZhdWx0VHJhbnNpdGlvblR5cGUoXG4gICAgdHJhbnNpdGlvblR5cGU6IFNoYXJlZFRyYW5zaXRpb25UeXBlXG4gICk6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHRoaXMuX2RlZmF1bHRUcmFuc2l0aW9uVHlwZSA9IHRyYW5zaXRpb25UeXBlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHVibGljIHJlZ2lzdGVyVHJhbnNpdGlvbihcbiAgICB2aWV3VGFnOiBudW1iZXIsXG4gICAgc2hhcmVkVHJhbnNpdGlvblRhZzogc3RyaW5nLFxuICAgIGlzVW5tb3VudGluZyA9IGZhbHNlXG4gICkge1xuICAgIGlmIChnZXRSZWR1Y2VNb3Rpb25Gcm9tQ29uZmlnKHRoaXMuZ2V0UmVkdWNlTW90aW9uKCkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdHJhbnNpdGlvbkFuaW1hdGlvbiA9IHRoaXMuZ2V0VHJhbnNpdGlvbkFuaW1hdGlvbigpO1xuICAgIGNvbnN0IHByb2dyZXNzQW5pbWF0aW9uID0gdGhpcy5nZXRQcm9ncmVzc0FuaW1hdGlvbigpO1xuICAgIGlmICghdGhpcy5fZGVmYXVsdFRyYW5zaXRpb25UeXBlKSB7XG4gICAgICBpZiAodGhpcy5fY3VzdG9tQW5pbWF0aW9uRmFjdG9yeSAmJiAhdGhpcy5fY3VzdG9tUHJvZ3Jlc3NBbmltYXRpb24pIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdFRyYW5zaXRpb25UeXBlID0gU2hhcmVkVHJhbnNpdGlvblR5cGUuQU5JTUFUSU9OO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdFRyYW5zaXRpb25UeXBlID0gU2hhcmVkVHJhbnNpdGlvblR5cGUuUFJPR1JFU1NfQU5JTUFUSU9OO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBsYXlvdXRBbmltYXRpb25UeXBlID1cbiAgICAgIHRoaXMuX2RlZmF1bHRUcmFuc2l0aW9uVHlwZSA9PT0gU2hhcmVkVHJhbnNpdGlvblR5cGUuQU5JTUFUSU9OXG4gICAgICAgID8gTGF5b3V0QW5pbWF0aW9uVHlwZS5TSEFSRURfRUxFTUVOVF9UUkFOU0lUSU9OXG4gICAgICAgIDogTGF5b3V0QW5pbWF0aW9uVHlwZS5TSEFSRURfRUxFTUVOVF9UUkFOU0lUSU9OX1BST0dSRVNTO1xuICAgIHVwZGF0ZUxheW91dEFuaW1hdGlvbnMoXG4gICAgICB2aWV3VGFnLFxuICAgICAgbGF5b3V0QW5pbWF0aW9uVHlwZSxcbiAgICAgIHRyYW5zaXRpb25BbmltYXRpb24sXG4gICAgICBzaGFyZWRUcmFuc2l0aW9uVGFnLFxuICAgICAgaXNVbm1vdW50aW5nXG4gICAgKTtcbiAgICBTaGFyZWRUcmFuc2l0aW9uLl9wcm9ncmVzc1RyYW5zaXRpb25NYW5hZ2VyLmFkZFByb2dyZXNzQW5pbWF0aW9uKFxuICAgICAgdmlld1RhZyxcbiAgICAgIHByb2dyZXNzQW5pbWF0aW9uXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB1bnJlZ2lzdGVyVHJhbnNpdGlvbih2aWV3VGFnOiBudW1iZXIsIGlzVW5tb3VudGluZyA9IGZhbHNlKTogdm9pZCB7XG4gICAgY29uc3QgbGF5b3V0QW5pbWF0aW9uVHlwZSA9XG4gICAgICB0aGlzLl9kZWZhdWx0VHJhbnNpdGlvblR5cGUgPT09IFNoYXJlZFRyYW5zaXRpb25UeXBlLkFOSU1BVElPTlxuICAgICAgICA/IExheW91dEFuaW1hdGlvblR5cGUuU0hBUkVEX0VMRU1FTlRfVFJBTlNJVElPTlxuICAgICAgICA6IExheW91dEFuaW1hdGlvblR5cGUuU0hBUkVEX0VMRU1FTlRfVFJBTlNJVElPTl9QUk9HUkVTUztcbiAgICB1cGRhdGVMYXlvdXRBbmltYXRpb25zKFxuICAgICAgdmlld1RhZyxcbiAgICAgIGxheW91dEFuaW1hdGlvblR5cGUsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICBpc1VubW91bnRpbmdcbiAgICApO1xuICAgIFNoYXJlZFRyYW5zaXRpb24uX3Byb2dyZXNzVHJhbnNpdGlvbk1hbmFnZXIucmVtb3ZlUHJvZ3Jlc3NBbmltYXRpb24oXG4gICAgICB2aWV3VGFnLFxuICAgICAgaXNVbm1vdW50aW5nXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWR1Y2VNb3Rpb24oKTogUmVkdWNlTW90aW9uIHtcbiAgICByZXR1cm4gdGhpcy5fcmVkdWNlTW90aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUcmFuc2l0aW9uQW5pbWF0aW9uKCk6IFNoYXJlZFRyYW5zaXRpb25BbmltYXRpb25zRnVuY3Rpb24ge1xuICAgIGlmICghdGhpcy5fYW5pbWF0aW9uKSB7XG4gICAgICB0aGlzLmJ1aWxkQW5pbWF0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9hbmltYXRpb24hO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQcm9ncmVzc0FuaW1hdGlvbigpOiBQcm9ncmVzc0FuaW1hdGlvbiB7XG4gICAgaWYgKCF0aGlzLl9wcm9ncmVzc0FuaW1hdGlvbikge1xuICAgICAgdGhpcy5idWlsZFByb2dyZXNzQW5pbWF0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wcm9ncmVzc0FuaW1hdGlvbiE7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkQW5pbWF0aW9uKCkge1xuICAgIGNvbnN0IGFuaW1hdGlvbkZhY3RvcnkgPSB0aGlzLl9jdXN0b21BbmltYXRpb25GYWN0b3J5O1xuICAgIGNvbnN0IHRyYW5zaXRpb25EdXJhdGlvbiA9IHRoaXMuX3RyYW5zaXRpb25EdXJhdGlvbjtcbiAgICBjb25zdCByZWR1Y2VNb3Rpb24gPSB0aGlzLl9yZWR1Y2VNb3Rpb247XG4gICAgdGhpcy5fYW5pbWF0aW9uID0gKHZhbHVlczogU2hhcmVkVHJhbnNpdGlvbkFuaW1hdGlvbnNWYWx1ZXMpID0+IHtcbiAgICAgICd3b3JrbGV0JztcbiAgICAgIGxldCBhbmltYXRpb25zOiB7XG4gICAgICAgIFtrZXk6IHN0cmluZ106IHVua25vd247XG4gICAgICB9ID0ge307XG4gICAgICBjb25zdCBpbml0aWFsVmFsdWVzOiB7XG4gICAgICAgIFtrZXk6IHN0cmluZ106IHVua25vd247XG4gICAgICB9ID0ge307XG5cbiAgICAgIGlmIChhbmltYXRpb25GYWN0b3J5KSB7XG4gICAgICAgIGFuaW1hdGlvbnMgPSBhbmltYXRpb25GYWN0b3J5KHZhbHVlcyk7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGFuaW1hdGlvbnMpIHtcbiAgICAgICAgICBpZiAoIShTVVBQT1JURURfUFJPUFMgYXMgcmVhZG9ubHkgc3RyaW5nW10pLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgYFtSZWFuaW1hdGVkXSBUaGUgcHJvcCAnJHtrZXl9JyBpcyBub3Qgc3VwcG9ydGVkIHlldC5gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wTmFtZSBvZiBTVVBQT1JURURfUFJPUFMpIHtcbiAgICAgICAgICBpZiAocHJvcE5hbWUgPT09ICd0cmFuc2Zvcm0nKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRyaXggPSB2YWx1ZXMudGFyZ2V0VHJhbnNmb3JtTWF0cml4O1xuICAgICAgICAgICAgYW5pbWF0aW9ucy50cmFuc2Zvcm1NYXRyaXggPSB3aXRoVGltaW5nKG1hdHJpeCwge1xuICAgICAgICAgICAgICByZWR1Y2VNb3Rpb24sXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiB0cmFuc2l0aW9uRHVyYXRpb24sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2FwaXRhbGl6ZWRQcm9wTmFtZSA9IGAke3Byb3BOYW1lXG4gICAgICAgICAgICAgIC5jaGFyQXQoMClcbiAgICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCl9JHtwcm9wTmFtZS5zbGljZShcbiAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgKX1gIGFzIENhcGl0YWxpemU8TGF5b3V0QW5pbWF0aW9uc09wdGlvbnM+O1xuICAgICAgICAgICAgY29uc3Qga2V5VG9UYXJnZXRWYWx1ZSA9IGB0YXJnZXQke2NhcGl0YWxpemVkUHJvcE5hbWV9YCBhcyBjb25zdDtcbiAgICAgICAgICAgIGFuaW1hdGlvbnNbcHJvcE5hbWVdID0gd2l0aFRpbWluZyh2YWx1ZXNba2V5VG9UYXJnZXRWYWx1ZV0sIHtcbiAgICAgICAgICAgICAgcmVkdWNlTW90aW9uLFxuICAgICAgICAgICAgICBkdXJhdGlvbjogdHJhbnNpdGlvbkR1cmF0aW9uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3QgcHJvcE5hbWUgaW4gYW5pbWF0aW9ucykge1xuICAgICAgICBpZiAocHJvcE5hbWUgPT09ICd0cmFuc2Zvcm0nKSB7XG4gICAgICAgICAgaW5pdGlhbFZhbHVlcy50cmFuc2Zvcm1NYXRyaXggPSB2YWx1ZXMuY3VycmVudFRyYW5zZm9ybU1hdHJpeDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBjYXBpdGFsaXplZFByb3BOYW1lID0gKHByb3BOYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICtcbiAgICAgICAgICAgIHByb3BOYW1lLnNsaWNlKDEpKSBhcyBDYXBpdGFsaXplPExheW91dEFuaW1hdGlvbnNPcHRpb25zPjtcbiAgICAgICAgICBjb25zdCBrZXlUb0N1cnJlbnRWYWx1ZSA9IGBjdXJyZW50JHtjYXBpdGFsaXplZFByb3BOYW1lfWAgYXMgY29uc3Q7XG4gICAgICAgICAgaW5pdGlhbFZhbHVlc1twcm9wTmFtZV0gPSB2YWx1ZXNba2V5VG9DdXJyZW50VmFsdWVdO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGluaXRpYWxWYWx1ZXMsIGFuaW1hdGlvbnMgfTtcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFByb2dyZXNzQW5pbWF0aW9uKCkge1xuICAgIGlmICh0aGlzLl9jdXN0b21Qcm9ncmVzc0FuaW1hdGlvbikge1xuICAgICAgdGhpcy5fcHJvZ3Jlc3NBbmltYXRpb24gPSB0aGlzLl9jdXN0b21Qcm9ncmVzc0FuaW1hdGlvbjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fcHJvZ3Jlc3NBbmltYXRpb24gPSAodmlld1RhZywgdmFsdWVzLCBwcm9ncmVzcykgPT4ge1xuICAgICAgJ3dvcmtsZXQnO1xuICAgICAgY29uc3QgbmV3U3R5bGVzOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB8IG51bWJlcltdIH0gPSB7fTtcbiAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIG9mIFNVUFBPUlRFRF9QUk9QUykge1xuICAgICAgICBpZiAocHJvcGVydHlOYW1lID09PSAndHJhbnNmb3JtJykge1xuICAgICAgICAgIC8vIHRoaXMgaXMgbm90IHRoZSBwZXJmZWN0IHNvbHV0aW9uLCBidXQgYXQgdGhpcyBtb21lbnQgaXQganVzdCBpbnRlcnBvbGF0ZXMgdGhlIHdob2xlXG4gICAgICAgICAgLy8gbWF0cml4IGluc3RlYWQgb2YgaW50ZXJwb2xhdGluZyBzY2FsZSwgdHJhbnNsYXRlLCByb3RhdGUsIGV0Yy4gc2VwYXJhdGVseVxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRNYXRyaXggPSB2YWx1ZXMuY3VycmVudFRyYW5zZm9ybU1hdHJpeDtcbiAgICAgICAgICBjb25zdCB0YXJnZXRNYXRyaXggPSB2YWx1ZXMudGFyZ2V0VHJhbnNmb3JtTWF0cml4O1xuICAgICAgICAgIGNvbnN0IG5ld01hdHJpeCA9IG5ldyBBcnJheSg5KTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykge1xuICAgICAgICAgICAgbmV3TWF0cml4W2ldID1cbiAgICAgICAgICAgICAgcHJvZ3Jlc3MgKiAodGFyZ2V0TWF0cml4W2ldIC0gY3VycmVudE1hdHJpeFtpXSkgK1xuICAgICAgICAgICAgICBjdXJyZW50TWF0cml4W2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBuZXdTdHlsZXMudHJhbnNmb3JtTWF0cml4ID0gbmV3TWF0cml4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFByb3BlcnR5TmFtZSA9PSBwcm9wZXJ0eU5hbWUgd2l0aCBjYXBpdGFsaXplZCBmaXN0IGxldHRlciwgKHdpZHRoIC0+IFdpZHRoKVxuICAgICAgICAgIGNvbnN0IFByb3BlcnR5TmFtZSA9IChwcm9wZXJ0eU5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgK1xuICAgICAgICAgICAgcHJvcGVydHlOYW1lLnNsaWNlKDEpKSBhcyBDYXBpdGFsaXplPExheW91dEFuaW1hdGlvbnNPcHRpb25zPjtcbiAgICAgICAgICBjb25zdCBjdXJyZW50UHJvcGVydHlOYW1lID0gYGN1cnJlbnQke1Byb3BlcnR5TmFtZX1gIGFzIGNvbnN0O1xuICAgICAgICAgIGNvbnN0IHRhcmdldFByb3BlcnR5TmFtZSA9IGB0YXJnZXQke1Byb3BlcnR5TmFtZX1gIGFzIGNvbnN0O1xuXG4gICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gdmFsdWVzW2N1cnJlbnRQcm9wZXJ0eU5hbWVdO1xuICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gdmFsdWVzW3RhcmdldFByb3BlcnR5TmFtZV07XG5cbiAgICAgICAgICBuZXdTdHlsZXNbcHJvcGVydHlOYW1lXSA9XG4gICAgICAgICAgICBwcm9ncmVzcyAqICh0YXJnZXRWYWx1ZSAtIGN1cnJlbnRWYWx1ZSkgKyBjdXJyZW50VmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGdsb2JhbC5fbm90aWZ5QWJvdXRQcm9ncmVzcyh2aWV3VGFnLCBuZXdTdHlsZXMsIHRydWUpO1xuICAgIH07XG4gIH1cblxuICAvLyBzdGF0aWMgYnVpbGRlciBtZXRob2RzIGkuZS4gc2hhcmVkIHRyYW5zaXRpb24gbW9kaWZpZXJzXG5cbiAgLyoqXG4gICAqIExldHMgeW91IGNyZWF0ZSBhIGN1c3RvbSBzaGFyZWQgdHJhbnNpdGlvbiBhbmltYXRpb24uIE90aGVyIHNoYXJlZCB0cmFuc2l0aW9uIG1vZGlmaWVycyBjYW4gYmUgY2hhaW5lZCBhbG9uZ3NpZGUgdGhpcyBtb2RpZmllci5cbiAgICpcbiAgICogQHBhcmFtIGN1c3RvbUFuaW1hdGlvbkZhY3RvcnkgLSBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IGhhdmUgdG8gcmV0dXJuIGFuIG9iamVjdCB3aXRoIHN0eWxlcyBmb3IgdGhlIGN1c3RvbSBzaGFyZWQgdHJhbnNpdGlvbi5cbiAgICogQHJldHVybnMgQSB7QGxpbmsgU2hhcmVkVHJhbnNpdGlvbn0gb2JqZWN0LiBTdHlsZXMgcmV0dXJuZWQgZnJvbSB0aGlzIGZ1bmN0aW9uIG5lZWQgdG8gYmUgdG8gdGhlIGBzaGFyZWRUcmFuc2l0aW9uU3R5bGVgIHByb3AuXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9zaGFyZWQtZWxlbWVudC10cmFuc2l0aW9ucy9vdmVydmlld1xuICAgKiBAZXhwZXJpbWVudGFsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGN1c3RvbShcbiAgICBjdXN0b21BbmltYXRpb25GYWN0b3J5OiBBbmltYXRpb25GYWN0b3J5XG4gICk6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHJldHVybiBuZXcgU2hhcmVkVHJhbnNpdGlvbigpLmN1c3RvbShjdXN0b21BbmltYXRpb25GYWN0b3J5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMZXRzIHlvdSBjaGFuZ2UgdGhlIGR1cmF0aW9uIG9mIHRoZSBzaGFyZWQgdHJhbnNpdGlvbi4gT3RoZXIgc2hhcmVkIHRyYW5zaXRpb24gbW9kaWZpZXJzIGNhbiBiZSBjaGFpbmVkIGFsb25nc2lkZSB0aGlzIG1vZGlmaWVyLlxuICAgKlxuICAgKiBAcGFyYW0gZHVyYXRpb24gLSBUaGUgZHVyYXRpb24gb2YgdGhlIHNoYXJlZCB0cmFuc2l0aW9uIGFuaW1hdGlvbiBpbiBtaWxsaXNlY29uZHMuXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9zaGFyZWQtZWxlbWVudC10cmFuc2l0aW9ucy9vdmVydmlld1xuICAgKiBAZXhwZXJpbWVudGFsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGR1cmF0aW9uKGR1cmF0aW9uOiBudW1iZXIpOiBTaGFyZWRUcmFuc2l0aW9uIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlZFRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogTGV0cyB5b3UgY3JlYXRlIGEgc2hhcmVkIHRyYW5zaXRpb24gYW5pbWF0aW9uIGJvdW5kIHRvIHRoZSBwcm9ncmVzcyBiZXR3ZWVuIG5hdmlnYXRpb24gc2NyZWVucy4gT3RoZXIgc2hhcmVkIHRyYW5zaXRpb24gbW9kaWZpZXJzIGNhbiBiZSBjaGFpbmVkIGFsb25nc2lkZSB0aGlzIG1vZGlmaWVyLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvZ3Jlc3NBbmltYXRpb25DYWxsYmFjayAtIEEgY2FsbGJhY2sgY2FsbGVkIHdpdGggdGhlIGN1cnJlbnQgcHJvZ3Jlc3MgdmFsdWUgb24gZXZlcnkgYW5pbWF0aW9uIGZyYW1lLiBJdCBzaG91bGQgcmV0dXJuIGFuIG9iamVjdCB3aXRoIHN0eWxlcyBmb3IgdGhlIHNoYXJlZCB0cmFuc2l0aW9uLlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5zd21hbnNpb24uY29tL3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkL2RvY3Mvc2hhcmVkLWVsZW1lbnQtdHJhbnNpdGlvbnMvb3ZlcnZpZXdcbiAgICogQGV4cGVyaW1lbnRhbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBwcm9ncmVzc0FuaW1hdGlvbihcbiAgICBwcm9ncmVzc0FuaW1hdGlvbkNhbGxiYWNrOiBDdXN0b21Qcm9ncmVzc0FuaW1hdGlvblxuICApOiBTaGFyZWRUcmFuc2l0aW9uIHtcbiAgICByZXR1cm4gbmV3IFNoYXJlZFRyYW5zaXRpb24oKS5wcm9ncmVzc0FuaW1hdGlvbihwcm9ncmVzc0FuaW1hdGlvbkNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB0cmFuc2l0aW9uIGlzIHByb2dyZXNzLWJvdW5kIG9yIG5vdC4gT3RoZXIgc2hhcmVkIHRyYW5zaXRpb24gbW9kaWZpZXJzIGNhbiBiZSBjaGFpbmVkIGFsb25nc2lkZSB0aGlzIG1vZGlmaWVyLlxuICAgKlxuICAgKiBAcGFyYW0gdHJhbnNpdGlvblR5cGUgLSBUeXBlIG9mIHRoZSB0cmFuc2l0aW9uLiBDb25maWd1cmVkIHdpdGgge0BsaW5rIFNoYXJlZFRyYW5zaXRpb25UeXBlfSBlbnVtLlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5zd21hbnNpb24uY29tL3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkL2RvY3Mvc2hhcmVkLWVsZW1lbnQtdHJhbnNpdGlvbnMvb3ZlcnZpZXdcbiAgICogQGV4cGVyaW1lbnRhbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBkZWZhdWx0VHJhbnNpdGlvblR5cGUoXG4gICAgdHJhbnNpdGlvblR5cGU6IFNoYXJlZFRyYW5zaXRpb25UeXBlXG4gICk6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHJldHVybiBuZXcgU2hhcmVkVHJhbnNpdGlvbigpLmRlZmF1bHRUcmFuc2l0aW9uVHlwZSh0cmFuc2l0aW9uVHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogTGV0cyB5b3UgYWRqdXN0IHRoZSBiZWhhdmlvciB3aGVuIHRoZSBkZXZpY2UncyByZWR1Y2VkIG1vdGlvbiBhY2Nlc3NpYmlsaXR5IHNldHRpbmcgaXMgdHVybmVkIG9uLiBPdGhlciBzaGFyZWQgdHJhbnNpdGlvbiBtb2RpZmllcnMgY2FuIGJlIGNoYWluZWQgYWxvbmdzaWRlIHRoaXMgbW9kaWZpZXIuXG4gICAqXG4gICAqIEBwYXJhbSByZWR1Y2VNb3Rpb24gLSBEZXRlcm1pbmVzIGhvdyB0aGUgYW5pbWF0aW9uIHJlc3BvbmRzIHRvIHRoZSBkZXZpY2UncyByZWR1Y2VkIG1vdGlvbiBhY2Nlc3NpYmlsaXR5IHNldHRpbmcuIERlZmF1bHQgdG8gYFJlZHVjZU1vdGlvbi5TeXN0ZW1gIC0ge0BsaW5rIFJlZHVjZU1vdGlvbn0uXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9zaGFyZWQtZWxlbWVudC10cmFuc2l0aW9ucy9vdmVydmlld1xuICAgKiBAZXhwZXJpbWVudGFsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHJlZHVjZU1vdGlvbihyZWR1Y2VNb3Rpb246IFJlZHVjZU1vdGlvbik6IFNoYXJlZFRyYW5zaXRpb24ge1xuICAgIHJldHVybiBuZXcgU2hhcmVkVHJhbnNpdGlvbigpLnJlZHVjZU1vdGlvbihyZWR1Y2VNb3Rpb24pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUMsSUFBQUEsc0JBQUEsR0FBQUMsT0FBQTtBQUFBQyxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxnQkFBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBTyxhQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFDYixJQUFBUSxVQUFBLEdBQUFSLE9BQUE7QUFRQSxJQUFBUyxZQUFBLEdBQUFULE9BQUE7QUFLQSxJQUFBVSxhQUFBLEdBQUFWLE9BQUE7QUFDQSxJQUFBVywwQkFBQSxHQUFBWCxPQUFBO0FBQ0EsSUFBQVksdUJBQUEsR0FBQVosT0FBQTtBQUNBLElBQUFhLEtBQUEsR0FBQWIsT0FBQTtBQUVBLElBQU1jLGVBQWUsR0FBRyxDQUN0QixPQUFPLEVBQ1AsUUFBUSxFQUNSLFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxFQUNYLGNBQWMsRUFDZCxxQkFBcUIsRUFDckIsc0JBQXNCLEVBQ3RCLHdCQUF3QixFQUN4Qix5QkFBeUIsQ0FDakI7QUFBQyxJQVlFVCxnQkFBZ0IsR0FBQUYsT0FBQSxDQUFBRSxnQkFBQTtFQUFBLFNBQUFBLGlCQUFBO0lBQUEsSUFBQUMsZ0JBQUEsQ0FBQVMsT0FBQSxRQUFBVixnQkFBQTtJQUFBLEtBQ25CVyx1QkFBdUIsR0FBNEIsSUFBSTtJQUFBLEtBQ3ZEUixVQUFVLEdBQThDLElBQUk7SUFBQSxLQUM1RFMsbUJBQW1CLEdBQUcsR0FBRztJQUFBLEtBQ3pCQyxhQUFhLEdBQWlCQywwQkFBWSxDQUFDQyxNQUFNO0lBQUEsS0FDakRD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