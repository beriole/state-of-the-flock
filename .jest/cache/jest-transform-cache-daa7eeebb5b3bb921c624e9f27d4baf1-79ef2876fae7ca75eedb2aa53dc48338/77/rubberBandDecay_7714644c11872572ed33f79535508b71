eff5d6e96988fb31d877980deaa1b3e0
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.rubberBandDecay = rubberBandDecay;
var _utils = require("./utils");
var DERIVATIVE_EPS = 0.1;
function rubberBandDecay(animation, now, config) {
  'worklet';

  var lastTimestamp = animation.lastTimestamp,
    startTimestamp = animation.startTimestamp,
    current = animation.current,
    velocity = animation.velocity;
  var deltaTime = Math.min(now - lastTimestamp, 64);
  var clampIndex = Math.abs(current - config.clamp[0]) < Math.abs(current - config.clamp[1]) ? 0 : 1;
  var derivative = 0;
  if (current < config.clamp[0] || current > config.clamp[1]) {
    derivative = current - config.clamp[clampIndex];
  }
  var v = velocity * Math.exp(-(1 - config.deceleration) * (now - startTimestamp) * _utils.SLOPE_FACTOR) - derivative * config.rubberBandFactor;
  if (Math.abs(derivative) > DERIVATIVE_EPS) {
    animation.springActive = true;
  } else if (animation.springActive) {
    animation.current = config.clamp[clampIndex];
    return true;
  } else if (Math.abs(v) < _utils.VELOCITY_EPS) {
    return true;
  }
  animation.current = current + v * config.velocityFactor * deltaTime / 1000;
  animation.velocity = v;
  animation.lastTimestamp = now;
  return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInJ1YmJlckJhbmREZWNheSIsIl91dGlscyIsInJlcXVpcmUiLCJERVJJVkFUSVZFX0VQUyIsImFuaW1hdGlvbiIsIm5vdyIsImNvbmZpZyIsImxhc3RUaW1lc3RhbXAiLCJzdGFydFRpbWVzdGFtcCIsImN1cnJlbnQiLCJ2ZWxvY2l0eSIsImRlbHRhVGltZSIsIk1hdGgiLCJtaW4iLCJjbGFtcEluZGV4IiwiYWJzIiwiY2xhbXAiLCJkZXJpdmF0aXZlIiwidiIsImV4cCIsImRlY2VsZXJhdGlvbiIsIlNMT1BFX0ZBQ1RPUiIsInJ1YmJlckJhbmRGYWN0b3IiLCJzcHJpbmdBY3RpdmUiLCJWRUxPQ0lUWV9FUFMiLCJ2ZWxvY2l0eUZhY3RvciJdLCJzb3VyY2VzIjpbInJ1YmJlckJhbmREZWNheS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgdHlwZSB7IFJ1YmJlckJhbmREZWNheUNvbmZpZywgSW5uZXJEZWNheUFuaW1hdGlvbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgU0xPUEVfRkFDVE9SLCBWRUxPQ0lUWV9FUFMgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgREVSSVZBVElWRV9FUFMgPSAwLjE7XG5cbmV4cG9ydCBmdW5jdGlvbiBydWJiZXJCYW5kRGVjYXkoXG4gIGFuaW1hdGlvbjogSW5uZXJEZWNheUFuaW1hdGlvbixcbiAgbm93OiBudW1iZXIsXG4gIGNvbmZpZzogUnViYmVyQmFuZERlY2F5Q29uZmlnXG4pOiBib29sZWFuIHtcbiAgJ3dvcmtsZXQnO1xuICBjb25zdCB7IGxhc3RUaW1lc3RhbXAsIHN0YXJ0VGltZXN0YW1wLCBjdXJyZW50LCB2ZWxvY2l0eSB9ID0gYW5pbWF0aW9uO1xuXG4gIGNvbnN0IGRlbHRhVGltZSA9IE1hdGgubWluKG5vdyAtIGxhc3RUaW1lc3RhbXAsIDY0KTtcbiAgY29uc3QgY2xhbXBJbmRleCA9XG4gICAgTWF0aC5hYnMoY3VycmVudCAtIGNvbmZpZy5jbGFtcFswXSkgPCBNYXRoLmFicyhjdXJyZW50IC0gY29uZmlnLmNsYW1wWzFdKVxuICAgICAgPyAwXG4gICAgICA6IDE7XG5cbiAgbGV0IGRlcml2YXRpdmUgPSAwO1xuICBpZiAoY3VycmVudCA8IGNvbmZpZy5jbGFtcFswXSB8fCBjdXJyZW50ID4gY29uZmlnLmNsYW1wWzFdKSB7XG4gICAgZGVyaXZhdGl2ZSA9IGN1cnJlbnQgLSBjb25maWcuY2xhbXBbY2xhbXBJbmRleF07XG4gIH1cblxuICBjb25zdCB2ID1cbiAgICB2ZWxvY2l0eSAqXG4gICAgICBNYXRoLmV4cChcbiAgICAgICAgLSgxIC0gY29uZmlnLmRlY2VsZXJhdGlvbikgKiAobm93IC0gc3RhcnRUaW1lc3RhbXApICogU0xPUEVfRkFDVE9SXG4gICAgICApIC1cbiAgICBkZXJpdmF0aXZlICogY29uZmlnLnJ1YmJlckJhbmRGYWN0b3I7XG5cbiAgaWYgKE1hdGguYWJzKGRlcml2YXRpdmUpID4gREVSSVZBVElWRV9FUFMpIHtcbiAgICBhbmltYXRpb24uc3ByaW5nQWN0aXZlID0gdHJ1ZTtcbiAgfSBlbHNlIGlmIChhbmltYXRpb24uc3ByaW5nQWN0aXZlKSB7XG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPSBjb25maWcuY2xhbXBbY2xhbXBJbmRleF07XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSBpZiAoTWF0aC5hYnModikgPCBWRUxPQ0lUWV9FUFMpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFuaW1hdGlvbi5jdXJyZW50ID0gY3VycmVudCArICh2ICogY29uZmlnLnZlbG9jaXR5RmFjdG9yICogZGVsdGFUaW1lKSAvIDEwMDA7XG4gIGFuaW1hdGlvbi52ZWxvY2l0eSA9IHY7XG4gIGFuaW1hdGlvbi5sYXN0VGltZXN0YW1wID0gbm93O1xuICByZXR1cm4gZmFsc2U7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUFBLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLGVBQUEsR0FBQUEsZUFBQTtBQUVaLElBQUFDLE1BQUEsR0FBQUMsT0FBQTtBQUVBLElBQU1DLGNBQWMsR0FBRyxHQUFHO0FBRW5CLFNBQVNILGVBQWVBLENBQzdCSSxTQUE4QixFQUM5QkMsR0FBVyxFQUNYQyxNQUE2QixFQUNwQjtFQUNULFNBQVM7O0VBQ1QsSUFBUUMsYUFBYSxHQUF3Q0gsU0FBUyxDQUE5REcsYUFBYTtJQUFFQyxjQUFjLEdBQXdCSixTQUFTLENBQS9DSSxjQUFjO0lBQUVDLE9BQU8sR0FBZUwsU0FBUyxDQUEvQkssT0FBTztJQUFFQyxRQUFBLEdBQWFOLFNBQVMsQ0FBdEJNLFFBQUE7RUFFaEQsSUFBTUMsU0FBUyxHQUFHQyxJQUFJLENBQUNDLEdBQUcsQ0FBQ1IsR0FBRyxHQUFHRSxhQUFhLEVBQUUsRUFBRSxDQUFDO0VBQ25ELElBQU1PLFVBQVUsR0FDZEYsSUFBSSxDQUFDRyxHQUFHLENBQUNOLE9BQU8sR0FBR0gsTUFBTSxDQUFDVSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBR0osSUFBSSxDQUFDRyxHQUFHLENBQUNOLE9BQU8sR0FBR0gsTUFBTSxDQUFDVSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FDckUsQ0FBQyxHQUNELENBQUM7RUFFUCxJQUFJQyxVQUFVLEdBQUcsQ0FBQztFQUNsQixJQUFJUixPQUFPLEdBQUdILE1BQU0sQ0FBQ1UsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJUCxPQUFPLEdBQUdILE1BQU0sQ0FBQ1UsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBQzFEQyxVQUFVLEdBQUdSLE9BQU8sR0FBR0gsTUFBTSxDQUFDVSxLQUFLLENBQUNGLFVBQVUsQ0FBQztFQUNqRDtFQUVBLElBQU1JLENBQUMsR0FDTFIsUUFBUSxHQUNORSxJQUFJLENBQUNPLEdBQUcsQ0FDTixFQUFFLENBQUMsR0FBR2IsTUFBTSxDQUFDYyxZQUFZLENBQUMsSUFBSWYsR0FBRyxHQUFHRyxjQUFjLENBQUMsR0FBR2EsbUJBQ3hELENBQUMsR0FDSEosVUFBVSxHQUFHWCxNQUFNLENBQUNnQixnQkFBZ0I7RUFFdEMsSUFBSVYsSUFBSSxDQUFDRyxHQUFHLENBQUNFLFVBQVUsQ0FBQyxHQUFHZCxjQUFjLEVBQUU7SUFDekNDLFNBQVMsQ0FBQ21CLFlBQVksR0FBRyxJQUFJO0VBQy9CLENBQUMsTUFBTSxJQUFJbkIsU0FBUyxDQUFDbUIsWUFBWSxFQUFFO0lBQ2pDbkIsU0FBUyxDQUFDSyxPQUFPLEdBQUdILE1BQU0sQ0FBQ1UsS0FBSyxDQUFDRixVQUFVLENBQUM7SUFDNUMsT0FBTyxJQUFJO0VBQ2IsQ0FBQyxNQUFNLElBQUlGLElBQUksQ0FBQ0csR0FBRyxDQUFDRyxDQUFDLENBQUMsR0FBR00sbUJBQVksRUFBRTtJQUNyQyxPQUFPLElBQUk7RUFDYjtFQUVBcEIsU0FBUyxDQUFDSyxPQUFPLEdBQUdBLE9BQU8sR0FBSVMsQ0FBQyxHQUFHWixNQUFNLENBQUNtQixjQUFjLEdBQUdkLFNBQVMsR0FBSSxJQUFJO0VBQzVFUCxTQUFTLENBQUNNLFFBQVEsR0FBR1EsQ0FBQztFQUN0QmQsU0FBUyxDQUFDRyxhQUFhLEdBQUdGLEdBQUc7RUFDN0IsT0FBTyxLQUFLO0FBQ2QiLCJpZ25vcmVMaXN0IjpbXX0=