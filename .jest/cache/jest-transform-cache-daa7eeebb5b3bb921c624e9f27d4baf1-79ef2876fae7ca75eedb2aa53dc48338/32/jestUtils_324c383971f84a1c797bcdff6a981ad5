179ea11488a010e3839f8f50bc5e1ac8
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withReanimatedTimer = exports.setUpTests = exports.getAnimatedStyle = exports.advanceAnimationByTime = exports.advanceAnimationByFrame = void 0;
var _PlatformChecker = require("./PlatformChecker");
var defaultFramerateConfig = {
  fps: 60
};
var getCurrentStyle = function getCurrentStyle(component) {
  var styleObject = component.props.style;
  var currentStyle = {};
  if (Array.isArray(styleObject)) {
    styleObject.forEach(function (style) {
      currentStyle = Object.assign({}, currentStyle, style);
    });
  } else {
    var _component$props$jest;
    currentStyle = Object.assign({}, styleObject, (_component$props$jest = component.props.jestAnimatedStyle) == null ? void 0 : _component$props$jest.value);
  }
  return currentStyle;
};
var _checkEqual = function checkEqual(current, expected) {
  if (Array.isArray(expected)) {
    if (!Array.isArray(current) || expected.length !== current.length) {
      return false;
    }
    for (var i = 0; i < current.length; i++) {
      if (!_checkEqual(current[i], expected[i])) {
        return false;
      }
    }
  } else if (typeof current === 'object' && current) {
    if (typeof expected !== 'object' || !expected) {
      return false;
    }
    for (var property in expected) {
      if (!_checkEqual(current[property], expected[property])) {
        return false;
      }
    }
  } else {
    return current === expected;
  }
  return true;
};
var findStyleDiff = function findStyleDiff(current, expected, shouldMatchAllProps) {
  var diffs = [];
  var isEqual = true;
  var property;
  for (property in expected) {
    if (!_checkEqual(current[property], expected[property])) {
      isEqual = false;
      diffs.push({
        property: property,
        current: current[property],
        expect: expected[property]
      });
    }
  }
  if (shouldMatchAllProps && Object.keys(current).length !== Object.keys(expected).length) {
    isEqual = false;
    var _property;
    for (_property in current) {
      if (expected[_property] === undefined) {
        diffs.push({
          property: _property,
          current: current[_property],
          expect: expected[_property]
        });
      }
    }
  }
  return {
    isEqual: isEqual,
    diffs: diffs
  };
};
var compareStyle = function compareStyle(component, expectedStyle, config) {
  if (!component.props.style) {
    return {
      message: function message() {
        return `Component doesn't have a style.`;
      },
      pass: false
    };
  }
  var shouldMatchAllProps = config.shouldMatchAllProps;
  var currentStyle = getCurrentStyle(component);
  var _findStyleDiff = findStyleDiff(currentStyle, expectedStyle, shouldMatchAllProps),
    isEqual = _findStyleDiff.isEqual,
    diffs = _findStyleDiff.diffs;
  if (isEqual) {
    return {
      message: function message() {
        return 'ok';
      },
      pass: true
    };
  }
  var currentStyleStr = JSON.stringify(currentStyle);
  var expectedStyleStr = JSON.stringify(expectedStyle);
  var differences = diffs.map(function (diff) {
    return `- '${diff.property}' should be ${JSON.stringify(diff.expect)}, but is ${JSON.stringify(diff.current)}`;
  }).join('\n');
  return {
    message: function message() {
      return `Expected: ${expectedStyleStr}\nReceived: ${currentStyleStr}\n\nDifferences:\n${differences}`;
    },
    pass: false
  };
};
var frameTime = Math.round(1000 / defaultFramerateConfig.fps);
var beforeTest = function beforeTest() {
  jest.useFakeTimers();
};
var afterTest = function afterTest() {
  jest.runOnlyPendingTimers();
  jest.useRealTimers();
};
var withReanimatedTimer = exports.withReanimatedTimer = function withReanimatedTimer(animationTest) {
  console.warn('This method is deprecated, you should define your own before and after test hooks to enable jest.useFakeTimers(). Check out the documentation for details on testing');
  beforeTest();
  animationTest();
  afterTest();
};
var advanceAnimationByTime = exports.advanceAnimationByTime = function advanceAnimationByTime() {
  var time = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : frameTime;
  console.warn('This method is deprecated, use jest.advanceTimersByTime directly');
  jest.advanceTimersByTime(time);
  jest.runOnlyPendingTimers();
};
var advanceAnimationByFrame = exports.advanceAnimationByFrame = function advanceAnimationByFrame(count) {
  console.warn('This method is deprecated, use jest.advanceTimersByTime directly');
  jest.advanceTimersByTime(count * frameTime);
  jest.runOnlyPendingTimers();
};
var requireFunction = (0, _PlatformChecker.isJest)() ? require : function () {
  throw new Error('[Reanimated] `setUpTests` is available only in Jest environment.');
};
var setUpTests = exports.setUpTests = function setUpTests() {
  var userFramerateConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var expect = global.expect;
  if (expect === undefined) {
    var expectModule = requireFunction('expect');
    expect = expectModule;
    if (typeof expect === 'object') {
      var jestGlobals = requireFunction('@jest/globals');
      expect = jestGlobals.expect;
    }
    if (expect === undefined || expect.extend === undefined) {
      expect = expectModule.default;
    }
  }
  var framerateConfig = Object.assign({}, defaultFramerateConfig, userFramerateConfig);
  frameTime = Math.round(1000 / framerateConfig.fps);
  expect.extend({
    toHaveAnimatedStyle: function toHaveAnimatedStyle(component, expectedStyle) {
      var config = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      return compareStyle(component, expectedStyle, config);
    }
  });
};
var getAnimatedStyle = exports.getAnimatedStyle = function getAnimatedStyle(component) {
  return getCurrentStyle(component);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIndpdGhSZWFuaW1hdGVkVGltZXIiLCJzZXRVcFRlc3RzIiwiZ2V0QW5pbWF0ZWRTdHlsZSIsImFkdmFuY2VBbmltYXRpb25CeVRpbWUiLCJhZHZhbmNlQW5pbWF0aW9uQnlGcmFtZSIsIl9QbGF0Zm9ybUNoZWNrZXIiLCJyZXF1aXJlIiwiZGVmYXVsdEZyYW1lcmF0ZUNvbmZpZyIsImZwcyIsImdldEN1cnJlbnRTdHlsZSIsImNvbXBvbmVudCIsInN0eWxlT2JqZWN0IiwicHJvcHMiLCJzdHlsZSIsImN1cnJlbnRTdHlsZSIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJhc3NpZ24iLCJfY29tcG9uZW50JHByb3BzJGplc3QiLCJqZXN0QW5pbWF0ZWRTdHlsZSIsImNoZWNrRXF1YWwiLCJjdXJyZW50IiwiZXhwZWN0ZWQiLCJsZW5ndGgiLCJpIiwicHJvcGVydHkiLCJmaW5kU3R5bGVEaWZmIiwic2hvdWxkTWF0Y2hBbGxQcm9wcyIsImRpZmZzIiwiaXNFcXVhbCIsInB1c2giLCJleHBlY3QiLCJrZXlzIiwidW5kZWZpbmVkIiwiY29tcGFyZVN0eWxlIiwiZXhwZWN0ZWRTdHlsZSIsImNvbmZpZyIsIm1lc3NhZ2UiLCJwYXNzIiwiX2ZpbmRTdHlsZURpZmYiLCJjdXJyZW50U3R5bGVTdHIiLCJKU09OIiwic3RyaW5naWZ5IiwiZXhwZWN0ZWRTdHlsZVN0ciIsImRpZmZlcmVuY2VzIiwibWFwIiwiZGlmZiIsImpvaW4iLCJmcmFtZVRpbWUiLCJNYXRoIiwicm91bmQiLCJiZWZvcmVUZXN0IiwiamVzdCIsInVzZUZha2VUaW1lcnMiLCJhZnRlclRlc3QiLCJydW5Pbmx5UGVuZGluZ1RpbWVycyIsInVzZVJlYWxUaW1lcnMiLCJhbmltYXRpb25UZXN0IiwiY29uc29sZSIsIndhcm4iLCJ0aW1lIiwiYXJndW1lbnRzIiwiYWR2YW5jZVRpbWVyc0J5VGltZSIsImNvdW50IiwicmVxdWlyZUZ1bmN0aW9uIiwiaXNKZXN0IiwiRXJyb3IiLCJ1c2VyRnJhbWVyYXRlQ29uZmlnIiwiZ2xvYmFsIiwiZXhwZWN0TW9kdWxlIiwiamVzdEdsb2JhbHMiLCJleHRlbmQiLCJkZWZhdWx0IiwiZnJhbWVyYXRlQ29uZmlnIiwidG9IYXZlQW5pbWF0ZWRTdHlsZSJdLCJzb3VyY2VzIjpbImplc3RVdGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbmFtZXNwYWNlICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHsgUmVhY3RUZXN0SW5zdGFuY2UgfSBmcm9tICdyZWFjdC10ZXN0LXJlbmRlcmVyJztcbmltcG9ydCB0eXBlIHtcbiAgQW5pbWF0ZWRDb21wb25lbnRQcm9wcyxcbiAgSUFuaW1hdGVkQ29tcG9uZW50SW50ZXJuYWwsXG4gIEluaXRpYWxDb21wb25lbnRQcm9wcyxcbn0gZnJvbSAnLi9jcmVhdGVBbmltYXRlZENvbXBvbmVudC9jb21tb25UeXBlcyc7XG5pbXBvcnQgeyBpc0plc3QgfSBmcm9tICcuL1BsYXRmb3JtQ2hlY2tlcic7XG5pbXBvcnQgdHlwZSB7IERlZmF1bHRTdHlsZSB9IGZyb20gJy4vaG9vay9jb21tb25UeXBlcyc7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0hhdmVBbmltYXRlZFN0eWxlKFxuICAgICAgICBzdHlsZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSB8IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgICBjb25maWc/OiB7XG4gICAgICAgICAgc2hvdWxkTWF0Y2hBbGxQcm9wcz86IGJvb2xlYW47XG4gICAgICAgIH1cbiAgICAgICk6IFI7XG4gICAgfVxuICB9XG59XG5cbmNvbnN0IGRlZmF1bHRGcmFtZXJhdGVDb25maWcgPSB7XG4gIGZwczogNjAsXG59O1xuXG5jb25zdCBnZXRDdXJyZW50U3R5bGUgPSAoY29tcG9uZW50OiBUZXN0Q29tcG9uZW50KTogRGVmYXVsdFN0eWxlID0+IHtcbiAgY29uc3Qgc3R5bGVPYmplY3QgPSBjb21wb25lbnQucHJvcHMuc3R5bGU7XG4gIGxldCBjdXJyZW50U3R5bGUgPSB7fTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc3R5bGVPYmplY3QpKSB7XG4gICAgc3R5bGVPYmplY3QuZm9yRWFjaCgoc3R5bGUpID0+IHtcbiAgICAgIGN1cnJlbnRTdHlsZSA9IHtcbiAgICAgICAgLi4uY3VycmVudFN0eWxlLFxuICAgICAgICAuLi5zdHlsZSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY3VycmVudFN0eWxlID0ge1xuICAgICAgLi4uc3R5bGVPYmplY3QsXG4gICAgICAuLi5jb21wb25lbnQucHJvcHMuamVzdEFuaW1hdGVkU3R5bGU/LnZhbHVlLFxuICAgIH07XG4gIH1cbiAgcmV0dXJuIGN1cnJlbnRTdHlsZTtcbn07XG5cbmNvbnN0IGNoZWNrRXF1YWwgPSA8VmFsdWU+KGN1cnJlbnQ6IFZhbHVlLCBleHBlY3RlZDogVmFsdWUpID0+IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZXhwZWN0ZWQpKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGN1cnJlbnQpIHx8IGV4cGVjdGVkLmxlbmd0aCAhPT0gY3VycmVudC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJyZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNoZWNrRXF1YWwoY3VycmVudFtpXSwgZXhwZWN0ZWRbaV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdvYmplY3QnICYmIGN1cnJlbnQpIHtcbiAgICBpZiAodHlwZW9mIGV4cGVjdGVkICE9PSAnb2JqZWN0JyB8fCAhZXhwZWN0ZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBleHBlY3RlZCkge1xuICAgICAgaWYgKCFjaGVja0VxdWFsKGN1cnJlbnRbcHJvcGVydHldLCBleHBlY3RlZFtwcm9wZXJ0eV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGN1cnJlbnQgPT09IGV4cGVjdGVkO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuY29uc3QgZmluZFN0eWxlRGlmZiA9IChcbiAgY3VycmVudDogRGVmYXVsdFN0eWxlLFxuICBleHBlY3RlZDogRGVmYXVsdFN0eWxlLFxuICBzaG91bGRNYXRjaEFsbFByb3BzPzogYm9vbGVhblxuKSA9PiB7XG4gIGNvbnN0IGRpZmZzID0gW107XG4gIGxldCBpc0VxdWFsID0gdHJ1ZTtcbiAgbGV0IHByb3BlcnR5OiBrZXlvZiBEZWZhdWx0U3R5bGU7XG4gIGZvciAocHJvcGVydHkgaW4gZXhwZWN0ZWQpIHtcbiAgICBpZiAoIWNoZWNrRXF1YWwoY3VycmVudFtwcm9wZXJ0eV0sIGV4cGVjdGVkW3Byb3BlcnR5XSkpIHtcbiAgICAgIGlzRXF1YWwgPSBmYWxzZTtcbiAgICAgIGRpZmZzLnB1c2goe1xuICAgICAgICBwcm9wZXJ0eSxcbiAgICAgICAgY3VycmVudDogY3VycmVudFtwcm9wZXJ0eV0sXG4gICAgICAgIGV4cGVjdDogZXhwZWN0ZWRbcHJvcGVydHldLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKFxuICAgIHNob3VsZE1hdGNoQWxsUHJvcHMgJiZcbiAgICBPYmplY3Qua2V5cyhjdXJyZW50KS5sZW5ndGggIT09IE9iamVjdC5rZXlzKGV4cGVjdGVkKS5sZW5ndGhcbiAgKSB7XG4gICAgaXNFcXVhbCA9IGZhbHNlO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tc2hhZG93XG4gICAgbGV0IHByb3BlcnR5OiBrZXlvZiBEZWZhdWx0U3R5bGU7XG4gICAgZm9yIChwcm9wZXJ0eSBpbiBjdXJyZW50KSB7XG4gICAgICBpZiAoZXhwZWN0ZWRbcHJvcGVydHldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZGlmZnMucHVzaCh7XG4gICAgICAgICAgcHJvcGVydHksXG4gICAgICAgICAgY3VycmVudDogY3VycmVudFtwcm9wZXJ0eV0sXG4gICAgICAgICAgZXhwZWN0OiBleHBlY3RlZFtwcm9wZXJ0eV0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGlzRXF1YWwsIGRpZmZzIH07XG59O1xuXG5jb25zdCBjb21wYXJlU3R5bGUgPSAoXG4gIGNvbXBvbmVudDogVGVzdENvbXBvbmVudCxcbiAgZXhwZWN0ZWRTdHlsZTogRGVmYXVsdFN0eWxlLFxuICBjb25maWc6IFRvSGF2ZUFuaW1hdGVkU3R5bGVDb25maWdcbikgPT4ge1xuICBpZiAoIWNvbXBvbmVudC5wcm9wcy5zdHlsZSkge1xuICAgIHJldHVybiB7IG1lc3NhZ2U6ICgpID0+IGBDb21wb25lbnQgZG9lc24ndCBoYXZlIGEgc3R5bGUuYCwgcGFzczogZmFsc2UgfTtcbiAgfVxuICBjb25zdCB7IHNob3VsZE1hdGNoQWxsUHJvcHMgfSA9IGNvbmZpZztcbiAgY29uc3QgY3VycmVudFN0eWxlID0gZ2V0Q3VycmVudFN0eWxlKGNvbXBvbmVudCk7XG4gIGNvbnN0IHsgaXNFcXVhbCwgZGlmZnMgfSA9IGZpbmRTdHlsZURpZmYoXG4gICAgY3VycmVudFN0eWxlLFxuICAgIGV4cGVjdGVkU3R5bGUsXG4gICAgc2hvdWxkTWF0Y2hBbGxQcm9wc1xuICApO1xuXG4gIGlmIChpc0VxdWFsKSB7XG4gICAgcmV0dXJuIHsgbWVzc2FnZTogKCkgPT4gJ29rJywgcGFzczogdHJ1ZSB9O1xuICB9XG5cbiAgY29uc3QgY3VycmVudFN0eWxlU3RyID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudFN0eWxlKTtcbiAgY29uc3QgZXhwZWN0ZWRTdHlsZVN0ciA9IEpTT04uc3RyaW5naWZ5KGV4cGVjdGVkU3R5bGUpO1xuICBjb25zdCBkaWZmZXJlbmNlcyA9IGRpZmZzXG4gICAgLm1hcChcbiAgICAgIChkaWZmKSA9PlxuICAgICAgICBgLSAnJHtkaWZmLnByb3BlcnR5fScgc2hvdWxkIGJlICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgZGlmZi5leHBlY3RcbiAgICAgICAgKX0sIGJ1dCBpcyAke0pTT04uc3RyaW5naWZ5KGRpZmYuY3VycmVudCl9YFxuICAgIClcbiAgICAuam9pbignXFxuJyk7XG5cbiAgcmV0dXJuIHtcbiAgICBtZXNzYWdlOiAoKSA9PlxuICAgICAgYEV4cGVjdGVkOiAke2V4cGVjdGVkU3R5bGVTdHJ9XFxuUmVjZWl2ZWQ6ICR7Y3VycmVudFN0eWxlU3RyfVxcblxcbkRpZmZlcmVuY2VzOlxcbiR7ZGlmZmVyZW5jZXN9YCxcbiAgICBwYXNzOiBmYWxzZSxcbiAgfTtcbn07XG5cbmxldCBmcmFtZVRpbWUgPSBNYXRoLnJvdW5kKDEwMDAgLyBkZWZhdWx0RnJhbWVyYXRlQ29uZmlnLmZwcyk7XG5cbmNvbnN0IGJlZm9yZVRlc3QgPSAoKSA9PiB7XG4gIGplc3QudXNlRmFrZVRpbWVycygpO1xufTtcblxuY29uc3QgYWZ0ZXJUZXN0ID0gKCkgPT4ge1xuICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XG4gIGplc3QudXNlUmVhbFRpbWVycygpO1xufTtcblxuZXhwb3J0IGNvbnN0IHdpdGhSZWFuaW1hdGVkVGltZXIgPSAoYW5pbWF0aW9uVGVzdDogKCkgPT4gdm9pZCkgPT4ge1xuICBjb25zb2xlLndhcm4oXG4gICAgJ1RoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgZGVmaW5lIHlvdXIgb3duIGJlZm9yZSBhbmQgYWZ0ZXIgdGVzdCBob29rcyB0byBlbmFibGUgamVzdC51c2VGYWtlVGltZXJzKCkuIENoZWNrIG91dCB0aGUgZG9jdW1lbnRhdGlvbiBmb3IgZGV0YWlscyBvbiB0ZXN0aW5nJ1xuICApO1xuICBiZWZvcmVUZXN0KCk7XG4gIGFuaW1hdGlvblRlc3QoKTtcbiAgYWZ0ZXJUZXN0KCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWR2YW5jZUFuaW1hdGlvbkJ5VGltZSA9ICh0aW1lID0gZnJhbWVUaW1lKSA9PiB7XG4gIGNvbnNvbGUud2FybihcbiAgICAnVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCwgdXNlIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSBkaXJlY3RseSdcbiAgKTtcbiAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKHRpbWUpO1xuICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWR2YW5jZUFuaW1hdGlvbkJ5RnJhbWUgPSAoY291bnQ6IG51bWJlcikgPT4ge1xuICBjb25zb2xlLndhcm4oXG4gICAgJ1RoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQsIHVzZSBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUgZGlyZWN0bHknXG4gICk7XG4gIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZShjb3VudCAqIGZyYW1lVGltZSk7XG4gIGplc3QucnVuT25seVBlbmRpbmdUaW1lcnMoKTtcbn07XG5cbmNvbnN0IHJlcXVpcmVGdW5jdGlvbiA9IGlzSmVzdCgpXG4gID8gcmVxdWlyZVxuICA6ICgpID0+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1tSZWFuaW1hdGVkXSBgc2V0VXBUZXN0c2AgaXMgYXZhaWxhYmxlIG9ubHkgaW4gSmVzdCBlbnZpcm9ubWVudC4nXG4gICAgICApO1xuICAgIH07XG5cbnR5cGUgVG9IYXZlQW5pbWF0ZWRTdHlsZUNvbmZpZyA9IHtcbiAgc2hvdWxkTWF0Y2hBbGxQcm9wcz86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0VXBUZXN0cyA9ICh1c2VyRnJhbWVyYXRlQ29uZmlnID0ge30pID0+IHtcbiAgbGV0IGV4cGVjdDogamVzdC5FeHBlY3QgPSAoZ2xvYmFsIGFzIHR5cGVvZiBnbG9iYWwgJiB7IGV4cGVjdDogamVzdC5FeHBlY3QgfSlcbiAgICAuZXhwZWN0O1xuICBpZiAoZXhwZWN0ID09PSB1bmRlZmluZWQpIHtcbiAgICBjb25zdCBleHBlY3RNb2R1bGUgPSByZXF1aXJlRnVuY3Rpb24oJ2V4cGVjdCcpO1xuICAgIGV4cGVjdCA9IGV4cGVjdE1vZHVsZTtcbiAgICAvLyBTdGFydGluZyBmcm9tIEplc3QgMjgsIFwiZXhwZWN0XCIgcGFja2FnZSB1c2VzIG5hbWVkIGV4cG9ydHMgaW5zdGVhZCBvZiBkZWZhdWx0IGV4cG9ydC5cbiAgICAvLyBTbywgcmVxdWlyaW5nIFwiZXhwZWN0XCIgcGFja2FnZSBkb2Vzbid0IGdpdmUgZGlyZWN0IGFjY2VzcyB0byBcImV4cGVjdFwiIGZ1bmN0aW9uIGFueW1vcmUuXG4gICAgLy8gSXQgZ2l2ZXMgYWNjZXNzIHRvIHRoZSBtb2R1bGUgb2JqZWN0IGluc3RlYWQuXG4gICAgLy8gV2UgdXNlIHRoaXMgaW5mbyB0byBkZXRlY3QgaWYgdGhlIHByb2plY3QgdXNlcyBKZXN0IDI4IG9yIGhpZ2hlci5cbiAgICBpZiAodHlwZW9mIGV4cGVjdCA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGNvbnN0IGplc3RHbG9iYWxzID0gcmVxdWlyZUZ1bmN0aW9uKCdAamVzdC9nbG9iYWxzJyk7XG4gICAgICBleHBlY3QgPSBqZXN0R2xvYmFscy5leHBlY3Q7XG4gICAgfVxuICAgIGlmIChleHBlY3QgPT09IHVuZGVmaW5lZCB8fCBleHBlY3QuZXh0ZW5kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGV4cGVjdCA9IGV4cGVjdE1vZHVsZS5kZWZhdWx0O1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGZyYW1lcmF0ZUNvbmZpZyA9IHtcbiAgICAuLi5kZWZhdWx0RnJhbWVyYXRlQ29uZmlnLFxuICAgIC4uLnVzZXJGcmFtZXJhdGVDb25maWcsXG4gIH07XG4gIGZyYW1lVGltZSA9IE1hdGgucm91bmQoMTAwMCAvIGZyYW1lcmF0ZUNvbmZpZy5mcHMpO1xuXG4gIGV4cGVjdC5leHRlbmQoe1xuICAgIHRvSGF2ZUFuaW1hdGVkU3R5bGUoXG4gICAgICBjb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudDxcbiAgICAgICAgQW5pbWF0ZWRDb21wb25lbnRQcm9wczxJbml0aWFsQ29tcG9uZW50UHJvcHM+XG4gICAgICA+ICZcbiAgICAgICAgSUFuaW1hdGVkQ29tcG9uZW50SW50ZXJuYWwsXG4gICAgICBleHBlY3RlZFN0eWxlOiBEZWZhdWx0U3R5bGUsXG4gICAgICBjb25maWc6IFRvSGF2ZUFuaW1hdGVkU3R5bGVDb25maWcgPSB7fVxuICAgICkge1xuICAgICAgcmV0dXJuIGNvbXBhcmVTdHlsZShjb21wb25lbnQsIGV4cGVjdGVkU3R5bGUsIGNvbmZpZyk7XG4gICAgfSxcbiAgfSk7XG59O1xuXG50eXBlIFRlc3RDb21wb25lbnQgPSBSZWFjdC5Db21wb25lbnQ8XG4gIEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8SW5pdGlhbENvbXBvbmVudFByb3BzPiAmIHtcbiAgICBqZXN0QW5pbWF0ZWRTdHlsZT86IHsgdmFsdWU6IERlZmF1bHRTdHlsZSB9O1xuICB9XG4+O1xuXG5leHBvcnQgY29uc3QgZ2V0QW5pbWF0ZWRTdHlsZSA9IChjb21wb25lbnQ6IFJlYWN0VGVzdEluc3RhbmNlKSA9PiB7XG4gIHJldHVybiBnZXRDdXJyZW50U3R5bGUoXG4gICAgLy8gVGhpcyB0eXBlIGFzc2VydGlvbiBpcyBuZWVkZWQgdG8gZ2V0IHR5cGUgY2hlY2tpbmcgaW4gdGhlIGZvbGxvd2luZ1xuICAgIC8vIGZ1bmN0aW9ucyBzaW5jZSBgUmVhY3RUZXN0SW5zdGFuY2VgIGhhcyBpdHMgYHByb3BzYCBkZWZpbmVkIGFzIGBhbnlgLlxuICAgIGNvbXBvbmVudCBhcyB1bmtub3duIGFzIFRlc3RDb21wb25lbnRcbiAgKTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUNBLFlBQVk7O0FBQUNBLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLG1CQUFBLEdBQUFGLE9BQUEsQ0FBQUcsVUFBQSxHQUFBSCxPQUFBLENBQUFJLGdCQUFBLEdBQUFKLE9BQUEsQ0FBQUssc0JBQUEsR0FBQUwsT0FBQSxDQUFBTSx1QkFBQTtBQVFiLElBQUFDLGdCQUFBLEdBQUFDLE9BQUE7QUFnQkEsSUFBTUMsc0JBQXNCLEdBQUc7RUFDN0JDLEdBQUcsRUFBRTtBQUNQLENBQUM7QUFFRCxJQUFNQyxlQUFlLEdBQUcsU0FBbEJBLGVBQWVBLENBQUlDLFNBQXdCLEVBQW1CO0VBQ2xFLElBQU1DLFdBQVcsR0FBR0QsU0FBUyxDQUFDRSxLQUFLLENBQUNDLEtBQUs7RUFDekMsSUFBSUMsWUFBWSxHQUFHLENBQUMsQ0FBQztFQUNyQixJQUFJQyxLQUFLLENBQUNDLE9BQU8sQ0FBQ0wsV0FBVyxDQUFDLEVBQUU7SUFDOUJBLFdBQVcsQ0FBQ00sT0FBTyxDQUFDLFVBQUNKLEtBQUssRUFBSztNQUM3QkMsWUFBWSxHQUFBbEIsTUFBQSxDQUFBc0IsTUFBQSxLQUNQSixZQUFZLEVBQ1pELEtBQUssQ0FDVDtJQUNILENBQUMsQ0FBQztFQUNKLENBQUMsTUFBTTtJQUFBLElBQUFNLHFCQUFBO0lBQ0xMLFlBQVksR0FBQWxCLE1BQUEsQ0FBQXNCLE1BQUEsS0FDUFAsV0FBVyxHQUFBUSxxQkFBQSxHQUNYVCxTQUFTLENBQUNFLEtBQUssQ0FBQ1EsaUJBQWlCLHFCQUFqQ0QscUJBQUEsQ0FBbUNwQixLQUFLLENBQzVDO0VBQ0g7RUFDQSxPQUFPZSxZQUFZO0FBQ3JCLENBQUM7QUFFRCxJQUFNTyxXQUFVLEdBQUcsU0FBYkEsVUFBVUEsQ0FBV0MsT0FBYyxFQUFFQyxRQUFlLEVBQUs7RUFDN0QsSUFBSVIsS0FBSyxDQUFDQyxPQUFPLENBQUNPLFFBQVEsQ0FBQyxFQUFFO0lBQzNCLElBQUksQ0FBQ1IsS0FBSyxDQUFDQyxPQUFPLENBQUNNLE9BQU8sQ0FBQyxJQUFJQyxRQUFRLENBQUNDLE1BQU0sS0FBS0YsT0FBTyxDQUFDRSxNQUFNLEVBQUU7TUFDakUsT0FBTyxLQUFLO0lBQ2Q7SUFDQSxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0gsT0FBTyxDQUFDRSxNQUFNLEVBQUVDLENBQUMsRUFBRSxFQUFFO01BQ3ZDLElBQUksQ0FBQ0osV0FBVSxDQUFDQyxPQUFPLENBQUNHLENBQUMsQ0FBQyxFQUFFRixRQUFRLENBQUNFLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDeEMsT0FBTyxLQUFLO01BQ2Q7SUFDRjtFQUNGLENBQUMsTUFBTSxJQUFJLE9BQU9ILE9BQU8sS0FBSyxRQUFRLElBQUlBLE9BQU8sRUFBRTtJQUNqRCxJQUFJLE9BQU9DLFFBQVEsS0FBSyxRQUFRLElBQUksQ0FBQ0EsUUFBUSxFQUFFO01BQzdDLE9BQU8sS0FBSztJQUNkO0lBQ0EsS0FBSyxJQUFNRyxRQUFRLElBQUlILFFBQVEsRUFBRTtNQUMvQixJQUFJLENBQUNGLFdBQVUsQ0FBQ0MsT0FBTyxDQUFDSSxRQUFRLENBQUMsRUFBRUgsUUFBUSxDQUFDRyxRQUFRLENBQUMsQ0FBQyxFQUFFO1FBQ3RELE9BQU8sS0FBSztNQUNkO0lBQ0Y7RUFDRixDQUFDLE1BQU07SUFDTCxPQUFPSixPQUFPLEtBQUtDLFFBQVE7RUFDN0I7RUFDQSxPQUFPLElBQUk7QUFDYixDQUFDO0FBRUQsSUFBTUksYUFBYSxHQUFHLFNBQWhCQSxhQUFhQSxDQUNqQkwsT0FBcUIsRUFDckJDLFFBQXNCLEVBQ3RCSyxtQkFBNkIsRUFDMUI7RUFDSCxJQUFNQyxLQUFLLEdBQUcsRUFBRTtFQUNoQixJQUFJQyxPQUFPLEdBQUcsSUFBSTtFQUNsQixJQUFJSixRQUE0QjtFQUNoQyxLQUFLQSxRQUFRLElBQUlILFFBQVEsRUFBRTtJQUN6QixJQUFJLENBQUNGLFdBQVUsQ0FBQ0MsT0FBTyxDQUFDSSxRQUFRLENBQUMsRUFBRUgsUUFBUSxDQUFDRyxRQUFRLENBQUMsQ0FBQyxFQUFFO01BQ3RESSxPQUFPLEdBQUcsS0FBSztNQUNmRCxLQUFLLENBQUNFLElBQUksQ0FBQztRQUNUTCxRQUFRLEVBQVJBLFFBQVE7UUFDUkosT0FBTyxFQUFFQSxPQUFPLENBQUNJLFFBQVEsQ0FBQztRQUMxQk0sTUFBTSxFQUFFVCxRQUFRLENBQUNHLFFBQVE7TUFDM0IsQ0FBQyxDQUFDO0lBQ0o7RUFDRjtFQUVBLElBQ0VFLG1CQUFtQixJQUNuQmhDLE1BQU0sQ0FBQ3FDLElBQUksQ0FBQ1gsT0FBTyxDQUFDLENBQUNFLE1BQU0sS0FBSzVCLE1BQU0sQ0FBQ3FDLElBQUksQ0FBQ1YsUUFBUSxDQUFDLENBQUNDLE1BQU0sRUFDNUQ7SUFDQU0sT0FBTyxHQUFHLEtBQUs7SUFFZixJQUFJSixTQUE0QjtJQUNoQyxLQUFLQSxTQUFRLElBQUlKLE9BQU8sRUFBRTtNQUN4QixJQUFJQyxRQUFRLENBQUNHLFNBQVEsQ0FBQyxLQUFLUSxTQUFTLEVBQUU7UUFDcENMLEtBQUssQ0FBQ0UsSUFBSSxDQUFDO1VBQ1RMLFFBQVEsRUFBUkEsU0FBUTtVQUNSSixPQUFPLEVBQUVBLE9BQU8sQ0FBQ0ksU0FBUSxDQUFDO1VBQzFCTSxNQUFNLEVBQUVULFFBQVEsQ0FBQ0csU0FBUTtRQUMzQixDQUFDLENBQUM7TUFDSjtJQUNGO0VBQ0Y7RUFFQSxPQUFPO0lBQUVJLE9BQU8sRUFBUEEsT0FBTztJQUFFRCxLQUFLLEVBQUxBO0VBQU0sQ0FBQztBQUMzQixDQUFDO0FBRUQsSUFBTU0sWUFBWSxHQUFHLFNBQWZBLFlBQVlBLENBQ2hCekIsU0FBd0IsRUFDeEIwQixhQUEyQixFQUMzQkMsTUFBaUMsRUFDOUI7RUFDSCxJQUFJLENBQUMzQixTQUFTLENBQUNFLEtBQUssQ0FBQ0MsS0FBSyxFQUFFO0lBQzFCLE9BQU87TUFBRXlCLE9BQU8sRUFBRSxTQUFUQSxPQUFPQSxDQUFBO1FBQUEsT0FBUSxpQ0FBaUM7TUFBQTtNQUFFQyxJQUFJLEVBQUU7SUFBTSxDQUFDO0VBQzFFO0VBQ0EsSUFBUVgsbUJBQW1CLEdBQUtTLE1BQU0sQ0FBOUJULG1CQUFtQjtFQUMzQixJQUFNZCxZQUFZLEdBQUdMLGVBQWUsQ0FBQ0MsU0FBUyxDQUFDO0VBQy9DLElBQUE4QixjQUFBLEdBQTJCYixhQUFhLENBQ3RDYixZQUFZLEVBQ1pzQixhQUFhLEVBQ2JSLG1CQUNGLENBQUM7SUFKT0UsT0FBTyxHQUFBVSxjQUFBLENBQVBWLE9BQU87SUFBRUQsS0FBSyxHQUFBVyxjQUFBLENBQUxYLEtBQUs7RUFNdEIsSUFBSUMsT0FBTyxFQUFFO0lBQ1gsT0FBTztNQUFFUSxPQUFPLEVBQUUsU0FBVEEsT0FBT0EsQ0FBQTtRQUFBLE9BQVEsSUFBSTtNQUFBO01BQUVDLElBQUksRUFBRTtJQUFLLENBQUM7RUFDNUM7RUFFQSxJQUFNRSxlQUFlLEdBQUdDLElBQUksQ0FBQ0MsU0FBUyxDQUFDN0IsWUFBWSxDQUFDO0VBQ3BELElBQU04QixnQkFBZ0IsR0FBR0YsSUFBSSxDQUFDQyxTQUFTLENBQUNQLGFBQWEsQ0FBQztFQUN0RCxJQUFNUyxXQUFXLEdBQUdoQixLQUFLLENBQ3RCaUIsR0FBRyxDQUNGLFVBQUNDLElBQUk7SUFBQSxPQUNILE1BQU1BLElBQUksQ0FBQ3JCLFFBQVEsZUFBZWdCLElBQUksQ0FBQ0MsU0FBUyxDQUM5Q0ksSUFBSSxDQUFDZixNQUNQLENBQUMsWUFBWVUsSUFBSSxDQUFDQyxTQUFTLENBQUNJLElBQUksQ0FBQ3pCLE9BQU8sQ0FBQyxFQUFFO0VBQUEsQ0FDL0MsQ0FBQyxDQUNBMEIsSUFBSSxDQUFDLElBQUksQ0FBQztFQUViLE9BQU87SUFDTFYsT0FBTyxFQUFFLFNBQVRBLE9BQU9BLENBQUE7TUFBQSxPQUNMLGFBQWFNLGdCQUFnQixlQUFlSCxlQUFlLHFCQUFxQkksV0FBVyxFQUFFO0lBQUE7SUFDL0ZOLElBQUksRUFBRTtFQUNSLENBQUM7QUFDSCxDQUFDO0FBRUQsSUFBSVUsU0FBUyxHQUFHQyxJQUFJLENBQUNDLEtBQUssQ0FBQyxJQUFJLEdBQUc1QyxzQkFBc0IsQ0FBQ0MsR0FBRyxDQUFDO0FBRTdELElBQU00QyxVQUFVLEdBQUcsU0FBYkEsVUFBVUEsQ0FBQSxFQUFTO0VBQ3ZCQyxJQUFJLENBQUNDLGFBQWEsQ0FBQyxDQUFDO0FBQ3RCLENBQUM7QUFFRCxJQUFNQyxTQUFTLEdBQUcsU0FBWkEsU0FBU0EsQ0FBQSxFQUFTO0VBQ3RCRixJQUFJLENBQUNHLG9CQUFvQixDQUFDLENBQUM7RUFDM0JILElBQUksQ0FBQ0ksYUFBYSxDQUFDLENBQUM7QUFDdEIsQ0FBQztBQUVNLElBQU16RCxtQkFBbUIsR0FBQUYsT0FBQSxDQUFBRSxtQkFBQSxHQUFHLFNBQXRCQSxtQkFBbUJBLENBQUkwRCxhQUF5QixFQUFLO0VBQ2hFQyxPQUFPLENBQUNDLElBQUksQ0FDVixzS0FDRixDQUFDO0VBQ0RSLFVBQVUsQ0FBQyxDQUFDO0VBQ1pNLGFBQWEsQ0FBQyxDQUFDO0VBQ2ZILFNBQVMsQ0FBQyxDQUFDO0FBQ2IsQ0FBQztBQUVNLElBQU1wRCxzQkFBc0IsR0FBQUwsT0FBQSxDQUFBSyxzQkFBQSxHQUFHLFNBQXpCQSxzQkFBc0JBLENBQUEsRUFBeUI7RUFBQSxJQUFyQjBELElBQUksR0FBQUMsU0FBQSxDQUFBdEMsTUFBQSxRQUFBc0MsU0FBQSxRQUFBNUIsU0FBQSxHQUFBNEIsU0FBQSxNQUFHYixTQUFTO0VBQ3JEVSxPQUFPLENBQUNDLElBQUksQ0FDVixrRUFDRixDQUFDO0VBQ0RQLElBQUksQ0FBQ1UsbUJBQW1CLENBQUNGLElBQUksQ0FBQztFQUM5QlIsSUFBSSxDQUFDRyxvQkFBb0IsQ0FBQyxDQUFDO0FBQzdCLENBQUM7QUFFTSxJQUFNcEQsdUJBQXVCLEdBQUFOLE9BQUEsQ0FBQU0sdUJBQUEsR0FBRyxTQUExQkEsdUJBQXVCQSxDQUFJNEQsS0FBYSxFQUFLO0VBQ3hETCxPQUFPLENBQUNDLElBQUksQ0FDVixrRUFDRixDQUFDO0VBQ0RQLElBQUksQ0FBQ1UsbUJBQW1CLENBQUNDLEtBQUssR0FBR2YsU0FBUyxDQUFDO0VBQzNDSSxJQUFJLENBQUNHLG9CQUFvQixDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELElBQU1TLGVBQWUsR0FBRyxJQUFBQyx1QkFBTSxFQUFDLENBQUMsR0FDNUI1RCxPQUFPLEdBQ1AsWUFBTTtFQUNKLE1BQU0sSUFBSTZELEtBQUssQ0FDYixrRUFDRixDQUFDO0FBQ0gsQ0FBQztBQU1FLElBQU1sRSxVQUFVLEdBQUFILE9BQUEsQ0FBQUcsVUFBQSxHQUFHLFNBQWJBLFVBQVVBLENBQUEsRUFBaUM7RUFBQSxJQUE3Qm1FLG1CQUFtQixHQUFBTixTQUFBLENBQUF0QyxNQUFBLFFBQUFzQyxTQUFBLFFBQUE1QixTQUFBLEdBQUE0QixTQUFBLE1BQUcsQ0FBQyxDQUFDO0VBQ2pELElBQUk5QixNQUFtQixHQUFJcUMsTUFBTSxDQUM5QnJDLE1BQU07RUFDVCxJQUFJQSxNQUFNLEtBQUtFLFNBQVMsRUFBRTtJQUN4QixJQUFNb0MsWUFBWSxHQUFHTCxlQUFlLENBQUMsUUFBUSxDQUFDO0lBQzlDakMsTUFBTSxHQUFHc0MsWUFBWTtJQUtyQixJQUFJLE9BQU90QyxNQUFNLEtBQUssUUFBUSxFQUFFO01BQzlCLElBQU11QyxXQUFXLEdBQUdOLGVBQWUsQ0FBQyxlQUFlLENBQUM7TUFDcERqQyxNQUFNLEdBQUd1QyxXQUFXLENBQUN2QyxNQUFNO0lBQzdCO0lBQ0EsSUFBSUEsTUFBTSxLQUFLRSxTQUFTLElBQUlGLE1BQU0sQ0FBQ3dDLE1BQU0sS0FBS3RDLFNBQVMsRUFBRTtNQUN2REYsTUFBTSxHQUFHc0MsWUFBWSxDQUFDRyxPQUFPO0lBQy9CO0VBQ0Y7RUFFQSxJQUFNQyxlQUFlLEdBQUE5RSxNQUFBLENBQUFzQixNQUFBLEtBQ2hCWCxzQkFBc0IsRUFDdEI2RCxtQkFBbUIsQ0FDdkI7RUFDRG5CLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUMsSUFBSSxHQUFHdUIsZUFBZSxDQUFDbEUsR0FBRyxDQUFDO0VBRWxEd0IsTUFBTSxDQUFDd0MsTUFBTSxDQUFDO0lBQ1pHLG1CQUFtQixXQUFuQkEsbUJBQW1CQSxDQUNqQmpFLFNBRzRCLEVBQzVCMEIsYUFBMkIsRUFFM0I7TUFBQSxJQURBQyxNQUFpQyxHQUFBeUIsU0FBQSxDQUFBdEMsTUFBQSxRQUFBc0MsU0FBQSxRQUFBNUIsU0FBQSxHQUFBNEIsU0FBQSxNQUFHLENBQUMsQ0FBQztNQUV0QyxPQUFPM0IsWUFBWSxDQUFDekIsU0FBUyxFQUFFMEIsYUFBYSxFQUFFQyxNQUFNLENBQUM7SUFDdkQ7RUFDRixDQUFDLENBQUM7QUFDSixDQUFDO0FBUU0sSUFBTW5DLGdCQUFnQixHQUFBSixPQUFBLENBQUFJLGdCQUFBLEdBQUcsU0FBbkJBLGdCQUFnQkEsQ0FBSVEsU0FBNEIsRUFBSztFQUNoRSxPQUFPRCxlQUFlLENBR3BCQyxTQUNGLENBQUM7QUFDSCxDQUFDIiwiaWdub3JlTGlzdCI6W119