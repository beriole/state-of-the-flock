e5ca0abdb855a109304622af6fdcf720
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withDecay = void 0;
var _util = require("../util");
var _rubberBandDecay = require("./rubberBandDecay");
var _utils = require("./utils");
var _rigidDecay = require("./rigidDecay");
function validateConfig(config) {
  'worklet';

  if (config.clamp) {
    if (!Array.isArray(config.clamp)) {
      throw new Error(`[Reanimated] \`config.clamp\` must be an array but is ${typeof config.clamp}.`);
    }
    if (config.clamp.length !== 2) {
      throw new Error(`[Reanimated] \`clamp array\` must contain 2 items but is given ${config.clamp.length}.`);
    }
  }
  if (config.velocityFactor <= 0) {
    throw new Error(`[Reanimated] \`config.velocityFactor\` must be greather then 0 but is ${config.velocityFactor}.`);
  }
  if (config.rubberBandEffect && !config.clamp) {
    throw new Error('[Reanimated] You need to set `clamp` property when using `rubberBandEffect`.');
  }
}
var withDecay = exports.withDecay = function withDecay(userConfig, callback) {
  'worklet';

  return (0, _util.defineAnimation)(0, function () {
    'worklet';

    var _config$velocity;
    var config = {
      deceleration: 0.998,
      velocityFactor: 1,
      velocity: 0,
      rubberBandFactor: 0.6
    };
    if (userConfig) {
      Object.keys(userConfig).forEach(function (key) {
        return config[key] = userConfig[key];
      });
    }
    var decay = (0, _utils.isValidRubberBandConfig)(config) ? function (animation, now) {
      return (0, _rubberBandDecay.rubberBandDecay)(animation, now, config);
    } : function (animation, now) {
      return (0, _rigidDecay.rigidDecay)(animation, now, config);
    };
    function onStart(animation, value, now) {
      animation.current = value;
      animation.lastTimestamp = now;
      animation.startTimestamp = now;
      animation.initialVelocity = config.velocity;
      validateConfig(config);
      if (animation.reduceMotion && config.clamp) {
        if (value < config.clamp[0]) {
          animation.current = config.clamp[0];
        } else if (value > config.clamp[1]) {
          animation.current = config.clamp[1];
        }
      }
    }
    return {
      onFrame: decay,
      onStart: onStart,
      callback: callback,
      velocity: (_config$velocity = config.velocity) != null ? _config$velocity : 0,
      initialVelocity: 0,
      current: 0,
      lastTimestamp: 0,
      startTimestamp: 0,
      reduceMotion: (0, _util.getReduceMotionForAnimation)(config.reduceMotion)
    };
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIndpdGhEZWNheSIsIl91dGlsIiwicmVxdWlyZSIsIl9ydWJiZXJCYW5kRGVjYXkiLCJfdXRpbHMiLCJfcmlnaWREZWNheSIsInZhbGlkYXRlQ29uZmlnIiwiY29uZmlnIiwiY2xhbXAiLCJBcnJheSIsImlzQXJyYXkiLCJFcnJvciIsImxlbmd0aCIsInZlbG9jaXR5RmFjdG9yIiwicnViYmVyQmFuZEVmZmVjdCIsInVzZXJDb25maWciLCJjYWxsYmFjayIsImRlZmluZUFuaW1hdGlvbiIsIl9jb25maWckdmVsb2NpdHkiLCJkZWNlbGVyYXRpb24iLCJ2ZWxvY2l0eSIsInJ1YmJlckJhbmRGYWN0b3IiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsImRlY2F5IiwiaXNWYWxpZFJ1YmJlckJhbmRDb25maWciLCJhbmltYXRpb24iLCJub3ciLCJydWJiZXJCYW5kRGVjYXkiLCJyaWdpZERlY2F5Iiwib25TdGFydCIsImN1cnJlbnQiLCJsYXN0VGltZXN0YW1wIiwic3RhcnRUaW1lc3RhbXAiLCJpbml0aWFsVmVsb2NpdHkiLCJyZWR1Y2VNb3Rpb24iLCJvbkZyYW1lIiwiZ2V0UmVkdWNlTW90aW9uRm9yQW5pbWF0aW9uIl0sInNvdXJjZXMiOlsiZGVjYXkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgZGVmaW5lQW5pbWF0aW9uLCBnZXRSZWR1Y2VNb3Rpb25Gb3JBbmltYXRpb24gfSBmcm9tICcuLi91dGlsJztcbmltcG9ydCB0eXBlIHtcbiAgQW5pbWF0aW9uQ2FsbGJhY2ssXG4gIFRpbWVzdGFtcCxcbiAgQW5pbWF0aW9uLFxufSBmcm9tICcuLi8uLi9jb21tb25UeXBlcyc7XG5pbXBvcnQgeyBydWJiZXJCYW5kRGVjYXkgfSBmcm9tICcuL3J1YmJlckJhbmREZWNheSc7XG5pbXBvcnQgeyBpc1ZhbGlkUnViYmVyQmFuZENvbmZpZyB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHR5cGUge1xuICBEZWNheUFuaW1hdGlvbixcbiAgRGVjYXlDb25maWcsXG4gIERlZmF1bHREZWNheUNvbmZpZyxcbiAgSW5uZXJEZWNheUFuaW1hdGlvbixcbn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyByaWdpZERlY2F5IH0gZnJvbSAnLi9yaWdpZERlY2F5JztcblxuZXhwb3J0IHR5cGUgV2l0aERlY2F5Q29uZmlnID0gRGVjYXlDb25maWc7XG5cbi8vIFRPRE8gVFlQRVNDUklQVCBUaGlzIGlzIGEgdGVtcG9yYXJ5IHR5cGUgdG8gZ2V0IHJpZCBvZiAuZC50cyBmaWxlLlxudHlwZSB3aXRoRGVjYXlUeXBlID0gKFxuICB1c2VyQ29uZmlnOiBEZWNheUNvbmZpZyxcbiAgY2FsbGJhY2s/OiBBbmltYXRpb25DYWxsYmFja1xuKSA9PiBudW1iZXI7XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQ29uZmlnKGNvbmZpZzogRGVmYXVsdERlY2F5Q29uZmlnKTogdm9pZCB7XG4gICd3b3JrbGV0JztcbiAgaWYgKGNvbmZpZy5jbGFtcCkge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWcuY2xhbXApKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBbUmVhbmltYXRlZF0gXFxgY29uZmlnLmNsYW1wXFxgIG11c3QgYmUgYW4gYXJyYXkgYnV0IGlzICR7dHlwZW9mIGNvbmZpZy5jbGFtcH0uYFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5jbGFtcC5sZW5ndGggIT09IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFtSZWFuaW1hdGVkXSBcXGBjbGFtcCBhcnJheVxcYCBtdXN0IGNvbnRhaW4gMiBpdGVtcyBidXQgaXMgZ2l2ZW4gJHtcbiAgICAgICAgICBjb25maWcuY2xhbXAubGVuZ3RoIGFzIG51bWJlclxuICAgICAgICB9LmBcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGlmIChjb25maWcudmVsb2NpdHlGYWN0b3IgPD0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBbUmVhbmltYXRlZF0gXFxgY29uZmlnLnZlbG9jaXR5RmFjdG9yXFxgIG11c3QgYmUgZ3JlYXRoZXIgdGhlbiAwIGJ1dCBpcyAke2NvbmZpZy52ZWxvY2l0eUZhY3Rvcn0uYFxuICAgICk7XG4gIH1cbiAgaWYgKGNvbmZpZy5ydWJiZXJCYW5kRWZmZWN0ICYmICFjb25maWcuY2xhbXApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnW1JlYW5pbWF0ZWRdIFlvdSBuZWVkIHRvIHNldCBgY2xhbXBgIHByb3BlcnR5IHdoZW4gdXNpbmcgYHJ1YmJlckJhbmRFZmZlY3RgLidcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogTGV0cyB5b3UgY3JlYXRlIGFuaW1hdGlvbnMgdGhhdCBtaW1pYyBvYmplY3RzIGluIG1vdGlvbiB3aXRoIGZyaWN0aW9uLlxuICpcbiAqIEBwYXJhbSBjb25maWcgLSBUaGUgZGVjYXkgYW5pbWF0aW9uIGNvbmZpZ3VyYXRpb24gLSB7QGxpbmsgRGVjYXlDb25maWd9LlxuICogQHBhcmFtIGNhbGxiYWNrIC0gQSBmdW5jdGlvbiBjYWxsZWQgdXBvbiBhbmltYXRpb24gY29tcGxldGlvbiAtIHtAbGluayBBbmltYXRpb25DYWxsYmFja30uXG4gKiBAcmV0dXJucyBBbiBbYW5pbWF0aW9uIG9iamVjdF0oaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9mdW5kYW1lbnRhbHMvZ2xvc3NhcnkjYW5pbWF0aW9uLW9iamVjdCkgd2hpY2ggaG9sZHMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGFuaW1hdGlvbi5cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9hbmltYXRpb25zL3dpdGhEZWNheVxuICovXG5leHBvcnQgY29uc3Qgd2l0aERlY2F5ID0gZnVuY3Rpb24gKFxuICB1c2VyQ29uZmlnOiBEZWNheUNvbmZpZyxcbiAgY2FsbGJhY2s/OiBBbmltYXRpb25DYWxsYmFja1xuKTogQW5pbWF0aW9uPERlY2F5QW5pbWF0aW9uPiB7XG4gICd3b3JrbGV0JztcblxuICByZXR1cm4gZGVmaW5lQW5pbWF0aW9uPERlY2F5QW5pbWF0aW9uPigwLCAoKSA9PiB7XG4gICAgJ3dvcmtsZXQnO1xuICAgIGNvbnN0IGNvbmZpZzogRGVmYXVsdERlY2F5Q29uZmlnID0ge1xuICAgICAgZGVjZWxlcmF0aW9uOiAwLjk5OCxcbiAgICAgIHZlbG9jaXR5RmFjdG9yOiAxLFxuICAgICAgdmVsb2NpdHk6IDAsXG4gICAgICBydWJiZXJCYW5kRmFjdG9yOiAwLjYsXG4gICAgfTtcbiAgICBpZiAodXNlckNvbmZpZykge1xuICAgICAgT2JqZWN0LmtleXModXNlckNvbmZpZykuZm9yRWFjaChcbiAgICAgICAgKGtleSkgPT5cbiAgICAgICAgICAoKGNvbmZpZyBhcyBhbnkpW2tleV0gPSB1c2VyQ29uZmlnW2tleSBhcyBrZXlvZiB0eXBlb2YgdXNlckNvbmZpZ10pXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGRlY2F5OiAoYW5pbWF0aW9uOiBJbm5lckRlY2F5QW5pbWF0aW9uLCBub3c6IG51bWJlcikgPT4gYm9vbGVhbiA9XG4gICAgICBpc1ZhbGlkUnViYmVyQmFuZENvbmZpZyhjb25maWcpXG4gICAgICAgID8gKGFuaW1hdGlvbiwgbm93KSA9PiBydWJiZXJCYW5kRGVjYXkoYW5pbWF0aW9uLCBub3csIGNvbmZpZylcbiAgICAgICAgOiAoYW5pbWF0aW9uLCBub3cpID0+IHJpZ2lkRGVjYXkoYW5pbWF0aW9uLCBub3csIGNvbmZpZyk7XG5cbiAgICBmdW5jdGlvbiBvblN0YXJ0KFxuICAgICAgYW5pbWF0aW9uOiBEZWNheUFuaW1hdGlvbixcbiAgICAgIHZhbHVlOiBudW1iZXIsXG4gICAgICBub3c6IFRpbWVzdGFtcFxuICAgICk6IHZvaWQge1xuICAgICAgYW5pbWF0aW9uLmN1cnJlbnQgPSB2YWx1ZTtcbiAgICAgIGFuaW1hdGlvbi5sYXN0VGltZXN0YW1wID0gbm93O1xuICAgICAgYW5pbWF0aW9uLnN0YXJ0VGltZXN0YW1wID0gbm93O1xuICAgICAgYW5pbWF0aW9uLmluaXRpYWxWZWxvY2l0eSA9IGNvbmZpZy52ZWxvY2l0eTtcbiAgICAgIHZhbGlkYXRlQ29uZmlnKGNvbmZpZyk7XG5cbiAgICAgIGlmIChhbmltYXRpb24ucmVkdWNlTW90aW9uICYmIGNvbmZpZy5jbGFtcCkge1xuICAgICAgICBpZiAodmFsdWUgPCBjb25maWcuY2xhbXBbMF0pIHtcbiAgICAgICAgICBhbmltYXRpb24uY3VycmVudCA9IGNvbmZpZy5jbGFtcFswXTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+IGNvbmZpZy5jbGFtcFsxXSkge1xuICAgICAgICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gY29uZmlnLmNsYW1wWzFdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG9uRnJhbWU6IGRlY2F5LFxuICAgICAgb25TdGFydCxcbiAgICAgIGNhbGxiYWNrLFxuICAgICAgdmVsb2NpdHk6IGNvbmZpZy52ZWxvY2l0eSA/PyAwLFxuICAgICAgaW5pdGlhbFZlbG9jaXR5OiAwLFxuICAgICAgY3VycmVudDogMCxcbiAgICAgIGxhc3RUaW1lc3RhbXA6IDAsXG4gICAgICBzdGFydFRpbWVzdGFtcDogMCxcbiAgICAgIHJlZHVjZU1vdGlvbjogZ2V0UmVkdWNlTW90aW9uRm9yQW5pbWF0aW9uKGNvbmZpZy5yZWR1Y2VNb3Rpb24pLFxuICAgIH0gYXMgRGVjYXlBbmltYXRpb247XG4gIH0pO1xufSBhcyB1bmtub3duIGFzIHdpdGhEZWNheVR5cGU7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUNBLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLFNBQUE7QUFDYixJQUFBQyxLQUFBLEdBQUFD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