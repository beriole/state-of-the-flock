de628c62d0606e5770ac9cda17885157
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.valueSetter = valueSetter;
function valueSetter(mutable, value) {
  'worklet';

  var forceUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var previousAnimation = mutable._animation;
  if (previousAnimation) {
    previousAnimation.cancelled = true;
    mutable._animation = null;
  }
  if (typeof value === 'function' || value !== null && typeof value === 'object' && value.onFrame !== undefined) {
    var animation = typeof value === 'function' ? value() : value;
    if (mutable._value === animation.current && !animation.isHigherOrder && !forceUpdate) {
      animation.callback && animation.callback(true);
      return;
    }
    var initializeAnimation = function initializeAnimation(timestamp) {
      animation.onStart(animation, mutable.value, timestamp, previousAnimation);
    };
    var currentTimestamp = global.__frameTimestamp || global._getAnimationTimestamp();
    initializeAnimation(currentTimestamp);
    var _step = function step(newTimestamp) {
      var timestamp = newTimestamp < (animation.timestamp || 0) ? animation.timestamp : newTimestamp;
      if (animation.cancelled) {
        animation.callback && animation.callback(false);
        return;
      }
      var finished = animation.onFrame(animation, timestamp);
      animation.finished = true;
      animation.timestamp = timestamp;
      mutable._value = animation.current;
      if (finished) {
        animation.callback && animation.callback(true);
      } else {
        requestAnimationFrame(_step);
      }
    };
    mutable._animation = animation;
    _step(currentTimestamp);
  } else {
    if (mutable._value === value && !forceUpdate) {
      return;
    }
    mutable._value = value;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInZhbHVlU2V0dGVyIiwibXV0YWJsZSIsImZvcmNlVXBkYXRlIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwicHJldmlvdXNBbmltYXRpb24iLCJfYW5pbWF0aW9uIiwiY2FuY2VsbGVkIiwib25GcmFtZSIsImFuaW1hdGlvbiIsIl92YWx1ZSIsImN1cnJlbnQiLCJpc0hpZ2hlck9yZGVyIiwiY2FsbGJhY2siLCJpbml0aWFsaXplQW5pbWF0aW9uIiwidGltZXN0YW1wIiwib25TdGFydCIsImN1cnJlbnRUaW1lc3RhbXAiLCJnbG9iYWwiLCJfX2ZyYW1lVGltZXN0YW1wIiwiX2dldEFuaW1hdGlvblRpbWVzdGFtcCIsInN0ZXAiLCJuZXdUaW1lc3RhbXAiLCJmaW5pc2hlZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSJdLCJzb3VyY2VzIjpbInZhbHVlU2V0dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB0eXBlIHsgQW5pbWF0aW9uT2JqZWN0LCBNdXRhYmxlIH0gZnJvbSAnLi9jb21tb25UeXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWx1ZVNldHRlcjxWYWx1ZT4oXG4gIG11dGFibGU6IE11dGFibGU8VmFsdWU+LFxuICB2YWx1ZTogVmFsdWUsXG4gIGZvcmNlVXBkYXRlID0gZmFsc2Vcbik6IHZvaWQge1xuICAnd29ya2xldCc7XG4gIGNvbnN0IHByZXZpb3VzQW5pbWF0aW9uID0gbXV0YWJsZS5fYW5pbWF0aW9uO1xuICBpZiAocHJldmlvdXNBbmltYXRpb24pIHtcbiAgICBwcmV2aW91c0FuaW1hdGlvbi5jYW5jZWxsZWQgPSB0cnVlO1xuICAgIG11dGFibGUuX2FuaW1hdGlvbiA9IG51bGw7XG4gIH1cbiAgaWYgKFxuICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyB8fFxuICAgICh2YWx1ZSAhPT0gbnVsbCAmJlxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgICAgLy8gVE9ETyBUWVBFU0NSSVBUIGZpeCB0aGlzIGFmdGVyIGZpeGluZyBBbmltYXRpb25PYmplY3QgdHlwZVxuICAgICAgKHZhbHVlIGFzIHVua25vd24gYXMgQW5pbWF0aW9uT2JqZWN0KS5vbkZyYW1lICE9PSB1bmRlZmluZWQpXG4gICkge1xuICAgIGNvbnN0IGFuaW1hdGlvbjogQW5pbWF0aW9uT2JqZWN0PFZhbHVlPiA9XG4gICAgICB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyAvLyBUT0RPIFRZUEVTQ1JJUFQgZml4IHRoaXMgYWZ0ZXIgZml4aW5nIEFuaW1hdGlvbk9iamVjdCB0eXBlXG4gICAgICAgICAgKHZhbHVlIGFzICgpID0+IEFuaW1hdGlvbk9iamVjdDxWYWx1ZT4pKClcbiAgICAgICAgOiAvLyBUT0RPIFRZUEVTQ1JJUFQgZml4IHRoaXMgYWZ0ZXIgZml4aW5nIEFuaW1hdGlvbk9iamVjdCB0eXBlXG4gICAgICAgICAgKHZhbHVlIGFzIHVua25vd24gYXMgQW5pbWF0aW9uT2JqZWN0PFZhbHVlPik7XG4gICAgLy8gcHJldmVudCBzZXR0aW5nIGFnYWluIHRvIHRoZSBzYW1lIHZhbHVlXG4gICAgLy8gYW5kIHRyaWdnZXJpbmcgdGhlIG1hcHBlcnMgdGhhdCB0cmVhdCB0aGlzIHZhbHVlIGFzIGFuIGlucHV0XG4gICAgLy8gdGhpcyBoYXBwZW5zIHdoZW4gdGhlIGFuaW1hdGlvbidzIHRhcmdldCB2YWx1ZShzdG9yZWQgaW4gYW5pbWF0aW9uLmN1cnJlbnQgdW50aWwgYW5pbWF0aW9uLm9uU3RhcnQgaXMgY2FsbGVkKSBpcyBzZXQgdG8gdGhlIHNhbWUgdmFsdWUgYXMgYSBjdXJyZW50IG9uZSh0aGlzLl92YWx1ZSlcbiAgICAvLyBidWlsdCBpbiBhbmltYXRpb25zIHRoYXQgYXJlIG5vdCBoaWdoZXIgb3JkZXIod2l0aFRpbWluZywgd2l0aFNwcmluZykgaG9sZCB0YXJnZXQgdmFsdWUgaW4gLmN1cnJlbnRcbiAgICBpZiAoXG4gICAgICBtdXRhYmxlLl92YWx1ZSA9PT0gYW5pbWF0aW9uLmN1cnJlbnQgJiZcbiAgICAgICFhbmltYXRpb24uaXNIaWdoZXJPcmRlciAmJlxuICAgICAgIWZvcmNlVXBkYXRlXG4gICAgKSB7XG4gICAgICBhbmltYXRpb24uY2FsbGJhY2sgJiYgYW5pbWF0aW9uLmNhbGxiYWNrKHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBhbmltYXRlZCBzZXRcbiAgICBjb25zdCBpbml0aWFsaXplQW5pbWF0aW9uID0gKHRpbWVzdGFtcDogbnVtYmVyKSA9PiB7XG4gICAgICBhbmltYXRpb24ub25TdGFydChhbmltYXRpb24sIG11dGFibGUudmFsdWUsIHRpbWVzdGFtcCwgcHJldmlvdXNBbmltYXRpb24pO1xuICAgIH07XG4gICAgY29uc3QgY3VycmVudFRpbWVzdGFtcCA9XG4gICAgICBnbG9iYWwuX19mcmFtZVRpbWVzdGFtcCB8fCBnbG9iYWwuX2dldEFuaW1hdGlvblRpbWVzdGFtcCgpO1xuICAgIGluaXRpYWxpemVBbmltYXRpb24oY3VycmVudFRpbWVzdGFtcCk7XG5cbiAgICBjb25zdCBzdGVwID0gKG5ld1RpbWVzdGFtcDogbnVtYmVyKSA9PiB7XG4gICAgICAvLyBGdW5jdGlvbiBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBhZGRzIGNhbGxiYWNrIHRvIGFuIGFycmF5LCBhbGwgdGhlIGNhbGxiYWNrcyBhcmUgZmx1c2hlZCB3aXRoIGZ1bmN0aW9uIGBfX2ZsdXNoQW5pbWF0aW9uRnJhbWVgXG4gICAgICAvLyBVc3VhbGx5IHdlIGZsdXNoIHRoZW0gaW5zaWRlIGZ1bmN0aW9uIGBuYXRpdmVSZXF1ZXN0QW5pbWF0aW9uRnJhbWVgIGFuZCB0aGVuIHRoZSBnaXZlbiB0aW1lc3RhbXAgaXMgdGhlIHRpbWVzdGFtcCBvZiBlbmQgb2YgdGhlIGN1cnJlbnQgZnJhbWUuXG4gICAgICAvLyBIb3dldmVyIGZ1bmN0aW9uIGBfX2ZsdXNoQW5pbWF0aW9uRnJhbWVgIG1heSBhbHNvIGJlIGNhbGxlZCBpbnNpZGUgYHJlZ2lzdGVyRXZlbnRIYW5kbGVyYCAtIHRoZW4gd2UgZ2V0IGFjdHVhbCB0aW1lc3RhbXAgd2hpY2ggaXMgZWFybGllciB0aGFuIHRoZSBlbmQgb2YgdGhlIGZyYW1lLlxuXG4gICAgICBjb25zdCB0aW1lc3RhbXAgPVxuICAgICAgICBuZXdUaW1lc3RhbXAgPCAoYW5pbWF0aW9uLnRpbWVzdGFtcCB8fCAwKVxuICAgICAgICAgID8gYW5pbWF0aW9uLnRpbWVzdGFtcFxuICAgICAgICAgIDogbmV3VGltZXN0YW1wO1xuXG4gICAgICBpZiAoYW5pbWF0aW9uLmNhbmNlbGxlZCkge1xuICAgICAgICBhbmltYXRpb24uY2FsbGJhY2sgJiYgYW5pbWF0aW9uLmNhbGxiYWNrKGZhbHNlIC8qIGZpbmlzaGVkICovKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZmluaXNoZWQgPSBhbmltYXRpb24ub25GcmFtZShhbmltYXRpb24sIHRpbWVzdGFtcCk7XG4gICAgICBhbmltYXRpb24uZmluaXNoZWQgPSB0cnVlO1xuICAgICAgYW5pbWF0aW9uLnRpbWVzdGFtcCA9IHRpbWVzdGFtcDtcbiAgICAgIC8vIFRPRE8gVFlQRVNDUklQVFxuICAgICAgLy8gRm9yIG5vdyBJJ2xsIGFzc3VtZSB0aGF0IGBhbmltYXRpb24uY3VycmVudGAgaXMgYWx3YXlzIGRlZmluZWRcbiAgICAgIC8vIGJ1dCBhY3R1YWxseSBuZWVkIHRvIGRpdmUgaW50byBhbmltYXRpb25zIHRvIHVuZGVyc3RhbmQgaXRcbiAgICAgIG11dGFibGUuX3ZhbHVlID0gYW5pbWF0aW9uLmN1cnJlbnQhO1xuICAgICAgaWYgKGZpbmlzaGVkKSB7XG4gICAgICAgIGFuaW1hdGlvbi5jYWxsYmFjayAmJiBhbmltYXRpb24uY2FsbGJhY2sodHJ1ZSAvKiBmaW5pc2hlZCAqLyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIG11dGFibGUuX2FuaW1hdGlvbiA9IGFuaW1hdGlvbjtcblxuICAgIHN0ZXAoY3VycmVudFRpbWVzdGFtcCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gcHJldmVudCBzZXR0aW5nIGFnYWluIHRvIHRoZSBzYW1lIHZhbHVlXG4gICAgLy8gYW5kIHRyaWdnZXJpbmcgdGhlIG1hcHBlcnMgdGhhdCB0cmVhdCB0aGlzIHZhbHVlIGFzIGFuIGlucHV0XG4gICAgaWYgKG11dGFibGUuX3ZhbHVlID09PSB2YWx1ZSAmJiAhZm9yY2VVcGRhdGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbXV0YWJsZS5fdmFsdWUgPSB2YWx1ZTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFBQSxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxXQUFBLEdBQUFBLFdBQUE7QUFHTCxTQUFTQSxXQUFXQSxDQUN6QkMsT0FBdUIsRUFDdkJGLEtBQVksRUFFTjtFQUNOLFNBQVM7O0VBQUEsSUFGVEcsV0FBVyxHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxLQUFLO0VBR25CLElBQU1HLGlCQUFpQixHQUFHTCxPQUFPLENBQUNNLFVBQVU7RUFDNUMsSUFBSUQsaUJBQWlCLEVBQUU7SUFDckJBLGlCQUFpQixDQUFDRSxTQUFTLEdBQUcsSUFBSTtJQUNsQ1AsT0FBTyxDQUFDTSxVQUFVLEdBQUcsSUFBSTtFQUMzQjtFQUNBLElBQ0UsT0FBT1IsS0FBSyxLQUFLLFVBQVUsSUFDMUJBLEtBQUssS0FBSyxJQUFJLElBQ2IsT0FBT0EsS0FBSyxLQUFLLFFBQVEsSUFFeEJBLEtBQUssQ0FBZ0NVLE9BQU8sS0FBS0osU0FBVSxFQUM5RDtJQUNBLElBQU1LLFNBQWlDLEdBQ3JDLE9BQU9YLEtBQUssS0FBSyxVQUFVLEdBRXRCQSxLQUFLLENBQWtDLENBQUMsR0FFeENBLEtBQTJDO0lBS2xELElBQ0VFLE9BQU8sQ0FBQ1UsTUFBTSxLQUFLRCxTQUFTLENBQUNFLE9BQU8sSUFDcEMsQ0FBQ0YsU0FBUyxDQUFDRyxhQUFhLElBQ3hCLENBQUNYLFdBQVcsRUFDWjtNQUNBUSxTQUFTLENBQUNJLFFBQVEsSUFBSUosU0FBUyxDQUFDSSxRQUFRLENBQUMsSUFBSSxDQUFDO01BQzlDO0lBQ0Y7SUFFQSxJQUFNQyxtQkFBbUIsR0FBSSxTQUF2QkEsbUJBQW1CQSxDQUFJQyxTQUFpQixFQUFLO01BQ2pETixTQUFTLENBQUNPLE9BQU8sQ0FBQ1AsU0FBUyxFQUFFVCxPQUFPLENBQUNGLEtBQUssRUFBRWlCLFNBQVMsRUFBRVYsaUJBQWlCLENBQUM7SUFDM0UsQ0FBQztJQUNELElBQU1ZLGdCQUFnQixHQUNwQkMsTUFBTSxDQUFDQyxnQkFBZ0IsSUFBSUQsTUFBTSxDQUFDRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQzVETixtQkFBbUIsQ0FBQ0csZ0JBQWdCLENBQUM7SUFFckMsSUFBTUksS0FBSSxHQUFJLFNBQVJBLElBQUlBLENBQUlDLFlBQW9CLEVBQUs7TUFLckMsSUFBTVAsU0FBUyxHQUNiTyxZQUFZLElBQUliLFNBQVMsQ0FBQ00sU0FBUyxJQUFJLENBQUMsQ0FBQyxHQUNyQ04sU0FBUyxDQUFDTSxTQUFTLEdBQ25CTyxZQUFZO01BRWxCLElBQUliLFNBQVMsQ0FBQ0YsU0FBUyxFQUFFO1FBQ3ZCRSxTQUFTLENBQUNJLFFBQVEsSUFBSUosU0FBUyxDQUFDSSxRQUFRLENBQUMsS0FBb0IsQ0FBQztRQUM5RDtNQUNGO01BQ0EsSUFBTVUsUUFBUSxHQUFHZCxTQUFTLENBQUNELE9BQU8sQ0FBQ0MsU0FBUyxFQUFFTSxTQUFTLENBQUM7TUFDeEROLFNBQVMsQ0FBQ2MsUUFBUSxHQUFHLElBQUk7TUFDekJkLFNBQVMsQ0FBQ00sU0FBUyxHQUFHQSxTQUFTO01BSS9CZixPQUFPLENBQUNVLE1BQU0sR0FBR0QsU0FBUyxDQUFDRSxPQUFRO01BQ25DLElBQUlZLFFBQVEsRUFBRTtRQUNaZCxTQUFTLENBQUNJLFFBQVEsSUFBSUosU0FBUyxDQUFDSSxRQUFRLENBQUMsSUFBbUIsQ0FBQztNQUMvRCxDQUFDLE1BQU07UUFDTFcscUJBQXFCLENBQUNILEtBQUksQ0FBQztNQUM3QjtJQUNGLENBQUM7SUFFRHJCLE9BQU8sQ0FBQ00sVUFBVSxHQUFHRyxTQUFTO0lBRTlCWSxLQUFJLENBQUNKLGdCQUFnQixDQUFDO0VBQ3hCLENBQUMsTUFBTTtJQUdMLElBQUlqQixPQUFPLENBQUNVLE1BQU0sS0FBS1osS0FBSyxJQUFJLENBQUNHLFdBQVcsRUFBRTtNQUM1QztJQUNGO0lBQ0FELE9BQU8sQ0FBQ1UsTUFBTSxHQUFHWixLQUFLO0VBQ3hCO0FBQ0YiLCJpZ25vcmVMaXN0IjpbXX0=