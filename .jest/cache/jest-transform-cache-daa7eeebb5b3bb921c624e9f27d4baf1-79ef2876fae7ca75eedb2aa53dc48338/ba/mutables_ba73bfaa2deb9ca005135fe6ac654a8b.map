{"version":3,"names":["Object","defineProperty","exports","value","makeMutable","makeMutableUI","_PlatformChecker","require","_shareableMappingCache","_shareables","_threads","_valueSetter","SHOULD_BE_USE_WEB","shouldBeUseWeb","initial","listeners","Map","mutable","newValue","valueSetter","_value","forEach","listener","modify","modifier","forceUpdate","arguments","length","undefined","addListener","id","set","removeListener","delete","_animation","_isReanimatedSharedValue","makeMutableNative","handle","makeShareableCloneRecursive","__init","uiValueGetter","executeOnUIRuntimeSync","sv","runOnUI","Error","_newValue","shareableMappingCache","makeMutableWeb"],"sources":["mutables.ts"],"sourcesContent":["'use strict';\nimport { shouldBeUseWeb } from './PlatformChecker';\nimport type { Mutable } from './commonTypes';\nimport { shareableMappingCache } from './shareableMappingCache';\nimport { makeShareableCloneRecursive } from './shareables';\nimport { executeOnUIRuntimeSync, runOnUI } from './threads';\nimport { valueSetter } from './valueSetter';\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\ntype Listener<Value> = (newValue: Value) => void;\n\nexport function makeMutableUI<Value>(initial: Value): Mutable<Value> {\n  'worklet';\n  const listeners = new Map<number, Listener<Value>>();\n  let value = initial;\n\n  const mutable: Mutable<Value> = {\n    get value() {\n      return value;\n    },\n    set value(newValue) {\n      valueSetter(mutable, newValue);\n    },\n\n    /**\n     * _value prop should only be accessed by the valueSetter implementation\n     * which may make the decision about updating the mutable value depending\n     * on the provided new value. All other places should only attempt to modify\n     * the mutable by assigning to value prop directly.\n     */\n    get _value(): Value {\n      return value;\n    },\n    set _value(newValue: Value) {\n      value = newValue;\n      listeners.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n\n    modify: (modifier, forceUpdate = true) => {\n      valueSetter(\n        mutable,\n        modifier !== undefined ? modifier(value) : value,\n        forceUpdate\n      );\n    },\n    addListener: (id: number, listener: Listener<Value>) => {\n      listeners.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      listeners.delete(id);\n    },\n\n    _animation: null,\n    _isReanimatedSharedValue: true,\n  };\n  return mutable;\n}\n\nfunction makeMutableNative<Value>(initial: Value): Mutable<Value> {\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return makeMutableUI(initial);\n    },\n  });\n\n  const mutable: Mutable<Value> = {\n    get value(): Value {\n      const uiValueGetter = executeOnUIRuntimeSync((sv: Mutable<Value>) => {\n        return sv.value;\n      });\n      return uiValueGetter(mutable);\n    },\n    set value(newValue) {\n      runOnUI(() => {\n        mutable.value = newValue;\n      })();\n    },\n\n    get _value(): Value {\n      throw new Error(\n        '[Reanimated] Reading from `_value` directly is only possible on the UI runtime. Perhaps you passed an Animated Style to a non-animated component?'\n      );\n    },\n    set _value(_newValue: Value) {\n      throw new Error(\n        '[Reanimated] Setting `_value` directly is only possible on the UI runtime. Perhaps you want to assign to `value` instead?'\n      );\n    },\n\n    modify: (modifier, forceUpdate = true) => {\n      runOnUI(() => {\n        mutable.modify(modifier, forceUpdate);\n      })();\n    },\n    addListener: () => {\n      throw new Error(\n        '[Reanimated] Adding listeners is only possible on the UI runtime.'\n      );\n    },\n    removeListener: () => {\n      throw new Error(\n        '[Reanimated] Removing listeners is only possible on the UI runtime.'\n      );\n    },\n\n    _isReanimatedSharedValue: true,\n  };\n\n  shareableMappingCache.set(mutable, handle);\n  return mutable;\n}\n\nfunction makeMutableWeb<Value>(initial: Value): Mutable<Value> {\n  let value: Value = initial;\n  const listeners = new Map<number, Listener<Value>>();\n\n  const mutable: Mutable<Value> = {\n    get value(): Value {\n      return value;\n    },\n    set value(newValue) {\n      valueSetter(mutable, newValue);\n    },\n\n    get _value(): Value {\n      return value;\n    },\n    set _value(newValue: Value) {\n      value = newValue;\n      listeners.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n\n    modify: (modifier, forceUpdate = true) => {\n      valueSetter(\n        mutable,\n        modifier !== undefined ? modifier(mutable.value) : mutable.value,\n        forceUpdate\n      );\n    },\n    addListener: (id: number, listener: Listener<Value>) => {\n      listeners.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      listeners.delete(id);\n    },\n\n    _isReanimatedSharedValue: true,\n  };\n\n  return mutable;\n}\n\nexport const makeMutable = SHOULD_BE_USE_WEB\n  ? makeMutableWeb\n  : makeMutableNative;\n"],"mappings":"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","ignoreList":[]}