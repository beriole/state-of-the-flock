d2ce7d941488f278bdd2bb266b5c0a9a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.InlinePropManager = void 0;
exports.getInlineStyle = getInlineStyle;
exports.hasInlineStyles = hasInlineStyles;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _utils = require("./utils");
var _ViewDescriptorsSet = require("../ViewDescriptorsSet");
var _ConfigHelper = require("../ConfigHelper");
var _UpdateProps = _interopRequireDefault(require("../UpdateProps"));
var _mappers = require("../mappers");
var _isSharedValue = require("../isSharedValue");
function _defineProperty(obj, key, value) {
  key = _toPropertyKey(key);
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
function _toPropertyKey(t) {
  var i = _toPrimitive(t, "string");
  return "symbol" == typeof i ? i : i + "";
}
function _toPrimitive(t, r) {
  if ("object" != typeof t || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r || "default");
    if ("object" != typeof i) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return ("string" === r ? String : Number)(t);
}
function isInlineStyleTransform(transform) {
  if (!Array.isArray(transform)) {
    return false;
  }
  return transform.some(function (t) {
    return hasInlineStyles(t);
  });
}
function inlinePropsHasChanged(styles1, styles2) {
  if (Object.keys(styles1).length !== Object.keys(styles2).length) {
    return true;
  }
  for (var key of Object.keys(styles1)) {
    if (styles1[key] !== styles2[key]) {
      return true;
    }
  }
  return false;
}
function getInlinePropsUpdate(inlineProps) {
  'worklet';

  var update = {};
  for (var _ref of Object.entries(inlineProps)) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
    var key = _ref2[0];
    var styleValue = _ref2[1];
    if ((0, _isSharedValue.isSharedValue)(styleValue)) {
      update[key] = styleValue.value;
    } else if (Array.isArray(styleValue)) {
      update[key] = styleValue.map(function (item) {
        return getInlinePropsUpdate(item);
      });
    } else if (typeof styleValue === 'object') {
      update[key] = getInlinePropsUpdate(styleValue);
    } else {
      update[key] = styleValue;
    }
  }
  return update;
}
function extractSharedValuesMapFromProps(props) {
  var inlineProps = {};
  for (var key in props) {
    var value = props[key];
    if (key === 'style') {
      var _props$style;
      var styles = (0, _utils.flattenArray)((_props$style = props.style) != null ? _props$style : []);
      styles.forEach(function (style) {
        if (!style) {
          return;
        }
        for (var _ref3 of Object.entries(style)) {
          var _ref4 = (0, _slicedToArray2.default)(_ref3, 2);
          var styleKey = _ref4[0];
          var styleValue = _ref4[1];
          if ((0, _isSharedValue.isSharedValue)(styleValue)) {
            inlineProps[styleKey] = styleValue;
          } else if (styleKey === 'transform' && isInlineStyleTransform(styleValue)) {
            inlineProps[styleKey] = styleValue;
          }
        }
      });
    } else if ((0, _isSharedValue.isSharedValue)(value)) {
      inlineProps[key] = value;
    }
  }
  return inlineProps;
}
function hasInlineStyles(style) {
  if (!style) {
    return false;
  }
  return Object.keys(style).some(function (key) {
    var styleValue = style[key];
    return (0, _isSharedValue.isSharedValue)(styleValue) || key === 'transform' && isInlineStyleTransform(styleValue);
  });
}
function getInlineStyle(style, isFirstRender) {
  if (isFirstRender) {
    return getInlinePropsUpdate(style);
  }
  var newStyle = {};
  for (var _ref5 of Object.entries(style)) {
    var _ref6 = (0, _slicedToArray2.default)(_ref5, 2);
    var key = _ref6[0];
    var styleValue = _ref6[1];
    if (!(0, _isSharedValue.isSharedValue)(styleValue) && !(key === 'transform' && isInlineStyleTransform(styleValue))) {
      newStyle[key] = styleValue;
    }
  }
  return newStyle;
}
var InlinePropManager = exports.InlinePropManager = function () {
  function InlinePropManager() {
    (0, _classCallCheck2.default)(this, InlinePropManager);
    _defineProperty(this, "_inlinePropsViewDescriptors", null);
    _defineProperty(this, "_inlinePropsMapperId", null);
    _defineProperty(this, "_inlineProps", {});
  }
  return (0, _createClass2.default)(InlinePropManager, [{
    key: "attachInlineProps",
    value: function attachInlineProps(animatedComponent, viewInfo) {
      var newInlineProps = extractSharedValuesMapFromProps(animatedComponent.props);
      var hasChanged = inlinePropsHasChanged(newInlineProps, this._inlineProps);
      if (hasChanged) {
        if (!this._inlinePropsViewDescriptors) {
          this._inlinePropsViewDescriptors = (0, _ViewDescriptorsSet.makeViewDescriptorsSet)();
          var viewTag = viewInfo.viewTag,
            viewName = viewInfo.viewName,
            shadowNodeWrapper = viewInfo.shadowNodeWrapper,
            viewConfig = viewInfo.viewConfig;
          if (Object.keys(newInlineProps).length && viewConfig) {
            (0, _ConfigHelper.adaptViewConfig)(viewConfig);
          }
          this._inlinePropsViewDescriptors.add({
            tag: viewTag,
            name: viewName,
            shadowNodeWrapper: shadowNodeWrapper
          });
        }
        var shareableViewDescriptors = this._inlinePropsViewDescriptors.shareableViewDescriptors;
        var updaterFunction = function updaterFunction() {
          'worklet';

          var update = getInlinePropsUpdate(newInlineProps);
          (0, _UpdateProps.default)(shareableViewDescriptors, update);
        };
        this._inlineProps = newInlineProps;
        if (this._inlinePropsMapperId) {
          (0, _mappers.stopMapper)(this._inlinePropsMapperId);
        }
        this._inlinePropsMapperId = null;
        if (Object.keys(newInlineProps).length) {
          this._inlinePropsMapperId = (0, _mappers.startMapper)(updaterFunction, Object.values(newInlineProps));
        }
      }
    }
  }, {
    key: "detachInlineProps",
    value: function detachInlineProps() {
      if (this._inlinePropsMapperId) {
        (0, _mappers.stopMapper)(this._inlinePropsMapperId);
      }
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiSW5saW5lUHJvcE1hbmFnZXIiLCJnZXRJbmxpbmVTdHlsZSIsImhhc0lubGluZVN0eWxlcyIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX3NsaWNlZFRvQXJyYXkyIiwiX3V0aWxzIiwiX1ZpZXdEZXNjcmlwdG9yc1NldCIsIl9Db25maWdIZWxwZXIiLCJfVXBkYXRlUHJvcHMiLCJfbWFwcGVycyIsIl9pc1NoYXJlZFZhbHVlIiwiX2RlZmluZVByb3BlcnR5Iiwib2JqIiwia2V5IiwiX3RvUHJvcGVydHlLZXkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJ0IiwiaSIsIl90b1ByaW1pdGl2ZSIsInIiLCJlIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiTnVtYmVyIiwiaXNJbmxpbmVTdHlsZVRyYW5zZm9ybSIsInRyYW5zZm9ybSIsIkFycmF5IiwiaXNBcnJheSIsInNvbWUiLCJpbmxpbmVQcm9wc0hhc0NoYW5nZWQiLCJzdHlsZXMxIiwic3R5bGVzMiIsImtleXMiLCJsZW5ndGgiLCJnZXRJbmxpbmVQcm9wc1VwZGF0ZSIsImlubGluZVByb3BzIiwidXBkYXRlIiwiX3JlZiIsImVudHJpZXMiLCJfcmVmMiIsImRlZmF1bHQiLCJzdHlsZVZhbHVlIiwiaXNTaGFyZWRWYWx1ZSIsIm1hcCIsIml0ZW0iLCJleHRyYWN0U2hhcmVkVmFsdWVzTWFwRnJvbVByb3BzIiwicHJvcHMiLCJfcHJvcHMkc3R5bGUiLCJzdHlsZXMiLCJmbGF0dGVuQXJyYXkiLCJzdHlsZSIsImZvckVhY2giLCJfcmVmMyIsIl9yZWY0Iiwic3R5bGVLZXkiLCJpc0ZpcnN0UmVuZGVyIiwibmV3U3R5bGUiLCJfcmVmNSIsIl9yZWY2IiwiYXR0YWNoSW5saW5lUHJvcHMiLCJhbmltYXRlZENvbXBvbmVudCIsInZpZXdJbmZvIiwibmV3SW5saW5lUHJvcHMiLCJoYXNDaGFuZ2VkIiwiX2lubGluZVByb3BzIiwiX2lubGluZVByb3BzVmlld0Rlc2NyaXB0b3JzIiwibWFrZVZpZXdEZXNjcmlwdG9yc1NldCIsInZpZXdUYWciLCJ2aWV3TmFtZSIsInNoYWRvd05vZGVXcmFwcGVyIiwidmlld0NvbmZpZyIsImFkYXB0Vmlld0NvbmZpZyIsImFkZCIsInRhZyIsIm5hbWUiLCJzaGFyZWFibGVWaWV3RGVzY3JpcHRvcnMiLCJ1cGRhdGVyRnVuY3Rpb24iLCJ1cGRhdGVQcm9wcyIsIl9pbmxpbmVQcm9wc01hcHBlcklkIiwic3RvcE1hcHBlciIsInN0YXJ0TWFwcGVyIiwidmFsdWVzIiwiZGV0YWNoSW5saW5lUHJvcHMiXSwic291cmNlcyI6WyJJbmxpbmVQcm9wTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgdHlwZSB7IFN0eWxlUHJvcHMgfSBmcm9tICcuLi9jb21tb25UeXBlcyc7XG5pbXBvcnQgdHlwZSB7XG4gIElBbmltYXRlZENvbXBvbmVudEludGVybmFsLFxuICBBbmltYXRlZENvbXBvbmVudFByb3BzLFxuICBJSW5saW5lUHJvcE1hbmFnZXIsXG4gIFZpZXdJbmZvLFxufSBmcm9tICcuL2NvbW1vblR5cGVzJztcbmltcG9ydCB7IGZsYXR0ZW5BcnJheSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgbWFrZVZpZXdEZXNjcmlwdG9yc1NldCB9IGZyb20gJy4uL1ZpZXdEZXNjcmlwdG9yc1NldCc7XG5pbXBvcnQgdHlwZSB7IFZpZXdEZXNjcmlwdG9yc1NldCB9IGZyb20gJy4uL1ZpZXdEZXNjcmlwdG9yc1NldCc7XG5pbXBvcnQgeyBhZGFwdFZpZXdDb25maWcgfSBmcm9tICcuLi9Db25maWdIZWxwZXInO1xuaW1wb3J0IHVwZGF0ZVByb3BzIGZyb20gJy4uL1VwZGF0ZVByb3BzJztcbmltcG9ydCB7IHN0b3BNYXBwZXIsIHN0YXJ0TWFwcGVyIH0gZnJvbSAnLi4vbWFwcGVycyc7XG5pbXBvcnQgeyBpc1NoYXJlZFZhbHVlIH0gZnJvbSAnLi4vaXNTaGFyZWRWYWx1ZSc7XG5cbmZ1bmN0aW9uIGlzSW5saW5lU3R5bGVUcmFuc2Zvcm0odHJhbnNmb3JtOiB1bmtub3duKTogYm9vbGVhbiB7XG4gIGlmICghQXJyYXkuaXNBcnJheSh0cmFuc2Zvcm0pKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRyYW5zZm9ybS5zb21lKCh0OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4gaGFzSW5saW5lU3R5bGVzKHQpKTtcbn1cblxuZnVuY3Rpb24gaW5saW5lUHJvcHNIYXNDaGFuZ2VkKFxuICBzdHlsZXMxOiBTdHlsZVByb3BzLFxuICBzdHlsZXMyOiBTdHlsZVByb3BzXG4pOiBib29sZWFuIHtcbiAgaWYgKE9iamVjdC5rZXlzKHN0eWxlczEpLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMoc3R5bGVzMikubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhzdHlsZXMxKSkge1xuICAgIGlmIChzdHlsZXMxW2tleV0gIT09IHN0eWxlczJba2V5XSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBnZXRJbmxpbmVQcm9wc1VwZGF0ZShpbmxpbmVQcm9wczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgJ3dvcmtsZXQnO1xuICBjb25zdCB1cGRhdGU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgc3R5bGVWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoaW5saW5lUHJvcHMpKSB7XG4gICAgaWYgKGlzU2hhcmVkVmFsdWUoc3R5bGVWYWx1ZSkpIHtcbiAgICAgIHVwZGF0ZVtrZXldID0gc3R5bGVWYWx1ZS52YWx1ZTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc3R5bGVWYWx1ZSkpIHtcbiAgICAgIHVwZGF0ZVtrZXldID0gc3R5bGVWYWx1ZS5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGdldElubGluZVByb3BzVXBkYXRlKGl0ZW0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc3R5bGVWYWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHVwZGF0ZVtrZXldID0gZ2V0SW5saW5lUHJvcHNVcGRhdGUoc3R5bGVWYWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVwZGF0ZVtrZXldID0gc3R5bGVWYWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVwZGF0ZTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdFNoYXJlZFZhbHVlc01hcEZyb21Qcm9wcyhcbiAgcHJvcHM6IEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8XG4gICAgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gLyogSW5pdGlhbCBjb21wb25lbnQgcHJvcHMgKi9cbiAgPlxuKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICBjb25zdCBpbmxpbmVQcm9wczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fTtcblxuICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wcykge1xuICAgIGNvbnN0IHZhbHVlID0gcHJvcHNba2V5XTtcbiAgICBpZiAoa2V5ID09PSAnc3R5bGUnKSB7XG4gICAgICBjb25zdCBzdHlsZXMgPSBmbGF0dGVuQXJyYXk8U3R5bGVQcm9wcz4ocHJvcHMuc3R5bGUgPz8gW10pO1xuICAgICAgc3R5bGVzLmZvckVhY2goKHN0eWxlKSA9PiB7XG4gICAgICAgIGlmICghc3R5bGUpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbc3R5bGVLZXksIHN0eWxlVmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHN0eWxlKSkge1xuICAgICAgICAgIGlmIChpc1NoYXJlZFZhbHVlKHN0eWxlVmFsdWUpKSB7XG4gICAgICAgICAgICBpbmxpbmVQcm9wc1tzdHlsZUtleV0gPSBzdHlsZVZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICBzdHlsZUtleSA9PT0gJ3RyYW5zZm9ybScgJiZcbiAgICAgICAgICAgIGlzSW5saW5lU3R5bGVUcmFuc2Zvcm0oc3R5bGVWYWx1ZSlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlubGluZVByb3BzW3N0eWxlS2V5XSA9IHN0eWxlVmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGlzU2hhcmVkVmFsdWUodmFsdWUpKSB7XG4gICAgICBpbmxpbmVQcm9wc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGlubGluZVByb3BzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzSW5saW5lU3R5bGVzKHN0eWxlOiBTdHlsZVByb3BzKTogYm9vbGVhbiB7XG4gIGlmICghc3R5bGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIE9iamVjdC5rZXlzKHN0eWxlKS5zb21lKChrZXkpID0+IHtcbiAgICBjb25zdCBzdHlsZVZhbHVlID0gc3R5bGVba2V5XTtcbiAgICByZXR1cm4gKFxuICAgICAgaXNTaGFyZWRWYWx1ZShzdHlsZVZhbHVlKSB8fFxuICAgICAgKGtleSA9PT0gJ3RyYW5zZm9ybScgJiYgaXNJbmxpbmVTdHlsZVRyYW5zZm9ybShzdHlsZVZhbHVlKSlcbiAgICApO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldElubGluZVN0eWxlKFxuICBzdHlsZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIGlzRmlyc3RSZW5kZXI6IGJvb2xlYW5cbikge1xuICBpZiAoaXNGaXJzdFJlbmRlcikge1xuICAgIHJldHVybiBnZXRJbmxpbmVQcm9wc1VwZGF0ZShzdHlsZSk7XG4gIH1cbiAgY29uc3QgbmV3U3R5bGU6IFN0eWxlUHJvcHMgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCBzdHlsZVZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzdHlsZSkpIHtcbiAgICBpZiAoXG4gICAgICAhaXNTaGFyZWRWYWx1ZShzdHlsZVZhbHVlKSAmJlxuICAgICAgIShrZXkgPT09ICd0cmFuc2Zvcm0nICYmIGlzSW5saW5lU3R5bGVUcmFuc2Zvcm0oc3R5bGVWYWx1ZSkpXG4gICAgKSB7XG4gICAgICBuZXdTdHlsZVtrZXldID0gc3R5bGVWYWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld1N0eWxlO1xufVxuXG5leHBvcnQgY2xhc3MgSW5saW5lUHJvcE1hbmFnZXIgaW1wbGVtZW50cyBJSW5saW5lUHJvcE1hbmFnZXIge1xuICBfaW5saW5lUHJvcHNWaWV3RGVzY3JpcHRvcnM6IFZpZXdEZXNjcmlwdG9yc1NldCB8IG51bGwgPSBudWxsO1xuICBfaW5saW5lUHJvcHNNYXBwZXJJZDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIF9pbmxpbmVQcm9wczogU3R5bGVQcm9wcyA9IHt9O1xuXG4gIHB1YmxpYyBhdHRhY2hJbmxpbmVQcm9wcyhcbiAgICBhbmltYXRlZENvbXBvbmVudDogUmVhY3QuQ29tcG9uZW50PHVua25vd24sIHVua25vd24+ICZcbiAgICAgIElBbmltYXRlZENvbXBvbmVudEludGVybmFsLFxuICAgIHZpZXdJbmZvOiBWaWV3SW5mb1xuICApIHtcbiAgICBjb25zdCBuZXdJbmxpbmVQcm9wczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPVxuICAgICAgZXh0cmFjdFNoYXJlZFZhbHVlc01hcEZyb21Qcm9wcyhhbmltYXRlZENvbXBvbmVudC5wcm9wcyk7XG4gICAgY29uc3QgaGFzQ2hhbmdlZCA9IGlubGluZVByb3BzSGFzQ2hhbmdlZChuZXdJbmxpbmVQcm9wcywgdGhpcy5faW5saW5lUHJvcHMpO1xuXG4gICAgaWYgKGhhc0NoYW5nZWQpIHtcbiAgICAgIGlmICghdGhpcy5faW5saW5lUHJvcHNWaWV3RGVzY3JpcHRvcnMpIHtcbiAgICAgICAgdGhpcy5faW5saW5lUHJvcHNWaWV3RGVzY3JpcHRvcnMgPSBtYWtlVmlld0Rlc2NyaXB0b3JzU2V0KCk7XG5cbiAgICAgICAgY29uc3QgeyB2aWV3VGFnLCB2aWV3TmFtZSwgc2hhZG93Tm9kZVdyYXBwZXIsIHZpZXdDb25maWcgfSA9IHZpZXdJbmZvO1xuXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXdJbmxpbmVQcm9wcykubGVuZ3RoICYmIHZpZXdDb25maWcpIHtcbiAgICAgICAgICBhZGFwdFZpZXdDb25maWcodmlld0NvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9pbmxpbmVQcm9wc1ZpZXdEZXNjcmlwdG9ycy5hZGQoe1xuICAgICAgICAgIHRhZzogdmlld1RhZyBhcyBudW1iZXIsXG4gICAgICAgICAgbmFtZTogdmlld05hbWUhLFxuICAgICAgICAgIHNoYWRvd05vZGVXcmFwcGVyOiBzaGFkb3dOb2RlV3JhcHBlciEsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2hhcmVhYmxlVmlld0Rlc2NyaXB0b3JzID1cbiAgICAgICAgdGhpcy5faW5saW5lUHJvcHNWaWV3RGVzY3JpcHRvcnMuc2hhcmVhYmxlVmlld0Rlc2NyaXB0b3JzO1xuXG4gICAgICBjb25zdCB1cGRhdGVyRnVuY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgICd3b3JrbGV0JztcbiAgICAgICAgY29uc3QgdXBkYXRlID0gZ2V0SW5saW5lUHJvcHNVcGRhdGUobmV3SW5saW5lUHJvcHMpO1xuICAgICAgICB1cGRhdGVQcm9wcyhzaGFyZWFibGVWaWV3RGVzY3JpcHRvcnMsIHVwZGF0ZSk7XG4gICAgICB9O1xuICAgICAgdGhpcy5faW5saW5lUHJvcHMgPSBuZXdJbmxpbmVQcm9wcztcbiAgICAgIGlmICh0aGlzLl9pbmxpbmVQcm9wc01hcHBlcklkKSB7XG4gICAgICAgIHN0b3BNYXBwZXIodGhpcy5faW5saW5lUHJvcHNNYXBwZXJJZCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9pbmxpbmVQcm9wc01hcHBlcklkID0gbnVsbDtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhuZXdJbmxpbmVQcm9wcykubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuX2lubGluZVByb3BzTWFwcGVySWQgPSBzdGFydE1hcHBlcihcbiAgICAgICAgICB1cGRhdGVyRnVuY3Rpb24sXG4gICAgICAgICAgT2JqZWN0LnZhbHVlcyhuZXdJbmxpbmVQcm9wcylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGV0YWNoSW5saW5lUHJvcHMoKSB7XG4gICAgaWYgKHRoaXMuX2lubGluZVByb3BzTWFwcGVySWQpIHtcbiAgICAgIHN0b3BNYXBwZXIodGhpcy5faW5saW5lUHJvcHNNYXBwZXJJZCk7XG4gICAgfVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUEsSUFBQUEsc0JBQUEsR0FBQUMsT0FBQTtBQUFBQyxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxpQkFBQTtBQUFBRixPQUFBLENBQUFHLGNBQUEsR0FBQUEsY0FBQTtBQUFBSCxPQUFBLENBQUFJLGVBQUEsR0FBQUEsZUFBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBUyxhQUFBLEdBQUFWLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBVSxlQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFRWixJQUFBVyxNQUFBLEdBQUFYLE9BQUE7QUFDQSxJQUFBWSxtQkFBQSxHQUFBWixPQUFBO0FBRUEsSUFBQWEsYUFBQSxHQUFBYixPQUFBO0FBQ0EsSUFBQWMsWUFBQSxHQUFBZixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQWUsUUFBQSxHQUFBZixPQUFBO0FBQ0EsSUFBQWdCLGNB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