85838d7bb11e06005036a1484be80644
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startWebLayoutAnimation = startWebLayoutAnimation;
exports.tryActivateLayoutTransition = tryActivateLayoutTransition;
var _config = require("./config");
var _commonTypes = require("../animationBuilder/commonTypes");
var _createAnimation = require("./createAnimation");
var _componentUtils = require("./componentUtils");
var _domUtils = require("./domUtils");
var _animationBuilder = require("../animationBuilder");
var _componentStyle = require("./componentStyle");
var _Easing = require("../../Easing");
function chooseConfig(animationType, props) {
  var config = animationType === _commonTypes.LayoutAnimationType.ENTERING ? props.entering : animationType === _commonTypes.LayoutAnimationType.EXITING ? props.exiting : animationType === _commonTypes.LayoutAnimationType.LAYOUT ? props.layout : null;
  return config;
}
function checkUndefinedAnimationFail(initialAnimationName, needsCustomization) {
  if (initialAnimationName in _config.Animations || needsCustomization) {
    return false;
  }
  console.warn("[Reanimated] Couldn't load entering/exiting animation. Current version supports only predefined animations with modifiers: duration, delay, easing, randomizeDelay, withCallback, reducedMotion.");
  return true;
}
function maybeReportOverwrittenProperties(keyframe, styles) {
  var propertyRegex = /([a-zA-Z-]+)(?=:)/g;
  var animationProperties = new Set();
  for (var match of keyframe.matchAll(propertyRegex)) {
    animationProperties.add(match[1]);
  }
  var commonProperties = Array.from(styles).filter(function (style) {
    return animationProperties.has(style);
  });
  if (commonProperties.length === 0) {
    return;
  }
  console.warn(`[Reanimated] ${commonProperties.length === 1 ? 'Property' : 'Properties'} [${commonProperties.join(', ')}] may be overwritten by a layout animation. Please wrap your component with an animated view and apply the layout animation on the wrapper.`);
}
function chooseAction(animationType, animationConfig, element, transitionData) {
  switch (animationType) {
    case _commonTypes.LayoutAnimationType.ENTERING:
      (0, _componentUtils.setElementAnimation)(element, animationConfig, true);
      break;
    case _commonTypes.LayoutAnimationType.LAYOUT:
      transitionData.reversed = animationConfig.reversed;
      (0, _componentUtils.handleLayoutTransition)(element, animationConfig, transitionData);
      break;
    case _commonTypes.LayoutAnimationType.EXITING:
      (0, _componentUtils.handleExitingAnimation)(element, animationConfig);
      break;
  }
}
function tryGetAnimationConfig(props, animationType) {
  var config = chooseConfig(animationType, props);
  if (!config) {
    return null;
  }
  var isLayoutTransition = animationType === _commonTypes.LayoutAnimationType.LAYOUT;
  var isCustomKeyframe = config instanceof _animationBuilder.Keyframe;
  var hasInitialValues = config.initialValues !== undefined;
  var animationName;
  if (isCustomKeyframe) {
    animationName = (0, _createAnimation.createCustomKeyFrameAnimation)(config.definitions);
  } else if (typeof config === 'function') {
    animationName = config.presetName;
  } else {
    animationName = config.constructor.presetName;
  }
  if (hasInitialValues) {
    animationName = (0, _createAnimation.createAnimationWithInitialValues)(animationName, config.initialValues);
  }
  var shouldFail = checkUndefinedAnimationFail(animationName, isLayoutTransition || isCustomKeyframe || hasInitialValues);
  if (shouldFail) {
    return null;
  }
  if (isCustomKeyframe) {
    var keyframeTimestamps = Object.keys(config.definitions);
    if (!(keyframeTimestamps.includes('100') || keyframeTimestamps.includes('to'))) {
      console.warn(`[Reanimated] Neither '100' nor 'to' was specified in Keyframe definition. This may result in wrong final position of your component. One possible solution is to duplicate last timestamp in definition as '100' (or 'to')`);
    }
  }
  var animationConfig = (0, _componentUtils.getProcessedConfig)(animationName, animationType, config);
  return animationConfig;
}
function startWebLayoutAnimation(props, element, animationType, transitionData) {
  var animationConfig = tryGetAnimationConfig(props, animationType);
  (0, _componentUtils.maybeModifyStyleForKeyframe)(element, props.entering);
  if ((animationConfig == null ? void 0 : animationConfig.animationName) in _config.Animations) {
    maybeReportOverwrittenProperties(_config.Animations[animationConfig == null ? void 0 : animationConfig.animationName].style, element.style);
  }
  if (animationConfig) {
    chooseAction(animationType, animationConfig, element, transitionData);
  } else {
    (0, _componentStyle.makeElementVisible)(element, 0);
  }
}
function tryActivateLayoutTransition(props, element, snapshot) {
  var _enteringV, _exitingV, _easingXV$EasingNameS, _easingXV, _easingYV$EasingNameS, _easingYV;
  if (!props.layout) {
    return;
  }
  var rect = element.getBoundingClientRect();
  if ((0, _domUtils.areDOMRectsEqual)(rect, snapshot)) {
    return;
  }
  var enteringAnimation = (_enteringV = props.layout.enteringV) == null ? void 0 : _enteringV.presetName;
  var exitingAnimation = (_exitingV = props.layout.exitingV) == null ? void 0 : _exitingV.presetName;
  var transitionData = {
    translateX: snapshot.x - rect.x,
    translateY: snapshot.y - rect.y,
    scaleX: snapshot.width / rect.width,
    scaleY: snapshot.height / rect.height,
    reversed: false,
    easingX: (_easingXV$EasingNameS = (_easingXV = props.layout.easingXV) == null ? void 0 : _easingXV[_Easing.EasingNameSymbol]) != null ? _easingXV$EasingNameS : 'ease',
    easingY: (_easingYV$EasingNameS = (_easingYV = props.layout.easingYV) == null ? void 0 : _easingYV[_Easing.EasingNameSymbol]) != null ? _easingYV$EasingNameS : 'ease',
    entering: enteringAnimation,
    exiting: exitingAnimation
  };
  startWebLayoutAnimation(props, element, _commonTypes.LayoutAnimationType.LAYOUT, transitionData);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInN0YXJ0V2ViTGF5b3V0QW5pbWF0aW9uIiwidHJ5QWN0aXZhdGVMYXlvdXRUcmFuc2l0aW9uIiwiX2NvbmZpZyIsInJlcXVpcmUiLCJfY29tbW9uVHlwZXMiLCJfY3JlYXRlQW5pbWF0aW9uIiwiX2NvbXBvbmVudFV0aWxzIiwiX2RvbVV0aWxzIiwiX2FuaW1hdGlvbkJ1aWxkZXIiLCJfY29tcG9uZW50U3R5bGUiLCJfRWFzaW5nIiwiY2hvb3NlQ29uZmlnIiwiYW5pbWF0aW9uVHlwZSIsInByb3BzIiwiY29uZmlnIiwiTGF5b3V0QW5pbWF0aW9uVHlwZSIsIkVOVEVSSU5HIiwiZW50ZXJpbmciLCJFWElUSU5HIiwiZXhpdGluZyIsIkxBWU9VVCIsImxheW91dCIsImNoZWNrVW5kZWZpbmVkQW5pbWF0aW9uRmFpbCIsImluaXRpYWxBbmltYXRpb25OYW1lIiwibmVlZHNDdXN0b21pemF0aW9uIiwiQW5pbWF0aW9ucyIsImNvbnNvbGUiLCJ3YXJuIiwibWF5YmVSZXBvcnRPdmVyd3JpdHRlblByb3BlcnRpZXMiLCJrZXlmcmFtZSIsInN0eWxlcyIsInByb3BlcnR5UmVnZXgiLCJhbmltYXRpb25Qcm9wZXJ0aWVzIiwiU2V0IiwibWF0Y2giLCJtYXRjaEFsbCIsImFkZCIsImNvbW1vblByb3BlcnRpZXMiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJzdHlsZSIsImhhcyIsImxlbmd0aCIsImpvaW4iLCJjaG9vc2VBY3Rpb24iLCJhbmltYXRpb25Db25maWciLCJlbGVtZW50IiwidHJhbnNpdGlvbkRhdGEiLCJzZXRFbGVtZW50QW5pbWF0aW9uIiwicmV2ZXJzZWQiLCJoYW5kbGVMYXlvdXRUcmFuc2l0aW9uIiwiaGFuZGxlRXhpdGluZ0FuaW1hdGlvbiIsInRyeUdldEFuaW1hdGlvbkNvbmZpZyIsImlzTGF5b3V0VHJhbnNpdGlvbiIsImlzQ3VzdG9tS2V5ZnJhbWUiLCJLZXlmcmFtZSIsImhhc0luaXRpYWxWYWx1ZXMiLCJpbml0aWFsVmFsdWVzIiwidW5kZWZpbmVkIiwiYW5pbWF0aW9uTmFtZSIsImNyZWF0ZUN1c3RvbUtleUZyYW1lQW5pbWF0aW9uIiwiZGVmaW5pdGlvbnMiLCJwcmVzZXROYW1lIiwiY29uc3RydWN0b3IiLCJjcmVhdGVBbmltYXRpb25XaXRoSW5pdGlhbFZhbHVlcyIsInNob3VsZEZhaWwiLCJrZXlmcmFtZVRpbWVzdGFtcHMiLCJrZXlzIiwiaW5jbHVkZXMiLCJnZXRQcm9jZXNzZWRDb25maWciLCJtYXliZU1vZGlmeVN0eWxlRm9yS2V5ZnJhbWUiLCJtYWtlRWxlbWVudFZpc2libGUiLCJzbmFwc2hvdCIsIl9lbnRlcmluZ1YiLCJfZXhpdGluZ1YiLCJfZWFzaW5nWFYkRWFzaW5nTmFtZVMiLCJfZWFzaW5nWFYiLCJfZWFzaW5nWVYkRWFzaW5nTmFtZVMiLCJfZWFzaW5nWVYiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiYXJlRE9NUmVjdHNFcXVhbCIsImVudGVyaW5nQW5pbWF0aW9uIiwiZW50ZXJpbmdWIiwiZXhpdGluZ0FuaW1hdGlvbiIsImV4aXRpbmdWIiwidHJhbnNsYXRlWCIsIngiLCJ0cmFuc2xhdGVZIiwieSIsInNjYWxlWCIsIndpZHRoIiwic2NhbGVZIiwiaGVpZ2h0IiwiZWFzaW5nWCIsImVhc2luZ1hWIiwiRWFzaW5nTmFtZVN5bWJvbCIsImVhc2luZ1kiLCJlYXNpbmdZViJdLCJzb3VyY2VzIjpbImFuaW1hdGlvbnNNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHR5cGUge1xuICBBbmltYXRpb25Db25maWcsXG4gIEFuaW1hdGlvbk5hbWVzLFxuICBDdXN0b21Db25maWcsXG4gIEluaXRpYWxWYWx1ZXNTdHlsZVByb3BzLFxuICBLZXlmcmFtZURlZmluaXRpb25zLFxufSBmcm9tICcuL2NvbmZpZyc7XG5pbXBvcnQgeyBBbmltYXRpb25zIH0gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHR5cGUge1xuICBBbmltYXRlZENvbXBvbmVudFByb3BzLFxuICBMYXlvdXRBbmltYXRpb25TdGF0aWNDb250ZXh0LFxufSBmcm9tICcuLi8uLi9jcmVhdGVBbmltYXRlZENvbXBvbmVudC9jb21tb25UeXBlcyc7XG5pbXBvcnQgeyBMYXlvdXRBbmltYXRpb25UeXBlIH0gZnJvbSAnLi4vYW5pbWF0aW9uQnVpbGRlci9jb21tb25UeXBlcyc7XG5pbXBvcnQge1xuICBjcmVhdGVBbmltYXRpb25XaXRoSW5pdGlhbFZhbHVlcyxcbiAgY3JlYXRlQ3VzdG9tS2V5RnJhbWVBbmltYXRpb24sXG59IGZyb20gJy4vY3JlYXRlQW5pbWF0aW9uJztcbmltcG9ydCB7XG4gIGdldFByb2Nlc3NlZENvbmZpZyxcbiAgaGFuZGxlRXhpdGluZ0FuaW1hdGlvbixcbiAgaGFuZGxlTGF5b3V0VHJhbnNpdGlvbixcbiAgbWF5YmVNb2RpZnlTdHlsZUZvcktleWZyYW1lLFxuICBzZXRFbGVtZW50QW5pbWF0aW9uLFxufSBmcm9tICcuL2NvbXBvbmVudFV0aWxzJztcbmltcG9ydCB7IGFyZURPTVJlY3RzRXF1YWwgfSBmcm9tICcuL2RvbVV0aWxzJztcbmltcG9ydCB0eXBlIHsgVHJhbnNpdGlvbkRhdGEgfSBmcm9tICcuL2FuaW1hdGlvblBhcnNlcic7XG5pbXBvcnQgeyBLZXlmcmFtZSB9IGZyb20gJy4uL2FuaW1hdGlvbkJ1aWxkZXInO1xuaW1wb3J0IHsgbWFrZUVsZW1lbnRWaXNpYmxlIH0gZnJvbSAnLi9jb21wb25lbnRTdHlsZSc7XG5pbXBvcnQgeyBFYXNpbmdOYW1lU3ltYm9sIH0gZnJvbSAnLi4vLi4vRWFzaW5nJztcbmltcG9ydCB0eXBlIHsgUmVhbmltYXRlZEhUTUxFbGVtZW50IH0gZnJvbSAnLi4vLi4vanMtcmVhbmltYXRlZCc7XG5cbmZ1bmN0aW9uIGNob29zZUNvbmZpZzxDb21wb25lbnRQcm9wcyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgYW5pbWF0aW9uVHlwZTogTGF5b3V0QW5pbWF0aW9uVHlwZSxcbiAgcHJvcHM6IFJlYWRvbmx5PEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8Q29tcG9uZW50UHJvcHM+PlxuKSB7XG4gIGNvbnN0IGNvbmZpZyA9XG4gICAgYW5pbWF0aW9uVHlwZSA9PT0gTGF5b3V0QW5pbWF0aW9uVHlwZS5FTlRFUklOR1xuICAgICAgPyBwcm9wcy5lbnRlcmluZ1xuICAgICAgOiBhbmltYXRpb25UeXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLkVYSVRJTkdcbiAgICAgID8gcHJvcHMuZXhpdGluZ1xuICAgICAgOiBhbmltYXRpb25UeXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLkxBWU9VVFxuICAgICAgPyBwcm9wcy5sYXlvdXRcbiAgICAgIDogbnVsbDtcblxuICByZXR1cm4gY29uZmlnO1xufVxuXG5mdW5jdGlvbiBjaGVja1VuZGVmaW5lZEFuaW1hdGlvbkZhaWwoXG4gIGluaXRpYWxBbmltYXRpb25OYW1lOiBzdHJpbmcsXG4gIG5lZWRzQ3VzdG9taXphdGlvbjogYm9vbGVhblxuKSB7XG4gIC8vIFRoaXMgcHJldmVudHMgY3Jhc2hlcyBpZiB3ZSB0cnkgdG8gc2V0IGFuaW1hdGlvbnMgdGhhdCBhcmUgbm90IGRlZmluZWQuXG4gIC8vIFdlIGRvbid0IGNhcmUgYWJvdXQgbGF5b3V0IHRyYW5zaXRpb25zIG9yIGN1c3RvbSBrZXlmcmFtZXMgc2luY2UgdGhleSdyZSBjcmVhdGVkIGR5bmFtaWNhbGx5XG4gIGlmIChpbml0aWFsQW5pbWF0aW9uTmFtZSBpbiBBbmltYXRpb25zIHx8IG5lZWRzQ3VzdG9taXphdGlvbikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnNvbGUud2FybihcbiAgICBcIltSZWFuaW1hdGVkXSBDb3VsZG4ndCBsb2FkIGVudGVyaW5nL2V4aXRpbmcgYW5pbWF0aW9uLiBDdXJyZW50IHZlcnNpb24gc3VwcG9ydHMgb25seSBwcmVkZWZpbmVkIGFuaW1hdGlvbnMgd2l0aCBtb2RpZmllcnM6IGR1cmF0aW9uLCBkZWxheSwgZWFzaW5nLCByYW5kb21pemVEZWxheSwgd2l0aENhbGxiYWNrLCByZWR1Y2VkTW90aW9uLlwiXG4gICk7XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIG1heWJlUmVwb3J0T3ZlcndyaXR0ZW5Qcm9wZXJ0aWVzKFxuICBrZXlmcmFtZTogc3RyaW5nLFxuICBzdHlsZXM6IENTU1N0eWxlRGVjbGFyYXRpb25cbikge1xuICBjb25zdCBwcm9wZXJ0eVJlZ2V4ID0gLyhbYS16QS1aLV0rKSg/PTopL2c7XG4gIGNvbnN0IGFuaW1hdGlvblByb3BlcnRpZXMgPSBuZXcgU2V0KCk7XG5cbiAgZm9yIChjb25zdCBtYXRjaCBvZiBrZXlmcmFtZS5tYXRjaEFsbChwcm9wZXJ0eVJlZ2V4KSkge1xuICAgIGFuaW1hdGlvblByb3BlcnRpZXMuYWRkKG1hdGNoWzFdKTtcbiAgfVxuXG4gIGNvbnN0IGNvbW1vblByb3BlcnRpZXMgPSBBcnJheS5mcm9tKHN0eWxlcykuZmlsdGVyKChzdHlsZSkgPT5cbiAgICBhbmltYXRpb25Qcm9wZXJ0aWVzLmhhcyhzdHlsZSlcbiAgKTtcblxuICBpZiAoY29tbW9uUHJvcGVydGllcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zb2xlLndhcm4oXG4gICAgYFtSZWFuaW1hdGVkXSAke1xuICAgICAgY29tbW9uUHJvcGVydGllcy5sZW5ndGggPT09IDEgPyAnUHJvcGVydHknIDogJ1Byb3BlcnRpZXMnXG4gICAgfSBbJHtjb21tb25Qcm9wZXJ0aWVzLmpvaW4oXG4gICAgICAnLCAnXG4gICAgKX1dIG1heSBiZSBvdmVyd3JpdHRlbiBieSBhIGxheW91dCBhbmltYXRpb24uIFBsZWFzZSB3cmFwIHlvdXIgY29tcG9uZW50IHdpdGggYW4gYW5pbWF0ZWQgdmlldyBhbmQgYXBwbHkgdGhlIGxheW91dCBhbmltYXRpb24gb24gdGhlIHdyYXBwZXIuYFxuICApO1xufVxuXG5mdW5jdGlvbiBjaG9vc2VBY3Rpb24oXG4gIGFuaW1hdGlvblR5cGU6IExheW91dEFuaW1hdGlvblR5cGUsXG4gIGFuaW1hdGlvbkNvbmZpZzogQW5pbWF0aW9uQ29uZmlnLFxuICBlbGVtZW50OiBSZWFuaW1hdGVkSFRNTEVsZW1lbnQsXG4gIHRyYW5zaXRpb25EYXRhOiBUcmFuc2l0aW9uRGF0YVxuKSB7XG4gIHN3aXRjaCAoYW5pbWF0aW9uVHlwZSkge1xuICAgIGNhc2UgTGF5b3V0QW5pbWF0aW9uVHlwZS5FTlRFUklORzpcbiAgICAgIHNldEVsZW1lbnRBbmltYXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnLCB0cnVlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgTGF5b3V0QW5pbWF0aW9uVHlwZS5MQVlPVVQ6XG4gICAgICB0cmFuc2l0aW9uRGF0YS5yZXZlcnNlZCA9IGFuaW1hdGlvbkNvbmZpZy5yZXZlcnNlZDtcbiAgICAgIGhhbmRsZUxheW91dFRyYW5zaXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnLCB0cmFuc2l0aW9uRGF0YSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIExheW91dEFuaW1hdGlvblR5cGUuRVhJVElORzpcbiAgICAgIGhhbmRsZUV4aXRpbmdBbmltYXRpb24oZWxlbWVudCwgYW5pbWF0aW9uQ29uZmlnKTtcbiAgICAgIGJyZWFrO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyeUdldEFuaW1hdGlvbkNvbmZpZzxDb21wb25lbnRQcm9wcyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgcHJvcHM6IFJlYWRvbmx5PEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8Q29tcG9uZW50UHJvcHM+PixcbiAgYW5pbWF0aW9uVHlwZTogTGF5b3V0QW5pbWF0aW9uVHlwZVxuKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGNob29zZUNvbmZpZyhhbmltYXRpb25UeXBlLCBwcm9wcyk7XG4gIGlmICghY29uZmlnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB0eXBlIENvbnN0cnVjdG9yV2l0aFN0YXRpY0NvbnRleHQgPSBMYXlvdXRBbmltYXRpb25TdGF0aWNDb250ZXh0ICZcbiAgICB0eXBlb2YgY29uZmlnLmNvbnN0cnVjdG9yO1xuXG4gIGNvbnN0IGlzTGF5b3V0VHJhbnNpdGlvbiA9IGFuaW1hdGlvblR5cGUgPT09IExheW91dEFuaW1hdGlvblR5cGUuTEFZT1VUO1xuICBjb25zdCBpc0N1c3RvbUtleWZyYW1lID0gY29uZmlnIGluc3RhbmNlb2YgS2V5ZnJhbWU7XG4gIGNvbnN0IGhhc0luaXRpYWxWYWx1ZXMgPSAoY29uZmlnIGFzIEN1c3RvbUNvbmZpZykuaW5pdGlhbFZhbHVlcyAhPT0gdW5kZWZpbmVkO1xuXG4gIGxldCBhbmltYXRpb25OYW1lO1xuXG4gIGlmIChpc0N1c3RvbUtleWZyYW1lKSB7XG4gICAgYW5pbWF0aW9uTmFtZSA9IGNyZWF0ZUN1c3RvbUtleUZyYW1lQW5pbWF0aW9uKFxuICAgICAgKGNvbmZpZyBhcyBDdXN0b21Db25maWcpLmRlZmluaXRpb25zIGFzIEtleWZyYW1lRGVmaW5pdGlvbnNcbiAgICApO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICdmdW5jdGlvbicpIHtcbiAgICBhbmltYXRpb25OYW1lID0gY29uZmlnLnByZXNldE5hbWU7XG4gIH0gZWxzZSB7XG4gICAgYW5pbWF0aW9uTmFtZSA9IChjb25maWcuY29uc3RydWN0b3IgYXMgQ29uc3RydWN0b3JXaXRoU3RhdGljQ29udGV4dClcbiAgICAgIC5wcmVzZXROYW1lO1xuICB9XG5cbiAgaWYgKGhhc0luaXRpYWxWYWx1ZXMpIHtcbiAgICBhbmltYXRpb25OYW1lID0gY3JlYXRlQW5pbWF0aW9uV2l0aEluaXRpYWxWYWx1ZXMoXG4gICAgICBhbmltYXRpb25OYW1lLFxuICAgICAgKGNvbmZpZyBhcyBDdXN0b21Db25maWcpLmluaXRpYWxWYWx1ZXMgYXMgSW5pdGlhbFZhbHVlc1N0eWxlUHJvcHNcbiAgICApO1xuICB9XG5cbiAgY29uc3Qgc2hvdWxkRmFpbCA9IGNoZWNrVW5kZWZpbmVkQW5pbWF0aW9uRmFpbChcbiAgICBhbmltYXRpb25OYW1lLFxuICAgIGlzTGF5b3V0VHJhbnNpdGlvbiB8fCBpc0N1c3RvbUtleWZyYW1lIHx8IGhhc0luaXRpYWxWYWx1ZXNcbiAgKTtcblxuICBpZiAoc2hvdWxkRmFpbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKGlzQ3VzdG9tS2V5ZnJhbWUpIHtcbiAgICBjb25zdCBrZXlmcmFtZVRpbWVzdGFtcHMgPSBPYmplY3Qua2V5cyhcbiAgICAgIChjb25maWcgYXMgQ3VzdG9tQ29uZmlnKS5kZWZpbml0aW9ucyBhcyBLZXlmcmFtZURlZmluaXRpb25zXG4gICAgKTtcblxuICAgIGlmIChcbiAgICAgICEoa2V5ZnJhbWVUaW1lc3RhbXBzLmluY2x1ZGVzKCcxMDAnKSB8fCBrZXlmcmFtZVRpbWVzdGFtcHMuaW5jbHVkZXMoJ3RvJykpXG4gICAgKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBbUmVhbmltYXRlZF0gTmVpdGhlciAnMTAwJyBub3IgJ3RvJyB3YXMgc3BlY2lmaWVkIGluIEtleWZyYW1lIGRlZmluaXRpb24uIFRoaXMgbWF5IHJlc3VsdCBpbiB3cm9uZyBmaW5hbCBwb3NpdGlvbiBvZiB5b3VyIGNvbXBvbmVudC4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIGlzIHRvIGR1cGxpY2F0ZSBsYXN0IHRpbWVzdGFtcCBpbiBkZWZpbml0aW9uIGFzICcxMDAnIChvciAndG8nKWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgYW5pbWF0aW9uQ29uZmlnID0gZ2V0UHJvY2Vzc2VkQ29uZmlnKFxuICAgIGFuaW1hdGlvbk5hbWUsXG4gICAgYW5pbWF0aW9uVHlwZSxcbiAgICBjb25maWcgYXMgQ3VzdG9tQ29uZmlnXG4gICk7XG5cbiAgcmV0dXJuIGFuaW1hdGlvbkNvbmZpZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0V2ViTGF5b3V0QW5pbWF0aW9uPFxuICBDb21wb25lbnRQcm9wcyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+KFxuICBwcm9wczogUmVhZG9ubHk8QW5pbWF0ZWRDb21wb25lbnRQcm9wczxDb21wb25lbnRQcm9wcz4+LFxuICBlbGVtZW50OiBSZWFuaW1hdGVkSFRNTEVsZW1lbnQsXG4gIGFuaW1hdGlvblR5cGU6IExheW91dEFuaW1hdGlvblR5cGUsXG4gIHRyYW5zaXRpb25EYXRhPzogVHJhbnNpdGlvbkRhdGFcbikge1xuICBjb25zdCBhbmltYXRpb25Db25maWcgPSB0cnlHZXRBbmltYXRpb25Db25maWcocHJvcHMsIGFuaW1hdGlvblR5cGUpO1xuXG4gIG1heWJlTW9kaWZ5U3R5bGVGb3JLZXlmcmFtZShlbGVtZW50LCBwcm9wcy5lbnRlcmluZyBhcyBDdXN0b21Db25maWcpO1xuXG4gIGlmICgoYW5pbWF0aW9uQ29uZmlnPy5hbmltYXRpb25OYW1lIGFzIEFuaW1hdGlvbk5hbWVzKSBpbiBBbmltYXRpb25zKSB7XG4gICAgbWF5YmVSZXBvcnRPdmVyd3JpdHRlblByb3BlcnRpZXMoXG4gICAgICBBbmltYXRpb25zW2FuaW1hdGlvbkNvbmZpZz8uYW5pbWF0aW9uTmFtZSBhcyBBbmltYXRpb25OYW1lc10uc3R5bGUsXG4gICAgICBlbGVtZW50LnN0eWxlXG4gICAgKTtcbiAgfVxuXG4gIGlmIChhbmltYXRpb25Db25maWcpIHtcbiAgICBjaG9vc2VBY3Rpb24oXG4gICAgICBhbmltYXRpb25UeXBlLFxuICAgICAgYW5pbWF0aW9uQ29uZmlnLFxuICAgICAgZWxlbWVudCxcbiAgICAgIHRyYW5zaXRpb25EYXRhIGFzIFRyYW5zaXRpb25EYXRhXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBtYWtlRWxlbWVudFZpc2libGUoZWxlbWVudCwgMCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyeUFjdGl2YXRlTGF5b3V0VHJhbnNpdGlvbjxcbiAgQ29tcG9uZW50UHJvcHMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPihcbiAgcHJvcHM6IFJlYWRvbmx5PEFuaW1hdGVkQ29tcG9uZW50UHJvcHM8Q29tcG9uZW50UHJvcHM+PixcbiAgZWxlbWVudDogUmVhbmltYXRlZEhUTUxFbGVtZW50LFxuICBzbmFwc2hvdDogRE9NUmVjdFxuKSB7XG4gIGlmICghcHJvcHMubGF5b3V0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgaWYgKGFyZURPTVJlY3RzRXF1YWwocmVjdCwgc25hcHNob3QpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgZW50ZXJpbmdBbmltYXRpb24gPSAocHJvcHMubGF5b3V0IGFzIEN1c3RvbUNvbmZpZykuZW50ZXJpbmdWXG4gICAgPy5wcmVzZXROYW1lO1xuICBjb25zdCBleGl0aW5nQW5pbWF0aW9uID0gKHByb3BzLmxheW91dCBhcyBDdXN0b21Db25maWcpLmV4aXRpbmdWPy5wcmVzZXROYW1lO1xuXG4gIGNvbnN0IHRyYW5zaXRpb25EYXRhOiBUcmFuc2l0aW9uRGF0YSA9IHtcbiAgICB0cmFuc2xhdGVYOiBzbmFwc2hvdC54IC0gcmVjdC54LFxuICAgIHRyYW5zbGF0ZVk6IHNuYXBzaG90LnkgLSByZWN0LnksXG4gICAgc2NhbGVYOiBzbmFwc2hvdC53aWR0aCAvIHJlY3Qud2lkdGgsXG4gICAgc2NhbGVZOiBzbmFwc2hvdC5oZWlnaHQgLyByZWN0LmhlaWdodCxcbiAgICByZXZlcnNlZDogZmFsc2UsIC8vIFRoaXMgZmllbGQgaXMgdXNlZCBvbmx5IGluIGBTZXF1ZW5jZWRUcmFuc2l0aW9uYCwgc28gYnkgZGVmYXVsdCBpdCB3aWxsIGJlIGZhbHNlXG4gICAgZWFzaW5nWDpcbiAgICAgIChwcm9wcy5sYXlvdXQgYXMgQ3VzdG9tQ29uZmlnKS5lYXNpbmdYVj8uW0Vhc2luZ05hbWVTeW1ib2xdID8/ICdlYXNlJyxcbiAgICBlYXNpbmdZOlxuICAgICAgKHByb3BzLmxheW91dCBhcyBDdXN0b21Db25maWcpLmVhc2luZ1lWPy5bRWFzaW5nTmFtZVN5bWJvbF0gPz8gJ2Vhc2UnLFxuICAgIGVudGVyaW5nOiBlbnRlcmluZ0FuaW1hdGlvbixcbiAgICBleGl0aW5nOiBleGl0aW5nQW5pbWF0aW9uLFxuICB9O1xuXG4gIHN0YXJ0V2ViTGF5b3V0QW5pbWF0aW9uKFxuICAgIHByb3BzLFxuICAgIGVsZW1lbnQsXG4gICAgTGF5b3V0QW5pbWF0aW9uVHlwZS5MQVlPVVQsXG4gICAgdHJhbnNpdGlvbkRhdGFcbiAgKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFBQ0EsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsdUJBQUEsR0FBQUEsdUJBQUE7QUFBQUYsT0FBQSxDQUFBRywyQkFBQSxHQUFBQSwyQkFBQTtBQVNiLElBQUFDLE9BQUEsR0FBQUMsT0FBQTtBQUtBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLGdCQUFBLEdBQUFGLE9BQUE7QUFJQSxJQUFBRyxlQUFBLEdBQUFILE9BQUE7QUFPQSxJQUFBSSxTQUFBLEdBQUFKLE9BQUE7QUFFQSxJQUFBSyxpQkFBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sZUFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sT0FBQSxHQUFBUCxPQUFBO0FBR0EsU0FBU1EsWUFBWUEsQ0FDbkJDLGFBQWtDLEVBQ2xDQyxLQUF1RCxFQUN2RDtFQUNBLElBQU1DLE1BQU0sR0FDVkYsYUFBYSxLQUFLRyxnQ0FBbUIsQ0FBQ0MsUUFBUSxHQUMxQ0gsS0FBSyxDQUFDSSxRQUFRLEdBQ2RMLGFBQWEsS0FBS0csZ0NBQW1CLENBQUNHLE9BQU8sR0FDN0NMLEtBQUssQ0FBQ00sT0FBTyxHQUNiUCxhQUFhLEtBQUtHLGdDQUFtQixDQUFDSyxNQUFNLEdBQzVDUCxLQUFLLENBQUNRLE1BQU0sR0FDWixJQUFJO0VBRVYsT0FBT1AsTUFBTTtBQUNmO0FBRUEsU0FBU1EsMkJBQTJCQSxDQUNsQ0Msb0JBQTRCLEVB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