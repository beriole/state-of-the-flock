45f6510fed7ff83ebdd492a04616d02b
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SensorContainer = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _Sensor = _interopRequireDefault(require("./Sensor"));
function _defineProperty(obj, key, value) {
  key = _toPropertyKey(key);
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
function _toPropertyKey(t) {
  var i = _toPrimitive(t, "string");
  return "symbol" == typeof i ? i : i + "";
}
function _toPrimitive(t, r) {
  if ("object" != typeof t || !t) return t;
  var e = t[Symbol.toPrimitive];
  if (void 0 !== e) {
    var i = e.call(t, r || "default");
    if ("object" != typeof i) return i;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return ("string" === r ? String : Number)(t);
}
var SensorContainer = exports.SensorContainer = function () {
  function SensorContainer() {
    (0, _classCallCheck2.default)(this, SensorContainer);
    _defineProperty(this, "nativeSensors", new Map());
  }
  return (0, _createClass2.default)(SensorContainer, [{
    key: "getSensorId",
    value: function getSensorId(sensorType, config) {
      return sensorType * 100 + config.iosReferenceFrame * 10 + Number(config.adjustToInterfaceOrientation);
    }
  }, {
    key: "initializeSensor",
    value: function initializeSensor(sensorType, config) {
      var sensorId = this.getSensorId(sensorType, config);
      if (!this.nativeSensors.has(sensorId)) {
        var newSensor = new _Sensor.default(sensorType, config);
        this.nativeSensors.set(sensorId, newSensor);
      }
      var sensor = this.nativeSensors.get(sensorId);
      return sensor.getSharedValue();
    }
  }, {
    key: "registerSensor",
    value: function registerSensor(sensorType, config, handler) {
      var sensorId = this.getSensorId(sensorType, config);
      if (!this.nativeSensors.has(sensorId)) {
        return -1;
      }
      var sensor = this.nativeSensors.get(sensorId);
      if (sensor && sensor.isAvailable() && (sensor.isRunning() || sensor.register(handler))) {
        sensor.listenersNumber++;
        return sensorId;
      }
      return -1;
    }
  }, {
    key: "unregisterSensor",
    value: function unregisterSensor(sensorId) {
      if (this.nativeSensors.has(sensorId)) {
        var sensor = this.nativeSensors.get(sensorId);
        if (sensor && sensor.isRunning()) {
          sensor.listenersNumber--;
          if (sensor.listenersNumber === 0) {
            sensor.unregister();
          }
        }
      }
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiU2Vuc29yQ29udGFpbmVyIiwiX2NsYXNzQ2FsbENoZWNrMiIsIl9jcmVhdGVDbGFzczIiLCJfU2Vuc29yIiwiX2RlZmluZVByb3BlcnR5Iiwib2JqIiwia2V5IiwiX3RvUHJvcGVydHlLZXkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJ0IiwiaSIsIl90b1ByaW1pdGl2ZSIsInIiLCJlIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiTnVtYmVyIiwiZGVmYXVsdCIsIk1hcCIsImdldFNlbnNvcklkIiwic2Vuc29yVHlwZSIsImNvbmZpZyIsImlvc1JlZmVyZW5jZUZyYW1lIiwiYWRqdXN0VG9JbnRlcmZhY2VPcmllbnRhdGlvbiIsImluaXRpYWxpemVTZW5zb3IiLCJzZW5zb3JJZCIsIm5hdGl2ZVNlbnNvcnMiLCJoYXMiLCJuZXdTZW5zb3IiLCJTZW5zb3IiLCJzZXQiLCJzZW5zb3IiLCJnZXQiLCJnZXRTaGFyZWRWYWx1ZSIsInJlZ2lzdGVyU2Vuc29yIiwiaGFuZGxlciIsImlzQXZhaWxhYmxlIiwiaXNSdW5uaW5nIiwicmVnaXN0ZXIiLCJsaXN0ZW5lcnNOdW1iZXIiLCJ1bnJlZ2lzdGVyU2Vuc29yIiwidW5yZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNlbnNvckNvbnRhaW5lci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgdHlwZSB7XG4gIFNlbnNvclR5cGUsXG4gIFNlbnNvckNvbmZpZyxcbiAgVmFsdWUzRCxcbiAgVmFsdWVSb3RhdGlvbixcbiAgU2hhcmVhYmxlUmVmLFxuICBTaGFyZWRWYWx1ZSxcbn0gZnJvbSAnLi9jb21tb25UeXBlcyc7XG5pbXBvcnQgU2Vuc29yIGZyb20gJy4vU2Vuc29yJztcblxuZXhwb3J0IGNsYXNzIFNlbnNvckNvbnRhaW5lciB7XG4gIHByaXZhdGUgbmF0aXZlU2Vuc29yczogTWFwPG51bWJlciwgU2Vuc29yPiA9IG5ldyBNYXAoKTtcblxuICBnZXRTZW5zb3JJZChzZW5zb3JUeXBlOiBTZW5zb3JUeXBlLCBjb25maWc6IFNlbnNvckNvbmZpZykge1xuICAgIHJldHVybiAoXG4gICAgICBzZW5zb3JUeXBlICogMTAwICtcbiAgICAgIGNvbmZpZy5pb3NSZWZlcmVuY2VGcmFtZSAqIDEwICtcbiAgICAgIE51bWJlcihjb25maWcuYWRqdXN0VG9JbnRlcmZhY2VPcmllbnRhdGlvbilcbiAgICApO1xuICB9XG5cbiAgaW5pdGlhbGl6ZVNlbnNvcihcbiAgICBzZW5zb3JUeXBlOiBTZW5zb3JUeXBlLFxuICAgIGNvbmZpZzogU2Vuc29yQ29uZmlnXG4gICk6IFNoYXJlZFZhbHVlPFZhbHVlM0QgfCBWYWx1ZVJvdGF0aW9uPiB7XG4gICAgY29uc3Qgc2Vuc29ySWQgPSB0aGlzLmdldFNlbnNvcklkKHNlbnNvclR5cGUsIGNvbmZpZyk7XG5cbiAgICBpZiAoIXRoaXMubmF0aXZlU2Vuc29ycy5oYXMoc2Vuc29ySWQpKSB7XG4gICAgICBjb25zdCBuZXdTZW5zb3IgPSBuZXcgU2Vuc29yKHNlbnNvclR5cGUsIGNvbmZpZyk7XG4gICAgICB0aGlzLm5hdGl2ZVNlbnNvcnMuc2V0KHNlbnNvcklkLCBuZXdTZW5zb3IpO1xuICAgIH1cblxuICAgIGNvbnN0IHNlbnNvciA9IHRoaXMubmF0aXZlU2Vuc29ycy5nZXQoc2Vuc29ySWQpO1xuICAgIHJldHVybiBzZW5zb3IhLmdldFNoYXJlZFZhbHVlKCk7XG4gIH1cblxuICByZWdpc3RlclNlbnNvcihcbiAgICBzZW5zb3JUeXBlOiBTZW5zb3JUeXBlLFxuICAgIGNvbmZpZzogU2Vuc29yQ29uZmlnLFxuICAgIGhhbmRsZXI6IFNoYXJlYWJsZVJlZjwoZGF0YTogVmFsdWUzRCB8IFZhbHVlUm90YXRpb24pID0+IHZvaWQ+XG4gICk6IG51bWJlciB7XG4gICAgY29uc3Qgc2Vuc29ySWQgPSB0aGlzLmdldFNlbnNvcklkKHNlbnNvclR5cGUsIGNvbmZpZyk7XG5cbiAgICBpZiAoIXRoaXMubmF0aXZlU2Vuc29ycy5oYXMoc2Vuc29ySWQpKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgY29uc3Qgc2Vuc29yID0gdGhpcy5uYXRpdmVTZW5zb3JzLmdldChzZW5zb3JJZCk7XG4gICAgaWYgKFxuICAgICAgc2Vuc29yICYmXG4gICAgICBzZW5zb3IuaXNBdmFpbGFibGUoKSAmJlxuICAgICAgKHNlbnNvci5pc1J1bm5pbmcoKSB8fCBzZW5zb3IucmVnaXN0ZXIoaGFuZGxlcikpXG4gICAgKSB7XG4gICAgICBzZW5zb3IubGlzdGVuZXJzTnVtYmVyKys7XG4gICAgICByZXR1cm4gc2Vuc29ySWQ7XG4gICAgfVxuICAgIHJldHVybiAtMTtcbiAgfVxuXG4gIHVucmVnaXN0ZXJTZW5zb3Ioc2Vuc29ySWQ6IG51bWJlcikge1xuICAgIGlmICh0aGlzLm5hdGl2ZVNlbnNvcnMuaGFzKHNlbnNvcklkKSkge1xuICAgICAgY29uc3Qgc2Vuc29yID0gdGhpcy5uYXRpdmVTZW5zb3JzLmdldChzZW5zb3JJZCk7XG4gICAgICBpZiAoc2Vuc29yICYmIHNlbnNvci5pc1J1bm5pbmcoKSkge1xuICAgICAgICBzZW5zb3IubGlzdGVuZXJzTnVtYmVyLS07XG4gICAgICAgIGlmIChzZW5zb3IubGlzdGVuZXJzTnVtYmVyID09PSAwKSB7XG4gICAgICAgICAgc2Vuc29yLnVucmVnaXN0ZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFBLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsZUFBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFQLHNCQUFBLENBQUFD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