{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","processFilter","_slicedToArray2","filter","result","regex","RegExp","matches","exec","amount","_getFilterAmount","filterPrimitive","push","_Object$entries$","entries","filterName","filterValue","resultObject","filterArgs","filterArgAsNumber","unit","argsWithUnitsRegex","match","isNaN","Number","undefined","Math","PI"],"sources":["processFilter.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\n\nexport type FilterPrimitive =\n  | {brightness: number | string}\n  | {blur: number | string}\n  | {contrast: number | string}\n  | {grayscale: number | string}\n  | {hueRotate: number | string}\n  | {invert: number | string}\n  | {opacity: number | string}\n  | {saturate: number | string}\n  | {sepia: number | string};\n\nexport default function processFilter(\n  filter: $ReadOnlyArray<FilterPrimitive> | string,\n): $ReadOnlyArray<FilterPrimitive> {\n  let result: Array<FilterPrimitive> = [];\n  if (typeof filter === 'string') {\n    // matches on functions with args like \"brightness(1.5)\"\n    const regex = new RegExp(/(\\w+)\\(([^)]+)\\)/g);\n    let matches;\n\n    while ((matches = regex.exec(filter))) {\n      const amount = _getFilterAmount(matches[1], matches[2]);\n\n      if (amount != null) {\n        const filterPrimitive = {};\n        // $FlowFixMe The key will be the correct one but flow can't see that.\n        filterPrimitive[matches[1]] = amount;\n        // $FlowFixMe The key will be the correct one but flow can't see that.\n        result.push(filterPrimitive);\n      } else {\n        // If any primitive is invalid then apply none of the filters. This is how\n        // web works and makes it clear that something is wrong becuase no\n        // graphical effects are happening.\n        return [];\n      }\n    }\n  } else {\n    for (const filterPrimitive of filter) {\n      const [filterName, filterValue] = Object.entries(filterPrimitive)[0];\n      const amount = _getFilterAmount(filterName, filterValue);\n\n      if (amount != null) {\n        const resultObject = {};\n        // $FlowFixMe\n        resultObject[filterName] = amount;\n        // $FlowFixMe\n        result.push(resultObject);\n      } else {\n        // If any primitive is invalid then apply none of the filters. This is how\n        // web works and makes it clear that something is wrong becuase no\n        // graphical effects are happening.\n        return [];\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction _getFilterAmount(filterName: string, filterArgs: mixed): ?number {\n  let filterArgAsNumber: number;\n  let unit: string;\n  if (typeof filterArgs === 'string') {\n    // matches on args with units like \"1.5 5% -80deg\"\n    const argsWithUnitsRegex = new RegExp(/([+-]?\\d*(\\.\\d+)?)([a-zA-Z%]+)?/g);\n    const match = argsWithUnitsRegex.exec(filterArgs);\n\n    if (!match || isNaN(Number(match[1]))) {\n      return undefined;\n    }\n\n    filterArgAsNumber = Number(match[1]);\n    unit = match[3];\n  } else if (typeof filterArgs === 'number') {\n    filterArgAsNumber = filterArgs;\n  } else {\n    return undefined;\n  }\n\n  switch (filterName) {\n    // Hue rotate takes some angle that can have a unit and can be\n    // negative. Additionally, 0 with no unit is allowed.\n    case 'hueRotate':\n      if (filterArgAsNumber === 0) {\n        return 0;\n      }\n      if (unit !== 'deg' && unit !== 'rad') {\n        return undefined;\n      }\n      return unit === 'rad'\n        ? (180 * filterArgAsNumber) / Math.PI\n        : filterArgAsNumber;\n    // blur takes any positive CSS length that is not a percent. In RN\n    // we currently only have DIPs, so we are not parsing units here.\n    case 'blur':\n      if ((unit && unit !== 'px') || filterArgAsNumber < 0) {\n        return undefined;\n      }\n      return filterArgAsNumber;\n    // All other filters except take a non negative number or percentage. There\n    // are no units associated with this value and percentage numbers map 1-to-1\n    // to a non-percentage number (e.g. 50% == 0.5).\n    case 'brightness':\n    case 'contrast':\n    case 'grayscale':\n    case 'invert':\n    case 'opacity':\n    case 'saturate':\n    case 'sepia':\n      if ((unit && unit !== '%' && unit !== 'px') || filterArgAsNumber < 0) {\n        return undefined;\n      }\n      if (unit === '%') {\n        filterArgAsNumber /= 100;\n      }\n      return filterArgAsNumber;\n    default:\n      return undefined;\n  }\n}\n"],"mappings":"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","ignoreList":[]}