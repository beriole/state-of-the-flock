69ed90438b0a12aeb3a6a942488c9b25
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.InlinePropManager = void 0;
exports.getInlineStyle = getInlineStyle;
exports.hasInlineStyles = hasInlineStyles;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _utils = require("./utils");
var _ViewDescriptorsSet = require("../ViewDescriptorsSet");
var _ConfigHelper = require("../ConfigHelper");
var _UpdateProps = _interopRequireDefault(require("../UpdateProps"));
var _mappers = require("../mappers");
var _isSharedValue = require("../isSharedValue");
function isInlineStyleTransform(transform) {
  if (!Array.isArray(transform)) {
    return false;
  }
  return transform.some(function (t) {
    return hasInlineStyles(t);
  });
}
function inlinePropsHasChanged(styles1, styles2) {
  if (Object.keys(styles1).length !== Object.keys(styles2).length) {
    return true;
  }
  for (var key of Object.keys(styles1)) {
    if (styles1[key] !== styles2[key]) {
      return true;
    }
  }
  return false;
}
function getInlinePropsUpdate(inlineProps) {
  'worklet';

  var update = {};
  for (var _ref of Object.entries(inlineProps)) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
    var key = _ref2[0];
    var styleValue = _ref2[1];
    if ((0, _isSharedValue.isSharedValue)(styleValue)) {
      update[key] = styleValue.value;
    } else if (Array.isArray(styleValue)) {
      update[key] = styleValue.map(function (item) {
        return getInlinePropsUpdate(item);
      });
    } else if (typeof styleValue === 'object') {
      update[key] = getInlinePropsUpdate(styleValue);
    } else {
      update[key] = styleValue;
    }
  }
  return update;
}
function extractSharedValuesMapFromProps(props) {
  var inlineProps = {};
  for (var key in props) {
    var value = props[key];
    if (key === 'style') {
      var _props$style;
      var styles = (0, _utils.flattenArray)((_props$style = props.style) != null ? _props$style : []);
      styles.forEach(function (style) {
        if (!style) {
          return;
        }
        for (var _ref3 of Object.entries(style)) {
          var _ref4 = (0, _slicedToArray2.default)(_ref3, 2);
          var styleKey = _ref4[0];
          var styleValue = _ref4[1];
          if ((0, _isSharedValue.isSharedValue)(styleValue)) {
            inlineProps[styleKey] = styleValue;
          } else if (styleKey === 'transform' && isInlineStyleTransform(styleValue)) {
            inlineProps[styleKey] = styleValue;
          }
        }
      });
    } else if ((0, _isSharedValue.isSharedValue)(value)) {
      inlineProps[key] = value;
    }
  }
  return inlineProps;
}
function hasInlineStyles(style) {
  if (!style) {
    return false;
  }
  return Object.keys(style).some(function (key) {
    var styleValue = style[key];
    return (0, _isSharedValue.isSharedValue)(styleValue) || key === 'transform' && isInlineStyleTransform(styleValue);
  });
}
function getInlineStyle(style, isFirstRender) {
  if (isFirstRender) {
    return getInlinePropsUpdate(style);
  }
  var newStyle = {};
  for (var _ref5 of Object.entries(style)) {
    var _ref6 = (0, _slicedToArray2.default)(_ref5, 2);
    var key = _ref6[0];
    var styleValue = _ref6[1];
    if (!(0, _isSharedValue.isSharedValue)(styleValue) && !(key === 'transform' && isInlineStyleTransform(styleValue))) {
      newStyle[key] = styleValue;
    }
  }
  return newStyle;
}
var InlinePropManager = exports.InlinePropManager = function () {
  function InlinePropManager() {
    (0, _classCallCheck2.default)(this, InlinePropManager);
    this._inlinePropsViewDescriptors = null;
    this._inlinePropsMapperId = null;
    this._inlineProps = {};
  }
  return (0, _createClass2.default)(InlinePropManager, [{
    key: "attachInlineProps",
    value: function attachInlineProps(animatedComponent, viewInfo) {
      var newInlineProps = extractSharedValuesMapFromProps(animatedComponent.props);
      var hasChanged = inlinePropsHasChanged(newInlineProps, this._inlineProps);
      if (hasChanged) {
        if (!this._inlinePropsViewDescriptors) {
          this._inlinePropsViewDescriptors = (0, _ViewDescriptorsSet.makeViewDescriptorsSet)();
          var viewTag = viewInfo.viewTag,
            viewName = viewInfo.viewName,
            shadowNodeWrapper = viewInfo.shadowNodeWrapper,
            viewConfig = viewInfo.viewConfig;
          if (Object.keys(newInlineProps).length && viewConfig) {
            (0, _ConfigHelper.adaptViewConfig)(viewConfig);
          }
          this._inlinePropsViewDescriptors.add({
            tag: viewTag,
            name: viewName,
            shadowNodeWrapper: shadowNodeWrapper
          });
        }
        var shareableViewDescriptors = this._inlinePropsViewDescriptors.shareableViewDescriptors;
        var updaterFunction = function updaterFunction() {
          'worklet';

          var update = getInlinePropsUpdate(newInlineProps);
          (0, _UpdateProps.default)(shareableViewDescriptors, update);
        };
        this._inlineProps = newInlineProps;
        if (this._inlinePropsMapperId) {
          (0, _mappers.stopMapper)(this._inlinePropsMapperId);
        }
        this._inlinePropsMapperId = null;
        if (Object.keys(newInlineProps).length) {
          this._inlinePropsMapperId = (0, _mappers.startMapper)(updaterFunction, Object.values(newInlineProps));
        }
      }
    }
  }, {
    key: "detachInlineProps",
    value: function detachInlineProps() {
      if (this._inlinePropsMapperId) {
        (0, _mappers.stopMapper)(this._inlinePropsMapperId);
      }
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiSW5saW5lUHJvcE1hbmFnZXIiLCJnZXRJbmxpbmVTdHlsZSIsImhhc0lubGluZVN0eWxlcyIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX3NsaWNlZFRvQXJyYXkyIiwiX3V0aWxzIiwiX1ZpZXdEZXNjcmlwdG9yc1NldCIsIl9Db25maWdIZWxwZXIiLCJfVXBkYXRlUHJvcHMiLCJfbWFwcGVycyIsIl9pc1NoYXJlZFZhbHVlIiwiaXNJbmxpbmVTdHlsZVRyYW5zZm9ybSIsInRyYW5zZm9ybSIsIkFycmF5IiwiaXNBcnJheSIsInNvbWUiLCJ0IiwiaW5saW5lUHJvcHNIYXNDaGFuZ2VkIiwic3R5bGVzMSIsInN0eWxlczIiLCJrZXlzIiwibGVuZ3RoIiwia2V5IiwiZ2V0SW5saW5lUHJvcHNVcGRhdGUiLCJpbmxpbmVQcm9wcyIsInVwZGF0ZSIsIl9yZWYiLCJlbnRyaWVzIiwiX3JlZjIiLCJkZWZhdWx0Iiwic3R5bGVWYWx1ZSIsImlzU2hhcmVkVmFsdWUiLCJtYXAiLCJpdGVtIiwiZXh0cmFjdFNoYXJlZFZhbHVlc01hcEZyb21Qcm9wcyIsInByb3BzIiwiX3Byb3BzJHN0eWxlIiwic3R5bGVzIiwiZmxhdHRlbkFycmF5Iiwic3R5bGUiLCJmb3JFYWNoIiwiX3JlZjMiLCJfcmVmNCIsInN0eWxlS2V5IiwiaXNGaXJzdFJlbmRlciIsIm5ld1N0eWxlIiwiX3JlZjUiLCJfcmVmNiIsIl9pbmxpbmVQcm9wc1ZpZXdEZXNjcmlwdG9ycyIsIl9pbmxpbmVQcm9wc01hcHBlcklkIiwiX2lubGluZVByb3BzIiwiYXR0YWNoSW5saW5lUHJvcHMiLCJhbmltYXRlZENvbXBvbmVudCIsInZpZXdJbmZvIiwibmV3SW5saW5lUHJvcHMiLCJoYXNDaGFuZ2VkIiwibWFrZVZpZXdEZXNjcmlwdG9yc1NldCIsInZpZXdUYWciLCJ2aWV3TmFtZSIsInNoYWRvd05vZGVXcmFwcGVyIiwidmlld0NvbmZpZyIsImFkYXB0Vmlld0NvbmZpZyIsImFkZCIsInRhZyIsIm5hbWUiLCJzaGFyZWFibGVWaWV3RGVzY3JpcHRvcnMiLCJ1cGRhdGVyRnVuY3Rpb24iLCJ1cGRhdGVQcm9wcyIsInN0b3BNYXBwZXIiLCJzdGFydE1hcHBlciIsInZhbHVlcyIsImRldGFjaElubGluZVByb3BzIl0sInNvdXJjZXMiOlsiSW5saW5lUHJvcE1hbmFnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHR5cGUgeyBTdHlsZVByb3BzIH0gZnJvbSAnLi4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHR5cGUge1xuICBJQW5pbWF0ZWRDb21wb25lbnRJbnRlcm5hbCxcbiAgQW5pbWF0ZWRDb21wb25lbnRQcm9wcyxcbiAgSUlubGluZVByb3BNYW5hZ2VyLFxuICBWaWV3SW5mbyxcbn0gZnJvbSAnLi9jb21tb25UeXBlcyc7XG5pbXBvcnQgeyBmbGF0dGVuQXJyYXkgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IG1ha2VWaWV3RGVzY3JpcHRvcnNTZXQgfSBmcm9tICcuLi9WaWV3RGVzY3JpcHRvcnNTZXQnO1xuaW1wb3J0IHR5cGUgeyBWaWV3RGVzY3JpcHRvcnNTZXQgfSBmcm9tICcuLi9WaWV3RGVzY3JpcHRvcnNTZXQnO1xuaW1wb3J0IHsgYWRhcHRWaWV3Q29uZmlnIH0gZnJvbSAnLi4vQ29uZmlnSGVscGVyJztcbmltcG9ydCB1cGRhdGVQcm9wcyBmcm9tICcuLi9VcGRhdGVQcm9wcyc7XG5pbXBvcnQgeyBzdG9wTWFwcGVyLCBzdGFydE1hcHBlciB9IGZyb20gJy4uL21hcHBlcnMnO1xuaW1wb3J0IHsgaXNTaGFyZWRWYWx1ZSB9IGZyb20gJy4uL2lzU2hhcmVkVmFsdWUnO1xuXG5mdW5jdGlvbiBpc0lubGluZVN0eWxlVHJhbnNmb3JtKHRyYW5zZm9ybTogdW5rbm93bik6IGJvb2xlYW4ge1xuICBpZiAoIUFycmF5LmlzQXJyYXkodHJhbnNmb3JtKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cmFuc2Zvcm0uc29tZSgodDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pID0+IGhhc0lubGluZVN0eWxlcyh0KSk7XG59XG5cbmZ1bmN0aW9uIGlubGluZVByb3BzSGFzQ2hhbmdlZChcbiAgc3R5bGVzMTogU3R5bGVQcm9wcyxcbiAgc3R5bGVzMjogU3R5bGVQcm9wc1xuKTogYm9vbGVhbiB7XG4gIGlmIChPYmplY3Qua2V5cyhzdHlsZXMxKS5sZW5ndGggIT09IE9iamVjdC5rZXlzKHN0eWxlczIpLmxlbmd0aCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoc3R5bGVzMSkpIHtcbiAgICBpZiAoc3R5bGVzMVtrZXldICE9PSBzdHlsZXMyW2tleV0pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5saW5lUHJvcHNVcGRhdGUoaW5saW5lUHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSB7XG4gICd3b3JrbGV0JztcbiAgY29uc3QgdXBkYXRlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuICBmb3IgKGNvbnN0IFtrZXksIHN0eWxlVmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGlubGluZVByb3BzKSkge1xuICAgIGlmIChpc1NoYXJlZFZhbHVlKHN0eWxlVmFsdWUpKSB7XG4gICAgICB1cGRhdGVba2V5XSA9IHN0eWxlVmFsdWUudmFsdWU7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHN0eWxlVmFsdWUpKSB7XG4gICAgICB1cGRhdGVba2V5XSA9IHN0eWxlVmFsdWUubWFwKChpdGVtKSA9PiB7XG4gICAgICAgIHJldHVybiBnZXRJbmxpbmVQcm9wc1VwZGF0ZShpdGVtKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHN0eWxlVmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICB1cGRhdGVba2V5XSA9IGdldElubGluZVByb3BzVXBkYXRlKHN0eWxlVmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cGRhdGVba2V5XSA9IHN0eWxlVmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiB1cGRhdGU7XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTaGFyZWRWYWx1ZXNNYXBGcm9tUHJvcHMoXG4gIHByb3BzOiBBbmltYXRlZENvbXBvbmVudFByb3BzPFxuICAgIFJlY29yZDxzdHJpbmcsIHVua25vd24+IC8qIEluaXRpYWwgY29tcG9uZW50IHByb3BzICovXG4gID5cbik6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgY29uc3QgaW5saW5lUHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG5cbiAgZm9yIChjb25zdCBrZXkgaW4gcHJvcHMpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHByb3BzW2tleV07XG4gICAgaWYgKGtleSA9PT0gJ3N0eWxlJykge1xuICAgICAgY29uc3Qgc3R5bGVzID0gZmxhdHRlbkFycmF5PFN0eWxlUHJvcHM+KHByb3BzLnN0eWxlID8/IFtdKTtcbiAgICAgIHN0eWxlcy5mb3JFYWNoKChzdHlsZSkgPT4ge1xuICAgICAgICBpZiAoIXN0eWxlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW3N0eWxlS2V5LCBzdHlsZVZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzdHlsZSkpIHtcbiAgICAgICAgICBpZiAoaXNTaGFyZWRWYWx1ZShzdHlsZVZhbHVlKSkge1xuICAgICAgICAgICAgaW5saW5lUHJvcHNbc3R5bGVLZXldID0gc3R5bGVWYWx1ZTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgc3R5bGVLZXkgPT09ICd0cmFuc2Zvcm0nICYmXG4gICAgICAgICAgICBpc0lubGluZVN0eWxlVHJhbnNmb3JtKHN0eWxlVmFsdWUpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBpbmxpbmVQcm9wc1tzdHlsZUtleV0gPSBzdHlsZVZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChpc1NoYXJlZFZhbHVlKHZhbHVlKSkge1xuICAgICAgaW5saW5lUHJvcHNba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpbmxpbmVQcm9wcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc0lubGluZVN0eWxlcyhzdHlsZTogU3R5bGVQcm9wcyk6IGJvb2xlYW4ge1xuICBpZiAoIXN0eWxlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBPYmplY3Qua2V5cyhzdHlsZSkuc29tZSgoa2V5KSA9PiB7XG4gICAgY29uc3Qgc3R5bGVWYWx1ZSA9IHN0eWxlW2tleV07XG4gICAgcmV0dXJuIChcbiAgICAgIGlzU2hhcmVkVmFsdWUoc3R5bGVWYWx1ZSkgfHxcbiAgICAgIChrZXkgPT09ICd0cmFuc2Zvcm0nICYmIGlzSW5saW5lU3R5bGVUcmFuc2Zvcm0oc3R5bGVWYWx1ZSkpXG4gICAgKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbmxpbmVTdHlsZShcbiAgc3R5bGU6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICBpc0ZpcnN0UmVuZGVyOiBib29sZWFuXG4pIHtcbiAgaWYgKGlzRmlyc3RSZW5kZXIpIHtcbiAgICByZXR1cm4gZ2V0SW5saW5lUHJvcHNVcGRhdGUoc3R5bGUpO1xuICB9XG4gIGNvbnN0IG5ld1N0eWxlOiBTdHlsZVByb3BzID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgc3R5bGVWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoc3R5bGUpKSB7XG4gICAgaWYgKFxuICAgICAgIWlzU2hhcmVkVmFsdWUoc3R5bGVWYWx1ZSkgJiZcbiAgICAgICEoa2V5ID09PSAndHJhbnNmb3JtJyAmJiBpc0lubGluZVN0eWxlVHJhbnNmb3JtKHN0eWxlVmFsdWUpKVxuICAgICkge1xuICAgICAgbmV3U3R5bGVba2V5XSA9IHN0eWxlVmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXdTdHlsZTtcbn1cblxuZXhwb3J0IGNsYXNzIElubGluZVByb3BNYW5hZ2VyIGltcGxlbWVudHMgSUlubGluZVByb3BNYW5hZ2VyIHtcbiAgX2lubGluZVByb3BzVmlld0Rlc2NyaXB0b3JzOiBWaWV3RGVzY3JpcHRvcnNTZXQgfCBudWxsID0gbnVsbDtcbiAgX2lubGluZVByb3BzTWFwcGVySWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICBfaW5saW5lUHJvcHM6IFN0eWxlUHJvcHMgPSB7fTtcblxuICBwdWJsaWMgYXR0YWNoSW5saW5lUHJvcHMoXG4gICAgYW5pbWF0ZWRDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudDx1bmtub3duLCB1bmtub3duPiAmXG4gICAgICBJQW5pbWF0ZWRDb21wb25lbnRJbnRlcm5hbCxcbiAgICB2aWV3SW5mbzogVmlld0luZm9cbiAgKSB7XG4gICAgY29uc3QgbmV3SW5saW5lUHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID1cbiAgICAgIGV4dHJhY3RTaGFyZWRWYWx1ZXNNYXBGcm9tUHJvcHMoYW5pbWF0ZWRDb21wb25lbnQucHJvcHMpO1xuICAgIGNvbnN0IGhhc0NoYW5nZWQgPSBpbmxpbmVQcm9wc0hhc0NoYW5nZWQobmV3SW5saW5lUHJvcHMsIHRoaXMuX2lubGluZVByb3BzKTtcblxuICAgIGlmIChoYXNDaGFuZ2VkKSB7XG4gICAgICBpZiAoIXRoaXMuX2lubGluZVByb3BzVmlld0Rlc2NyaXB0b3JzKSB7XG4gICAgICAgIHRoaXMuX2lubGluZVByb3BzVmlld0Rlc2NyaXB0b3JzID0gbWFrZVZpZXdEZXNjcmlwdG9yc1NldCgpO1xuXG4gICAgICAgIGNvbnN0IHsgdmlld1RhZywgdmlld05hbWUsIHNoYWRvd05vZGVXcmFwcGVyLCB2aWV3Q29uZmlnIH0gPSB2aWV3SW5mbztcblxuICAgICAgICBpZiAoT2JqZWN0LmtleXMobmV3SW5saW5lUHJvcHMpLmxlbmd0aCAmJiB2aWV3Q29uZmlnKSB7XG4gICAgICAgICAgYWRhcHRWaWV3Q29uZmlnKHZpZXdDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faW5saW5lUHJvcHNWaWV3RGVzY3JpcHRvcnMuYWRkKHtcbiAgICAgICAgICB0YWc6IHZpZXdUYWcgYXMgbnVtYmVyLFxuICAgICAgICAgIG5hbWU6IHZpZXdOYW1lISxcbiAgICAgICAgICBzaGFkb3dOb2RlV3JhcHBlcjogc2hhZG93Tm9kZVdyYXBwZXIhLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNoYXJlYWJsZVZpZXdEZXNjcmlwdG9ycyA9XG4gICAgICAgIHRoaXMuX2lubGluZVByb3BzVmlld0Rlc2NyaXB0b3JzLnNoYXJlYWJsZVZpZXdEZXNjcmlwdG9ycztcblxuICAgICAgY29uc3QgdXBkYXRlckZ1bmN0aW9uID0gKCkgPT4ge1xuICAgICAgICAnd29ya2xldCc7XG4gICAgICAgIGNvbnN0IHVwZGF0ZSA9IGdldElubGluZVByb3BzVXBkYXRlKG5ld0lubGluZVByb3BzKTtcbiAgICAgICAgdXBkYXRlUHJvcHMoc2hhcmVhYmxlVmlld0Rlc2NyaXB0b3JzLCB1cGRhdGUpO1xuICAgICAgfTtcbiAgICAgIHRoaXMuX2lubGluZVByb3BzID0gbmV3SW5saW5lUHJvcHM7XG4gICAgICBpZiAodGhpcy5faW5saW5lUHJvcHNNYXBwZXJJZCkge1xuICAgICAgICBzdG9wTWFwcGVyKHRoaXMuX2lubGluZVByb3BzTWFwcGVySWQpO1xuICAgICAgfVxuICAgICAgdGhpcy5faW5saW5lUHJvcHNNYXBwZXJJZCA9IG51bGw7XG4gICAgICBpZiAoT2JqZWN0LmtleXMobmV3SW5saW5lUHJvcHMpLmxlbmd0aCkge1xuICAgICAgICB0aGlzLl9pbmxpbmVQcm9wc01hcHBlcklkID0gc3RhcnRNYXBwZXIoXG4gICAgICAgICAgdXBkYXRlckZ1bmN0aW9uLFxuICAgICAgICAgIE9iamVjdC52YWx1ZXMobmV3SW5saW5lUHJvcHMpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRldGFjaElubGluZVByb3BzKCkge1xuICAgIGlmICh0aGlzLl9pbmxpbmVQcm9wc01hcHBlcklkKSB7XG4gICAgICBzdG9wTWFwcGVyKHRoaXMuX2lubGluZVByb3BzTWFwcGVySWQpO1xuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsaUJBQUE7QUFBQUYsT0FBQSxDQUFBRyxjQUFBLEdBQUFBLGNBQUE7QUFBQUgsT0FBQSxDQUFBSSxlQUFBLEdBQUFBLGVBQUE7QUFBQSxJQUFBQyxnQkFBQSxHQUFBVCxzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQVMsYUFBQSxHQUFBVixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQVUsZUFBQSxHQUFBWCxzQkFBQSxDQUFBQyxPQUFBO0FBUWIsSUFBQVcsTUFBQSxHQUFBWCxPQUFBO0FBQ0EsSUFBQVksbUJBQUEsR0FBQVosT0FBQTtBQUVBLElBQUFhLGFBQUEsR0FBQWIsT0FBQTtBQUNBLElBQUFjLFlBQUEsR0FBQWYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFlLFFBQUEsR0FBQWYsT0FBQTtBQUNBLElBQUFnQixjQUFBLEdBQUFoQixPQUFBO0FBRUEsU0FBU2lCLHNCQUFzQkEsQ0FBQ0MsU0FBa0IsRUFBVztFQUMzRCxJQUFJLENBQUNDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDRixTQUFTLENBQUMsRUFBRTtJQUM3QixPQUFPLEtBQUs7RUFDZDtFQUVBLE9BQU9BLFNBQVMsQ0FBQ0csSUFBSSxDQUFDLFVBQUNDLENB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