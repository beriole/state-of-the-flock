6807cca9cc49394a0c958e0130e41b3d
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.makeShareable = void 0;
exports.makeShareableCloneOnUIRecursive = makeShareableCloneOnUIRecursive;
exports.makeShareableCloneRecursive = makeShareableCloneRecursive;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _NativeReanimated = _interopRequireDefault(require("./NativeReanimated"));
var _commonTypes = require("./commonTypes");
var _PlatformChecker = require("./PlatformChecker");
var _errors = require("./errors");
var _jsVersion = require("./platform-specific/jsVersion");
var _shareableMappingCache = require("./shareableMappingCache");
var SHOULD_BE_USE_WEB = (0, _PlatformChecker.shouldBeUseWeb)();
var MAGIC_KEY = 'REANIMATED_MAGIC_KEY';
function isHostObject(value) {
  'worklet';
  return MAGIC_KEY in value;
}
function isPlainJSObject(object) {
  return Object.getPrototypeOf(object) === Object.prototype;
}
var INACCESSIBLE_OBJECT = {
  __init: function __init() {
    'worklet';

    return new Proxy({}, {
      get: function get(_, prop) {
        if (prop === '_isReanimatedSharedValue' || prop === '__remoteFunction') {
          return false;
        }
        throw new Error(`[Reanimated] Trying to access property \`${String(prop)}\` of an object which cannot be sent to the UI runtime.`);
      },
      set: function set() {
        throw new Error('[Reanimated] Trying to write to an object which cannot be sent to the UI runtime.');
      }
    });
  }
};
var VALID_ARRAY_VIEWS_NAMES = ['Int8Array', 'Uint8Array', 'Uint8ClampedArray', 'Int16Array', 'Uint16Array', 'Int32Array', 'Uint32Array', 'Float32Array', 'Float64Array', 'BigInt64Array', 'BigUint64Array', 'DataView'];
var DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD = 30;
var processedObjectAtThresholdDepth;
function makeShareableCloneRecursive(value) {
  var shouldPersistRemote = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var depth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
  if (SHOULD_BE_USE_WEB) {
    return value;
  }
  if (depth >= DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD) {
    if (depth === DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD) {
      processedObjectAtThresholdDepth = value;
    } else if (value === processedObjectAtThresholdDepth) {
      throw new Error('[Reanimated] Trying to convert a cyclic object to a shareable. This is not supported.');
    }
  } else {
    processedObjectAtThresholdDepth = undefined;
  }
  var type = typeof value;
  var isTypeObject = type === 'object';
  var isTypeFunction = type === 'function';
  if ((isTypeObject || isTypeFunction) && value !== null) {
    var cached = _shareableMappingCache.shareableMappingCache.get(value);
    if (cached === _shareableMappingCache.shareableMappingFlag) {
      return value;
    } else if (cached !== undefined) {
      return cached;
    } else {
      var toAdapt;
      if (Array.isArray(value)) {
        toAdapt = value.map(function (element) {
          return makeShareableCloneRecursive(element, shouldPersistRemote, depth + 1);
        });
        freezeObjectIfDev(value);
      } else if (isTypeFunction && !(0, _commonTypes.isWorkletFunction)(value)) {
        toAdapt = value;
        freezeObjectIfDev(value);
      } else if (isHostObject(value)) {
        toAdapt = value;
      } else if (isPlainJSObject(value) && value.__workletContextObjectFactory) {
        var workletContextObjectFactory = value.__workletContextObjectFactory;
        var handle = makeShareableCloneRecursive({
          __init: function __init() {
            'worklet';

            return workletContextObjectFactory();
          }
        });
        _shareableMappingCache.shareableMappingCache.set(value, handle);
        return handle;
      } else if (isPlainJSObject(value) || isTypeFunction) {
        toAdapt = {};
        if ((0, _commonTypes.isWorkletFunction)(value)) {
          if (__DEV__) {
            var babelVersion = value.__initData.version;
            if (babelVersion !== undefined && babelVersion !== _jsVersion.jsVersion) {
              throw new Error(`[Reanimated] Mismatch between JavaScript code version and Reanimated Babel plugin version (${_jsVersion.jsVersion} vs. ${babelVersion}).        
See \`https://docs.swmansion.com/react-native-reanimated/docs/guides/troubleshooting#mismatch-between-javascript-code-version-and-reanimated-babel-plugin-version\` for more details.
Offending code was: \`${getWorkletCode(value)}\``);
            }
            (0, _errors.registerWorkletStackDetails)(value.__workletHash, value.__stackDetails);
          }
          if (value.__stackDetails) {
            delete value.__stackDetails;
          }
          toAdapt.__initData = makeShareableCloneRecursive(value.__initData, true, depth + 1);
        }
        for (var _ref of Object.entries(value)) {
          var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
          var key = _ref2[0];
          var element = _ref2[1];
          if (key === '__initData' && toAdapt.__initData !== undefined) {
            continue;
          }
          toAdapt[key] = makeShareableCloneRecursive(element, shouldPersistRemote, depth + 1);
        }
        freezeObjectIfDev(value);
      } else if (value instanceof RegExp) {
        var pattern = value.source;
        var flags = value.flags;
        var _handle = makeShareableCloneRecursive({
          __init: function __init() {
            'worklet';

            return new RegExp(pattern, flags);
          }
        });
        _shareableMappingCache.shareableMappingCache.set(value, _handle);
        return _handle;
      } else if (value instanceof Error) {
        var name = value.name,
          message = value.message,
          stack = value.stack;
        var _handle2 = makeShareableCloneRecursive({
          __init: function __init() {
            'worklet';

            var error = new Error();
            error.name = name;
            error.message = message;
            error.stack = stack;
            return error;
          }
        });
        _shareableMappingCache.shareableMappingCache.set(value, _handle2);
        return _handle2;
      } else if (value instanceof ArrayBuffer) {
        toAdapt = value;
      } else if (ArrayBuffer.isView(value)) {
        var buffer = value.buffer;
        var typeName = value.constructor.name;
        var _handle3 = makeShareableCloneRecursive({
          __init: function __init() {
            'worklet';

            if (!VALID_ARRAY_VIEWS_NAMES.includes(typeName)) {
              throw new Error(`[Reanimated] Invalid array view name \`${typeName}\`.`);
            }
            var constructor = global[typeName];
            if (constructor === undefined) {
              throw new Error(`[Reanimated] Constructor for \`${typeName}\` not found.`);
            }
            return new constructor(buffer);
          }
        });
        _shareableMappingCache.shareableMappingCache.set(value, _handle3);
        return _handle3;
      } else {
        var inaccessibleObject = makeShareableCloneRecursive(INACCESSIBLE_OBJECT);
        _shareableMappingCache.shareableMappingCache.set(value, inaccessibleObject);
        return inaccessibleObject;
      }
      var adapted = _NativeReanimated.default.makeShareableClone(toAdapt, shouldPersistRemote, value);
      _shareableMappingCache.shareableMappingCache.set(value, adapted);
      _shareableMappingCache.shareableMappingCache.set(adapted);
      return adapted;
    }
  }
  return _NativeReanimated.default.makeShareableClone(value, shouldPersistRemote, undefined);
}
var WORKLET_CODE_THRESHOLD = 255;
function getWorkletCode(value) {
  var _value$__initData;
  var code = value == null || (_value$__initData = value.__initData) == null ? void 0 : _value$__initData.code;
  if (!code) {
    return 'unknown';
  }
  if (code.length > WORKLET_CODE_THRESHOLD) {
    return `${code.substring(0, WORKLET_CODE_THRESHOLD)}...`;
  }
  return code;
}
function isRemoteFunction(value) {
  'worklet';

  return !!value.__remoteFunction;
}
function freezeObjectIfDev(value) {
  if (!__DEV__) {
    return;
  }
  Object.entries(value).forEach(function (_ref3) {
    var _ref4 = (0, _slicedToArray2.default)(_ref3, 2),
      key = _ref4[0],
      element = _ref4[1];
    var descriptor = Object.getOwnPropertyDescriptor(value, key);
    if (!descriptor.configurable) {
      return;
    }
    Object.defineProperty(value, key, {
      get: function get() {
        return element;
      },
      set: function set() {
        console.warn(`[Reanimated] Tried to modify key \`${key}\` of an object which has been already passed to a worklet. See 
https://docs.swmansion.com/react-native-reanimated/docs/guides/troubleshooting#tried-to-modify-key-of-an-object-which-has-been-converted-to-a-shareable 
for more details.`);
      }
    });
  });
  Object.preventExtensions(value);
}
function makeShareableCloneOnUIRecursive(value) {
  'worklet';

  if (SHOULD_BE_USE_WEB) {
    return value;
  }
  function cloneRecursive(value) {
    if (typeof value === 'object' && value !== null || typeof value === 'function') {
      if (isHostObject(value)) {
        return global._makeShareableClone(value, undefined);
      }
      if (isRemoteFunction(value)) {
        return value.__remoteFunction;
      }
      if (Array.isArray(value)) {
        return global._makeShareableClone(value.map(cloneRecursive), undefined);
      }
      var toAdapt = {};
      for (var _ref5 of Object.entries(value)) {
        var _ref6 = (0, _slicedToArray2.default)(_ref5, 2);
        var key = _ref6[0];
        var element = _ref6[1];
        toAdapt[key] = cloneRecursive(element);
      }
      return global._makeShareableClone(toAdapt, value);
    }
    return global._makeShareableClone(value, undefined);
  }
  return cloneRecursive(value);
}
function makeShareableJS(value) {
  return value;
}
function makeShareableNative(value) {
  if (_shareableMappingCache.shareableMappingCache.get(value)) {
    return value;
  }
  var handle = makeShareableCloneRecursive({
    __init: function __init() {
      'worklet';

      return value;
    }
  });
  _shareableMappingCache.shareableMappingCache.set(value, handle);
  return value;
}
var makeShareable = exports.makeShareable = SHOULD_BE_USE_WEB ? makeShareableJS : makeShareableNative;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwibWFrZVNoYXJlYWJsZSIsIm1ha2VTaGFyZWFibGVDbG9uZU9uVUlSZWN1cnNpdmUiLCJtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUiLCJfc2xpY2VkVG9BcnJheTIiLCJfTmF0aXZlUmVhbmltYXRlZCIsIl9jb21tb25UeXBlcyIsIl9QbGF0Zm9ybUNoZWNrZXIiLCJfZXJyb3JzIiwiX2pzVmVyc2lvbiIsIl9zaGFyZWFibGVNYXBwaW5nQ2FjaGUiLCJTSE9VTERfQkVfVVNFX1dFQiIsInNob3VsZEJlVXNlV2ViIiwiTUFHSUNfS0VZIiwiaXNIb3N0T2JqZWN0IiwiaXNQbGFpbkpTT2JqZWN0Iiwib2JqZWN0IiwiZ2V0UHJvdG90eXBlT2YiLCJwcm90b3R5cGUiLCJJTkFDQ0VTU0lCTEVfT0JKRUNUIiwiX19pbml0IiwiUHJveHkiLCJnZXQiLCJfIiwicHJvcCIsIkVycm9yIiwiU3RyaW5nIiwic2V0IiwiVkFMSURfQVJSQVlfVklFV1NfTkFNRVMiLCJERVRFQ1RfQ1lDTElDX09CSkVDVF9ERVBUSF9USFJFU0hPTEQiLCJwcm9jZXNzZWRPYmplY3RBdFRocmVzaG9sZERlcHRoIiwic2hvdWxkUGVyc2lzdFJlbW90ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImRlcHRoIiwidHlwZSIsImlzVHlwZU9iamVjdCIsImlzVHlwZUZ1bmN0aW9uIiwiY2FjaGVkIiwic2hhcmVhYmxlTWFwcGluZ0NhY2hlIiwic2hhcmVhYmxlTWFwcGluZ0ZsYWciLCJ0b0FkYXB0IiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiZWxlbWVudCIsImZyZWV6ZU9iamVjdElmRGV2IiwiaXNXb3JrbGV0RnVuY3Rpb24iLCJfX3dvcmtsZXRDb250ZXh0T2JqZWN0RmFjdG9yeSIsIndvcmtsZXRDb250ZXh0T2JqZWN0RmFjdG9yeSIsImhhbmRsZSIsIl9fREVWX18iLCJiYWJlbFZlcnNpb24iLCJfX2luaXREYXRhIiwidmVyc2lvbiIsImpzVmVyc2lvbiIsImdldFdvcmtsZXRDb2RlIiwicmVnaXN0ZXJXb3JrbGV0U3RhY2tEZXRhaWxzIiwiX193b3JrbGV0SGFzaCIsIl9fc3RhY2tEZXRhaWxzIiwiX3JlZiIsImVudHJpZXMiLCJfcmVmMiIsImRlZmF1bHQiLCJrZXkiLCJSZWdFeHAiLCJwYXR0ZXJuIiwic291cmNlIiwiZmxhZ3MiLCJuYW1lIiwibWVzc2FnZSIsInN0YWNrIiwiZXJyb3IiLCJBcnJheUJ1ZmZlciIsImlzVmlldyIsImJ1ZmZlciIsInR5cGVOYW1lIiwiY29uc3RydWN0b3IiLCJpbmNsdWRlcyIsImdsb2JhbCIsImluYWNjZXNzaWJsZU9iamVjdCIsImFkYXB0ZWQiLCJOYXRpdmVSZWFuaW1hdGVkTW9kdWxlIiwibWFrZVNoYXJlYWJsZUNsb25lIiwiV09SS0xFVF9DT0RFX1RIUkVTSE9MRCIsIl92YWx1ZSRfX2luaXREYXRhIiwiY29kZSIsInN1YnN0cmluZyIsImlzUmVtb3RlRnVuY3Rpb24iLCJfX3JlbW90ZUZ1bmN0aW9uIiwiZm9yRWFjaCIsIl9yZWYzIiwiX3JlZjQiLCJkZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiY29uZmlndXJhYmxlIiwiY29uc29sZSIsIndhcm4iLCJwcmV2ZW50RXh0ZW5zaW9ucyIsImNsb25lUmVjdXJzaXZlIiwiX21ha2VTaGFyZWFibGVDbG9uZSIsIl9yZWY1IiwiX3JlZjYiLCJtYWtlU2hhcmVhYmxlSlMiLCJtYWtlU2hhcmVhYmxlTmF0aXZlIl0sInNvdXJjZXMiOlsic2hhcmVhYmxlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgTmF0aXZlUmVhbmltYXRlZE1vZHVsZSBmcm9tICcuL05hdGl2ZVJlYW5pbWF0ZWQnO1xuaW1wb3J0IHsgaXNXb3JrbGV0RnVuY3Rpb24gfSBmcm9tICcuL2NvbW1vblR5cGVzJztcbmltcG9ydCB0eXBlIHtcbiAgU2hhcmVhYmxlUmVmLFxuICBGbGF0U2hhcmVhYmxlUmVmLFxuICBXb3JrbGV0RnVuY3Rpb24sXG59IGZyb20gJy4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgc2hvdWxkQmVVc2VXZWIgfSBmcm9tICcuL1BsYXRmb3JtQ2hlY2tlcic7XG5pbXBvcnQgeyByZWdpc3RlcldvcmtsZXRTdGFja0RldGFpbHMgfSBmcm9tICcuL2Vycm9ycyc7XG5pbXBvcnQgeyBqc1ZlcnNpb24gfSBmcm9tICcuL3BsYXRmb3JtLXNwZWNpZmljL2pzVmVyc2lvbic7XG5pbXBvcnQge1xuICBzaGFyZWFibGVNYXBwaW5nQ2FjaGUsXG4gIHNoYXJlYWJsZU1hcHBpbmdGbGFnLFxufSBmcm9tICcuL3NoYXJlYWJsZU1hcHBpbmdDYWNoZSc7XG5cbi8vIGZvciB3ZWIvY2hyb21lIGRlYnVnZ2VyL2plc3QgZW52aXJvbm1lbnRzIHRoaXMgZmlsZSBwcm92aWRlcyBhIHN0dWIgaW1wbGVtZW50YXRpb25cbi8vIHdoZXJlIG5vIHNoYXJlYWJsZSByZWZlcmVuY2VzIGFyZSB1c2VkLiBJbnN0ZWFkLCB0aGUgb2JqZWN0cyB0aGVtc2VsdmVzIGFyZSB1c2VkXG4vLyBpbnN0ZWFkIG9mIHNoYXJlYWJsZSByZWZlcmVuY2VzLCBiZWNhdXNlIG9mIHRoZSBmYWN0IHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBkZWFsIHdpdGhcbi8vIHJ1bm5pbmcgdGhlIGNvZGUgb24gc2VwYXJhdGUgVk1zLlxuY29uc3QgU0hPVUxEX0JFX1VTRV9XRUIgPSBzaG91bGRCZVVzZVdlYigpO1xuXG5jb25zdCBNQUdJQ19LRVkgPSAnUkVBTklNQVRFRF9NQUdJQ19LRVknO1xuXG5mdW5jdGlvbiBpc0hvc3RPYmplY3QodmFsdWU6IE5vbk51bGxhYmxlPG9iamVjdD4pIHtcbiAgJ3dvcmtsZXQnO1xuICAvLyBXZSBjb3VsZCB1c2UgSlNJIHRvIGRldGVybWluZSB3aGV0aGVyIGFuIG9iamVjdCBpcyBhIGhvc3Qgb2JqZWN0LCBob3dldmVyXG4gIC8vIHRoZSBiZWxvdyB3b3JrYXJvdW5kIHdvcmtzIHdlbGwgYW5kIGlzIHdheSBmYXN0ZXIgdGhhbiBhbiBhZGRpdGlvbmFsIEpTSSBjYWxsLlxuICAvLyBXZSB1c2UgdGhlIGZhY3QgdGhhdCBob3N0IG9iamVjdHMgaGF2ZSBicm9rZW4gaW1wbGVtZW50YXRpb24gb2YgYGhhc093blByb3BlcnR5YFxuICAvLyBhbmQgaGVuY2UgcmV0dXJuIHRydWUgZm9yIGFsbCBgaW5gIGNoZWNrcyByZWdhcmRsZXNzIG9mIHRoZSBrZXkgd2UgYXNrIGZvci5cbiAgcmV0dXJuIE1BR0lDX0tFWSBpbiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gaXNQbGFpbkpTT2JqZWN0KG9iamVjdDogb2JqZWN0KSB7XG4gIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcbn1cblxuLy8gVGhlIGJlbG93IG9iamVjdCBpcyB1c2VkIGFzIGEgcmVwbGFjZW1lbnQgZm9yIG9iamVjdHMgdGhhdCBjYW5ub3QgYmUgdHJhbnNmZXJyZWRcbi8vIGFzIHNoYXJlYWJsZSB2YWx1ZXMuIEluIG1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZSB3ZSBkZXRlY3QgaWYgYW4gb2JqZWN0IGlzIG9mXG4vLyBhIHBsYWluIE9iamVjdC5wcm90b3R5cGUgYW5kIG9ubHkgYWxsb3cgc3VjaCBvYmplY3RzIHRvIGJlIHRyYW5zZmVycmVkLiBUaGlzIGxldHNcbi8vIHVzIGF2b2lkIGFsbCBzb3J0cyBvZiByZWFjdCBpbnRlcm5hbHMgZnJvbSBsZWFraW5nIGludG8gdGhlIFVJIHJ1bnRpbWUuIFRvIG1ha2UgaXRcbi8vIHBvc3NpYmxlIHRvIGNhdGNoIGVycm9ycyB3aGVuIHNvbWVvbmUgYWN0dWFsbHkgdHJpZXMgdG8gYWNjZXNzIHN1Y2ggb2JqZWN0IG9uIHRoZSBVSVxuLy8gcnVudGltZSwgd2UgdXNlIHRoZSBiZWxvdyBQcm94eSBvYmplY3Qgd2hpY2ggaXMgaW5zdGFudGlhdGVkIG9uIHRoZSBVSSBydW50aW1lIGFuZFxuLy8gdGhyb3dzIHdoZW5ldmVyIHNvbWVvbmUgdHJpZXMgdG8gYWNjZXNzIGl0cyBmaWVsZHMuXG5jb25zdCBJTkFDQ0VTU0lCTEVfT0JKRUNUID0ge1xuICBfX2luaXQ6ICgpID0+IHtcbiAgICAnd29ya2xldCc7XG4gICAgcmV0dXJuIG5ldyBQcm94eShcbiAgICAgIHt9LFxuICAgICAge1xuICAgICAgICBnZXQ6IChfOiB1bmtub3duLCBwcm9wOiBzdHJpbmcgfCBzeW1ib2wpID0+IHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwcm9wID09PSAnX2lzUmVhbmltYXRlZFNoYXJlZFZhbHVlJyB8fFxuICAgICAgICAgICAgcHJvcCA9PT0gJ19fcmVtb3RlRnVuY3Rpb24nXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyBub3QgdmVyeSBoYXBweSBhYm91dCB0aGlzIGNoZWNrIGhlcmUsIGJ1dCB3ZSBuZWVkIHRvIGFsbG93IGZvclxuICAgICAgICAgICAgLy8gXCJpbmFjY2Vzc2libGVcIiBvYmplY3RzIHRvIGJlIHRlc3RlZCB3aXRoIGlzU2hhcmVkVmFsdWUgY2hlY2tcbiAgICAgICAgICAgIC8vIGFzIGl0IGlzIGJlaW5nIHVzZWQgaW4gdGhlIG1hcHBlcnMgd2hlbiBleHRyYWN0aW5nIGlucHV0cyByZWN1cnNpdmVseVxuICAgICAgICAgICAgLy8gYXMgd2VsbCBhcyB3aXRoIGlzUmVtb3RlRnVuY3Rpb24gd2hlbiBjbG9uaW5nIG9iamVjdHMgcmVjdXJzaXZlbHkuXG4gICAgICAgICAgICAvLyBBcHBhcmVudGx5IHdlIGNhbid0IGNoZWNrIGlmIGEga2V5IGV4aXN0cyB0aGVyZSBhcyBIb3N0T2JqZWN0cyBhbHdheXNcbiAgICAgICAgICAgIC8vIHJldHVybiB0cnVlIGZvciBzdWNoIHRlc3RzLCBzbyB0aGUgb25seSBwb3NzaWJpbGl0eSBmb3IgdXMgaXMgdG9cbiAgICAgICAgICAgIC8vIGFjdHVhbGx5IGFjY2VzcyB0aGF0IGtleSBhbmQgc2VlIGlmIGl0IGlzIHNldCB0byB0cnVlLiBXZSB0aGVyZWZvcmVcbiAgICAgICAgICAgIC8vIG5lZWQgdG8gYWxsb3cgZm9yIHRoaXMga2V5IHRvIGJlIGFjY2Vzc2VkIGhlcmUuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBbUmVhbmltYXRlZF0gVHJ5aW5nIHRvIGFjY2VzcyBwcm9wZXJ0eSBcXGAke1N0cmluZyhcbiAgICAgICAgICAgICAgcHJvcFxuICAgICAgICAgICAgKX1cXGAgb2YgYW4gb2JqZWN0IHdoaWNoIGNhbm5vdCBiZSBzZW50IHRvIHRoZSBVSSBydW50aW1lLmBcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6ICgpID0+IHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnW1JlYW5pbWF0ZWRdIFRyeWluZyB0byB3cml0ZSB0byBhbiBvYmplY3Qgd2hpY2ggY2Fubm90IGJlIHNlbnQgdG8gdGhlIFVJIHJ1bnRpbWUuJ1xuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbn07XG5cbmNvbnN0IFZBTElEX0FSUkFZX1ZJRVdTX05BTUVTID0gW1xuICAnSW50OEFycmF5JyxcbiAgJ1VpbnQ4QXJyYXknLFxuICAnVWludDhDbGFtcGVkQXJyYXknLFxuICAnSW50MTZBcnJheScsXG4gICdVaW50MTZBcnJheScsXG4gICdJbnQzMkFycmF5JyxcbiAgJ1VpbnQzMkFycmF5JyxcbiAgJ0Zsb2F0MzJBcnJheScsXG4gICdGbG9hdDY0QXJyYXknLFxuICAnQmlnSW50NjRBcnJheScsXG4gICdCaWdVaW50NjRBcnJheScsXG4gICdEYXRhVmlldycsXG5dO1xuXG5jb25zdCBERVRFQ1RfQ1lDTElDX09CSkVDVF9ERVBUSF9USFJFU0hPTEQgPSAzMDtcbi8vIEJlbG93IHZhcmlhYmxlIHN0b3JlcyBvYmplY3QgdGhhdCB3ZSBwcm9jZXNzIGluIG1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZSBhdCB0aGUgc3BlY2lmaWVkIGRlcHRoLlxuLy8gV2UgdXNlIGl0IHRvIGNoZWNrIGlmIGxhdGVyIG9uIHRoZSBmdW5jdGlvbiByZWVudGVycyB3aXRoIHRoZSBzYW1lIG9iamVjdFxubGV0IHByb2Nlc3NlZE9iamVjdEF0VGhyZXNob2xkRGVwdGg6IHVua25vd247XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmU8VD4oXG4gIHZhbHVlOiBhbnksXG4gIHNob3VsZFBlcnNpc3RSZW1vdGUgPSBmYWxzZSxcbiAgZGVwdGggPSAwXG4pOiBTaGFyZWFibGVSZWY8VD4ge1xuICBpZiAoU0hPVUxEX0JFX1VTRV9XRUIpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKGRlcHRoID49IERFVEVDVF9DWUNMSUNfT0JKRUNUX0RFUFRIX1RIUkVTSE9MRCkge1xuICAgIC8vIGlmIHdlIHJlYWNoIGNlcnRhaW4gcmVjdXJzaW9uIGRlcHRoIHdlIHN1c3BlY3QgdGhhdCB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgY3ljbGljIG9iamVjdC5cbiAgICAvLyB0aGlzIHR5cGUgb2Ygb2JqZWN0cyBhcmUgbm90IHN1cHBvcnRlZCBhbmQgY2Fubm90IGJlIHRyYW5zZmVycmVkIGFzIHNoYXJlYWJsZSwgc28gd2VcbiAgICAvLyBpbXBsZW1lbnQgYSBzaW1wbGUgZGV0ZWN0aW9uIG1lY2hhbmlzbSB0aGF0IHJlbWVtYmVycyB0aGUgdmFsdWUgYXQgYSBnaXZlbiBkZXB0aCBhbmRcbiAgICAvLyB0ZXN0cyB3aGV0aGVyIHdlIHRyeSByZWVudGVyIHRoaXMgbWV0aG9kIGxhdGVyIG9uIHdpdGggdGhlIHNhbWUgdmFsdWUuIElmIHRoYXQgaGFwcGVuc1xuICAgIC8vIHdlIHRocm93IGFuIGFwcHJvcHJpYXRlIGVycm9yLlxuICAgIGlmIChkZXB0aCA9PT0gREVURUNUX0NZQ0xJQ19PQkpFQ1RfREVQVEhfVEhSRVNIT0xEKSB7XG4gICAgICBwcm9jZXNzZWRPYmplY3RBdFRocmVzaG9sZERlcHRoID0gdmFsdWU7XG4gICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gcHJvY2Vzc2VkT2JqZWN0QXRUaHJlc2hvbGREZXB0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnW1JlYW5pbWF0ZWRdIFRyeWluZyB0byBjb252ZXJ0IGEgY3ljbGljIG9iamVjdCB0byBhIHNoYXJlYWJsZS4gVGhpcyBpcyBub3Qgc3VwcG9ydGVkLidcbiAgICAgICk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHByb2Nlc3NlZE9iamVjdEF0VGhyZXNob2xkRGVwdGggPSB1bmRlZmluZWQ7XG4gIH1cbiAgLy8gVGhpcyBvbmUgYWN0dWFsbHkgbWF5IGJlIHdvcnRoIHRvIGJlIG1vdmVkIHRvIGMrKywgd2UgYWxzbyBuZWVkIHNpbWlsYXIgbG9naWMgdG8gcnVuIG9uIHRoZSBVSSB0aHJlYWRcbiAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgY29uc3QgaXNUeXBlT2JqZWN0ID0gdHlwZSA9PT0gJ29iamVjdCc7XG4gIGNvbnN0IGlzVHlwZUZ1bmN0aW9uID0gdHlwZSA9PT0gJ2Z1bmN0aW9uJztcbiAgaWYgKChpc1R5cGVPYmplY3QgfHwgaXNUeXBlRnVuY3Rpb24pICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgY29uc3QgY2FjaGVkID0gc2hhcmVhYmxlTWFwcGluZ0NhY2hlLmdldCh2YWx1ZSk7XG4gICAgaWYgKGNhY2hlZCA9PT0gc2hhcmVhYmxlTWFwcGluZ0ZsYWcpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9IGVsc2UgaWYgKGNhY2hlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkIGFzIFNoYXJlYWJsZVJlZjxUPjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHRvQWRhcHQ6IGFueTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB0b0FkYXB0ID0gdmFsdWUubWFwKChlbGVtZW50KSA9PlxuICAgICAgICAgIG1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZShlbGVtZW50LCBzaG91bGRQZXJzaXN0UmVtb3RlLCBkZXB0aCArIDEpXG4gICAgICAgICk7XG4gICAgICAgIGZyZWV6ZU9iamVjdElmRGV2KHZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNUeXBlRnVuY3Rpb24gJiYgIWlzV29ya2xldEZ1bmN0aW9uKHZhbHVlKSkge1xuICAgICAgICAvLyB0aGlzIGlzIGEgcmVtb3RlIGZ1bmN0aW9uXG4gICAgICAgIHRvQWRhcHQgPSB2YWx1ZTtcbiAgICAgICAgZnJlZXplT2JqZWN0SWZEZXYodmFsdWUpO1xuICAgICAgfSBlbHNlIGlmIChpc0hvc3RPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIC8vIGZvciBob3N0IG9iamVjdHMgd2UgcGFzcyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBvYmplY3QgYXMgc2hhcmVhYmxlIGFuZFxuICAgICAgICAvLyB0aGVuIHJlY3JlYXRlIG5ldyBob3N0IG9iamVjdCB3cmFwcGluZyB0aGUgc2FtZSBpbnN0YW5jZSBvbiB0aGUgVUkgdGhyZWFkLlxuICAgICAgICAvLyB0aGVyZSBpcyBubyBwb2ludCBvZiBpdGVyYXRpbmcgb3ZlciBrZXlzIGFzIHdlIGRvIGZvciByZWd1bGFyIG9iamVjdHMuXG4gICAgICAgIHRvQWRhcHQgPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGlzUGxhaW5KU09iamVjdCh2YWx1ZSkgJiZcbiAgICAgICAgdmFsdWUuX193b3JrbGV0Q29udGV4dE9iamVjdEZhY3RvcnlcbiAgICAgICkge1xuICAgICAgICBjb25zdCB3b3JrbGV0Q29udGV4dE9iamVjdEZhY3RvcnkgPSB2YWx1ZS5fX3dvcmtsZXRDb250ZXh0T2JqZWN0RmFjdG9yeTtcbiAgICAgICAgY29uc3QgaGFuZGxlID0gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlKHtcbiAgICAgICAgICBfX2luaXQ6ICgpID0+IHtcbiAgICAgICAgICAgICd3b3JrbGV0JztcbiAgICAgICAgICAgIHJldHVybiB3b3JrbGV0Q29udGV4dE9iamVjdEZhY3RvcnkoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2hhcmVhYmxlTWFwcGluZ0NhY2hlLnNldCh2YWx1ZSwgaGFuZGxlKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZSBhcyBTaGFyZWFibGVSZWY8VD47XG4gICAgICB9IGVsc2UgaWYgKGlzUGxhaW5KU09iamVjdCh2YWx1ZSkgfHwgaXNUeXBlRnVuY3Rpb24pIHtcbiAgICAgICAgdG9BZGFwdCA9IHt9O1xuICAgICAgICBpZiAoaXNXb3JrbGV0RnVuY3Rpb24odmFsdWUpKSB7XG4gICAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICAgIGNvbnN0IGJhYmVsVmVyc2lvbiA9IHZhbHVlLl9faW5pdERhdGEudmVyc2lvbjtcbiAgICAgICAgICAgIGlmIChiYWJlbFZlcnNpb24gIT09IHVuZGVmaW5lZCAmJiBiYWJlbFZlcnNpb24gIT09IGpzVmVyc2lvbikge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFtSZWFuaW1hdGVkXSBNaXNtYXRjaCBiZXR3ZWVuIEphdmFTY3JpcHQgY29kZSB2ZXJzaW9uIGFuZCBSZWFuaW1hdGVkIEJhYmVsIHBsdWdpbiB2ZXJzaW9uICgke2pzVmVyc2lvbn0gdnMuICR7YmFiZWxWZXJzaW9ufSkuICAgICAgICBcblNlZSBcXGBodHRwczovL2RvY3Muc3dtYW5zaW9uLmNvbS9yZWFjdC1uYXRpdmUtcmVhbmltYXRlZC9kb2NzL2d1aWRlcy90cm91Ymxlc2hvb3RpbmcjbWlzbWF0Y2gtYmV0d2Vlbi1qYXZhc2NyaXB0LWNvZGUtdmVyc2lvbi1hbmQtcmVhbmltYXRlZC1iYWJlbC1wbHVnaW4tdmVyc2lvblxcYCBmb3IgbW9yZSBkZXRhaWxzLlxuT2ZmZW5kaW5nIGNvZGUgd2FzOiBcXGAke2dldFdvcmtsZXRDb2RlKHZhbHVlKX1cXGBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ2lzdGVyV29ya2xldFN0YWNrRGV0YWlscyhcbiAgICAgICAgICAgICAgdmFsdWUuX193b3JrbGV0SGFzaCxcbiAgICAgICAgICAgICAgdmFsdWUuX19zdGFja0RldGFpbHMhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodmFsdWUuX19zdGFja0RldGFpbHMpIHtcbiAgICAgICAgICAgIC8vIGBFcnJvcmAgdHlwZSBvZiB2YWx1ZSBjYW5ub3QgYmUgY29waWVkIHRvIHRoZSBVSSB0aHJlYWQsIHNvIHdlXG4gICAgICAgICAgICAvLyByZW1vdmUgaXQgYWZ0ZXIgd2UgaGFuZGxlZCBpdCBpbiBkZXYgbW9kZSBvciBkZWxldGUgaXQgdG8gaWdub3JlIGl0IGluIHByb2R1Y3Rpb24gbW9kZS5cbiAgICAgICAgICAgIC8vIE5vdCByZW1vdmluZyB0aGlzIHdvdWxkIGNhdXNlIGFuIGluZmluaXRlIGxvb3AgaW4gcHJvZHVjdGlvbiBtb2RlIGFuZCBpdCBqdXN0XG4gICAgICAgICAgICAvLyBzZWVtcyBtb3JlIGVsZWdhbnQgdG8gaGFuZGxlIGl0IHRoaXMgd2F5LlxuICAgICAgICAgICAgZGVsZXRlIHZhbHVlLl9fc3RhY2tEZXRhaWxzO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyB0byBzYXZlIG9uIHRyYW5zZmVycmluZyBzdGF0aWMgX19pbml0RGF0YSBmaWVsZCBvZiB3b3JrbGV0IHN0cnVjdHVyZVxuICAgICAgICAgIC8vIHdlIHJlcXVlc3Qgc2hhcmVhYmxlIHZhbHVlIHRvIHBlcnNpc3QgaXRzIFVJIGNvdW50ZXJwYXJ0LiBUaGlzIG1lYW5zXG4gICAgICAgICAgLy8gdGhhdCB0aGUgX19pbml0RGF0YSBmaWVsZCB0aGF0IGNvbnRhaW5zIGxvbmcgc3RyaW5ncyByZXByZXNlbnRpbmcgdGhlXG4gICAgICAgICAgLy8gd29ya2xldCBjb2RlLCBzb3VyY2UgbWFwLCBhbmQgbG9jYXRpb24sIHdpbGwgYWx3YXlzIGJlXG4gICAgICAgICAgLy8gc2VyaWFsaXplZC9kZXNlcmlhbGl6ZWQgb25jZS5cbiAgICAgICAgICB0b0FkYXB0Ll9faW5pdERhdGEgPSBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUoXG4gICAgICAgICAgICB2YWx1ZS5fX2luaXREYXRhLFxuICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgIGRlcHRoICsgMVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVsZW1lbnRdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkge1xuICAgICAgICAgIGlmIChrZXkgPT09ICdfX2luaXREYXRhJyAmJiB0b0FkYXB0Ll9faW5pdERhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRvQWRhcHRba2V5XSA9IG1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZShcbiAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICBzaG91bGRQZXJzaXN0UmVtb3RlLFxuICAgICAgICAgICAgZGVwdGggKyAxXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBmcmVlemVPYmplY3RJZkRldih2YWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICAgIGNvbnN0IHBhdHRlcm4gPSB2YWx1ZS5zb3VyY2U7XG4gICAgICAgIGNvbnN0IGZsYWdzID0gdmFsdWUuZmxhZ3M7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9IG1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZSh7XG4gICAgICAgICAgX19pbml0OiAoKSA9PiB7XG4gICAgICAgICAgICAnd29ya2xldCc7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChwYXR0ZXJuLCBmbGFncyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHNoYXJlYWJsZU1hcHBpbmdDYWNoZS5zZXQodmFsdWUsIGhhbmRsZSk7XG4gICAgICAgIHJldHVybiBoYW5kbGUgYXMgU2hhcmVhYmxlUmVmPFQ+O1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgbWVzc2FnZSwgc3RhY2sgfSA9IHZhbHVlO1xuICAgICAgICBjb25zdCBoYW5kbGUgPSBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUoe1xuICAgICAgICAgIF9faW5pdDogKCkgPT4ge1xuICAgICAgICAgICAgJ3dvcmtsZXQnO1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgICAgIGVycm9yLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgZXJyb3IubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgICAgICAgICBlcnJvci5zdGFjayA9IHN0YWNrO1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBzaGFyZWFibGVNYXBwaW5nQ2FjaGUuc2V0KHZhbHVlLCBoYW5kbGUpO1xuICAgICAgICByZXR1cm4gaGFuZGxlIGFzIFNoYXJlYWJsZVJlZjxUPjtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xuICAgICAgICB0b0FkYXB0ID0gdmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHtcbiAgICAgICAgLy8gdHlwZWQgYXJyYXkgKGUuZy4gSW50MzJBcnJheSwgVWludDhDbGFtcGVkQXJyYXkpIG9yIERhdGFWaWV3XG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IHZhbHVlLmJ1ZmZlcjtcbiAgICAgICAgY29uc3QgdHlwZU5hbWUgPSB2YWx1ZS5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICBjb25zdCBoYW5kbGUgPSBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUoe1xuICAgICAgICAgIF9faW5pdDogKCkgPT4ge1xuICAgICAgICAgICAgJ3dvcmtsZXQnO1xuICAgICAgICAgICAgaWYgKCFWQUxJRF9BUlJBWV9WSUVXU19OQU1FUy5pbmNsdWRlcyh0eXBlTmFtZSkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgIGBbUmVhbmltYXRlZF0gSW52YWxpZCBhcnJheSB2aWV3IG5hbWUgXFxgJHt0eXBlTmFtZX1cXGAuYFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY29uc3RydWN0b3IgPSBnbG9iYWxbdHlwZU5hbWUgYXMga2V5b2YgdHlwZW9mIGdsb2JhbF07XG4gICAgICAgICAgICBpZiAoY29uc3RydWN0b3IgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgYFtSZWFuaW1hdGVkXSBDb25zdHJ1Y3RvciBmb3IgXFxgJHt0eXBlTmFtZX1cXGAgbm90IGZvdW5kLmBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgY29uc3RydWN0b3IoYnVmZmVyKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgc2hhcmVhYmxlTWFwcGluZ0NhY2hlLnNldCh2YWx1ZSwgaGFuZGxlKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZSBhcyBTaGFyZWFibGVSZWY8VD47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUaGlzIGlzIHJlYWNoZWQgZm9yIG9iamVjdCB0eXBlcyB0aGF0IGFyZSBub3Qgb2YgcGxhaW4gT2JqZWN0LnByb3RvdHlwZS5cbiAgICAgICAgLy8gV2UgZG9uJ3Qgc3VwcG9ydCBzdWNoIG9iamVjdHMgZnJvbSBiZWluZyB0cmFuc2ZlcnJlZCBhcyBzaGFyZWFibGVzIHRvXG4gICAgICAgIC8vIHRoZSBVSSBydW50aW1lIGFuZCBoZW5jZSB3ZSByZXBsYWNlIHRoZW0gd2l0aCBcImluYWNjZXNzaWJsZSBvYmplY3RcIlxuICAgICAgICAvLyB3aGljaCBpcyBpbXBsZW1lbnRlZCBhcyBhIFByb3h5IG9iamVjdCB0aGF0IHRocm93cyBvbiBhbnkgYXR0ZW1wdFxuICAgICAgICAvLyBvZiBhY2Nlc3NpbmcgaXRzIGZpZWxkcy4gV2UgYXJndWUgdGhhdCBzdWNoIG9iamVjdHMgY2FuIHNvbWV0aW1lcyBsZWFrXG4gICAgICAgIC8vIGFzIGF0dHJpYnV0ZXMgb2Ygb2JqZWN0cyBiZWluZyBjYXB0dXJlZCBieSB3b3JrbGV0cyBidXQgc2hvdWxkIG5ldmVyXG4gICAgICAgIC8vIGJlIHVzZWQgb24gdGhlIFVJIHJ1bnRpbWUgcmVnYXJkbGVzcy4gSWYgdGhleSBhcmUgYmVpbmcgYWNjZXNzZWQsIHRoZSB1c2VyXG4gICAgICAgIC8vIHdpbGwgZ2V0IGFuIGFwcHJvcHJpYXRlIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgIGNvbnN0IGluYWNjZXNzaWJsZU9iamVjdCA9XG4gICAgICAgICAgbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlPFQ+KElOQUNDRVNTSUJMRV9PQkpFQ1QpO1xuICAgICAgICBzaGFyZWFibGVNYXBwaW5nQ2FjaGUuc2V0KHZhbHVlLCBpbmFjY2Vzc2libGVPYmplY3QpO1xuICAgICAgICByZXR1cm4gaW5hY2Nlc3NpYmxlT2JqZWN0O1xuICAgICAgfVxuICAgICAgY29uc3QgYWRhcHRlZCA9IE5hdGl2ZVJlYW5pbWF0ZWRNb2R1bGUubWFrZVNoYXJlYWJsZUNsb25lKFxuICAgICAgICB0b0FkYXB0LFxuICAgICAgICBzaG91bGRQZXJzaXN0UmVtb3RlLFxuICAgICAgICB2YWx1ZVxuICAgICAgKTtcbiAgICAgIHNoYXJlYWJsZU1hcHBpbmdDYWNoZS5zZXQodmFsdWUsIGFkYXB0ZWQpO1xuICAgICAgc2hhcmVhYmxlTWFwcGluZ0NhY2hlLnNldChhZGFwdGVkKTtcbiAgICAgIHJldHVybiBhZGFwdGVkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gTmF0aXZlUmVhbmltYXRlZE1vZHVsZS5tYWtlU2hhcmVhYmxlQ2xvbmUoXG4gICAgdmFsdWUsXG4gICAgc2hvdWxkUGVyc2lzdFJlbW90ZSxcbiAgICB1bmRlZmluZWRcbiAgKTtcbn1cblxuY29uc3QgV09SS0xFVF9DT0RFX1RIUkVTSE9MRCA9IDI1NTtcblxuZnVuY3Rpb24gZ2V0V29ya2xldENvZGUodmFsdWU6IFdvcmtsZXRGdW5jdGlvbikge1xuICAvLyBAdHMtaWdub3JlIHRoaXMgaXMgZmluZVxuICBjb25zdCBjb2RlID0gdmFsdWU/Ll9faW5pdERhdGE/LmNvZGU7XG4gIGlmICghY29kZSkge1xuICAgIHJldHVybiAndW5rbm93bic7XG4gIH1cbiAgaWYgKGNvZGUubGVuZ3RoID4gV09SS0xFVF9DT0RFX1RIUkVTSE9MRCkge1xuICAgIHJldHVybiBgJHtjb2RlLnN1YnN0cmluZygwLCBXT1JLTEVUX0NPREVfVEhSRVNIT0xEKX0uLi5gO1xuICB9XG4gIHJldHVybiBjb2RlO1xufVxuXG50eXBlIFJlbW90ZUZ1bmN0aW9uPFQ+ID0ge1xuICBfX3JlbW90ZUZ1bmN0aW9uOiBGbGF0U2hhcmVhYmxlUmVmPFQ+O1xufTtcblxuZnVuY3Rpb24gaXNSZW1vdGVGdW5jdGlvbjxUPih2YWx1ZToge1xuICBfX3JlbW90ZUZ1bmN0aW9uPzogdW5rbm93bjtcbn0pOiB2YWx1ZSBpcyBSZW1vdGVGdW5jdGlvbjxUPiB7XG4gICd3b3JrbGV0JztcbiAgcmV0dXJuICEhdmFsdWUuX19yZW1vdGVGdW5jdGlvbjtcbn1cblxuLyoqXG4gKiBXZSBmcmVlemVcbiAqIC0gYXJyYXlzLFxuICogLSByZW1vdGUgZnVuY3Rpb25zLFxuICogLSBwbGFpbiBKUyBvYmplY3RzLFxuICpcbiAqIHRoYXQgYXJlIHRyYW5zZm9ybWVkIHRvIGEgc2hhcmVhYmxlIHdpdGggYSBtZWFuaW5nZnVsIHdhcm5pbmcuXG4gKiBUaGlzIHNob3VsZCBoZWxwIGRldGVjdCBpc3N1ZXMgd2hlbiBzb21lb25lIG1vZGlmaWVzIGRhdGEgYWZ0ZXIgaXQncyBiZWVuIGNvbnZlcnRlZC5cbiAqIE1lYW5pbmcgdGhhdCB0aGV5IG1heSBiZSBkb2luZyBhIGZhdWx0eSBhc3N1bXB0aW9uIGluIHRoZWlyXG4gKiBjb2RlIGV4cGVjdGluZyB0aGF0IHRoZSB1cGRhdGVzIGFyZSBnb2luZyB0byBhdXRvbWF0aWNhbGx5IHByb3BhZ2F0ZSB0b1xuICogdGhlIG9iamVjdCBzZW50IHRvIHRoZSBVSSB0aHJlYWQuIElmIHRoZSB1c2VyIHJlYWxseSB3YW50cyBzb21lIG9iamVjdHNcbiAqIHRvIGJlIG11dGFibGUgdGhleSBzaG91bGQgdXNlIHNoYXJlZCB2YWx1ZXMgaW5zdGVhZC5cbiAqL1xuZnVuY3Rpb24gZnJlZXplT2JqZWN0SWZEZXY8VCBleHRlbmRzIG9iamVjdD4odmFsdWU6IFQpIHtcbiAgaWYgKCFfX0RFVl9fKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIE9iamVjdC5lbnRyaWVzKHZhbHVlKS5mb3JFYWNoKChba2V5LCBlbGVtZW50XSkgPT4ge1xuICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHZhbHVlLCBrZXkpITtcbiAgICBpZiAoIWRlc2NyaXB0b3IuY29uZmlndXJhYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2YWx1ZSwga2V5LCB7XG4gICAgICBnZXQoKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgfSxcbiAgICAgIHNldCgpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIGBbUmVhbmltYXRlZF0gVHJpZWQgdG8gbW9kaWZ5IGtleSBcXGAke2tleX1cXGAgb2YgYW4gb2JqZWN0IHdoaWNoIGhhcyBiZWVuIGFscmVhZHkgcGFzc2VkIHRvIGEgd29ya2xldC4gU2VlIFxuaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9ndWlkZXMvdHJvdWJsZXNob290aW5nI3RyaWVkLXRvLW1vZGlmeS1rZXktb2YtYW4tb2JqZWN0LXdoaWNoLWhhcy1iZWVuLWNvbnZlcnRlZC10by1hLXNoYXJlYWJsZSBcbmZvciBtb3JlIGRldGFpbHMuYFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG4gIE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucyh2YWx1ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlU2hhcmVhYmxlQ2xvbmVPblVJUmVjdXJzaXZlPFQ+KFxuICB2YWx1ZTogVFxuKTogRmxhdFNoYXJlYWJsZVJlZjxUPiB7XG4gICd3b3JrbGV0JztcbiAgaWYgKFNIT1VMRF9CRV9VU0VfV0VCKSB7XG4gICAgLy8gQHRzLWlnbm9yZSB3ZWIgaXMgYW4gaW50ZXJlc3RpbmcgcGxhY2Ugd2hlcmUgd2UgZG9uJ3QgcnVuIGEgc2Vjb25kYXJ5IFZNIG9uIHRoZSBVSSB0aHJlYWRcbiAgICAvLyBzZWUgbW9yZSBkZXRhaWxzIGluIHRoZSBjb21tZW50IHdoZXJlIFVTRV9TVFVCX0lNUExFTUVOVEFUSU9OIGlzIGRlZmluZWQuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tc2hhZG93XG4gIGZ1bmN0aW9uIGNsb25lUmVjdXJzaXZlKHZhbHVlOiBUKTogRmxhdFNoYXJlYWJsZVJlZjxUPiB7XG4gICAgaWYgKFxuICAgICAgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHx8XG4gICAgICB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbidcbiAgICApIHtcbiAgICAgIGlmIChpc0hvc3RPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIC8vIFdlIGNhbGwgYF9tYWtlU2hhcmVhYmxlQ2xvbmVgIHRvIHdyYXAgdGhlIHByb3ZpZGVkIEhvc3RPYmplY3RcbiAgICAgICAgLy8gaW5zaWRlIFNoYXJlYWJsZUpTUmVmLlxuICAgICAgICByZXR1cm4gZ2xvYmFsLl9tYWtlU2hhcmVhYmxlQ2xvbmUoXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgICkgYXMgRmxhdFNoYXJlYWJsZVJlZjxUPjtcbiAgICAgIH1cbiAgICAgIGlmIChpc1JlbW90ZUZ1bmN0aW9uPFQ+KHZhbHVlKSkge1xuICAgICAgICAvLyBSZW1vdGVGdW5jdGlvbnMgYXJlIGNyZWF0ZWQgYnkgdXMgdGhlcmVmb3JlIHRoZXkgYXJlXG4gICAgICAgIC8vIGEgU2hhcmVhYmxlIG91dCBvZiB0aGUgYm94IGFuZCB0aGVyZSBpcyBubyBuZWVkIHRvXG4gICAgICAgIC8vIGNhbGwgYF9tYWtlU2hhcmVhYmxlQ2xvbmVgLlxuICAgICAgICByZXR1cm4gdmFsdWUuX19yZW1vdGVGdW5jdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gZ2xvYmFsLl9tYWtlU2hhcmVhYmxlQ2xvbmUoXG4gICAgICAgICAgdmFsdWUubWFwKGNsb25lUmVjdXJzaXZlKSxcbiAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgKSBhcyBGbGF0U2hhcmVhYmxlUmVmPFQ+O1xuICAgICAgfVxuICAgICAgY29uc3QgdG9BZGFwdDogUmVjb3JkPHN0cmluZywgRmxhdFNoYXJlYWJsZVJlZjxUPj4gPSB7fTtcbiAgICAgIGZvciAoY29uc3QgW2tleSwgZWxlbWVudF0gb2YgT2JqZWN0LmVudHJpZXModmFsdWUpKSB7XG4gICAgICAgIHRvQWRhcHRba2V5XSA9IGNsb25lUmVjdXJzaXZlKGVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdsb2JhbC5fbWFrZVNoYXJlYWJsZUNsb25lKHRvQWRhcHQsIHZhbHVlKSBhcyBGbGF0U2hhcmVhYmxlUmVmPFQ+O1xuICAgIH1cbiAgICByZXR1cm4gZ2xvYmFsLl9tYWtlU2hhcmVhYmxlQ2xvbmUodmFsdWUsIHVuZGVmaW5lZCk7XG4gIH1cbiAgcmV0dXJuIGNsb25lUmVjdXJzaXZlKHZhbHVlKTtcbn1cblxuZnVuY3Rpb24gbWFrZVNoYXJlYWJsZUpTPFQgZXh0ZW5kcyBvYmplY3Q+KHZhbHVlOiBUKTogVCB7XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gbWFrZVNoYXJlYWJsZU5hdGl2ZTxUIGV4dGVuZHMgb2JqZWN0Pih2YWx1ZTogVCk6IFQge1xuICBpZiAoc2hhcmVhYmxlTWFwcGluZ0NhY2hlLmdldCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgY29uc3QgaGFuZGxlID0gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlKHtcbiAgICBfX2luaXQ6ICgpID0+IHtcbiAgICAgICd3b3JrbGV0JztcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuICB9KTtcbiAgc2hhcmVhYmxlTWFwcGluZ0NhY2hlLnNldCh2YWx1ZSwgaGFuZGxlKTtcbiAgcmV0dXJuIHZhbHVlO1xufVxuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIHZhbHVlIG9uIFVJIHdpdGggcGVyc2lzdGVudCBzdGF0ZSAtIGNoYW5nZXMgdG8gaXQgb24gdGhlIFVJXG4gKiB0aHJlYWQgd2lsbCBiZSBzZWVuIGJ5IGFsbCB3b3JrbGV0cy4gVXNlIGl0IHdoZW4geW91IHdhbnQgdG8gY3JlYXRlIGEgdmFsdWVcbiAqIHRoYXQgaXMgcmVhZCBhbmQgd3JpdHRlbiBvbmx5IG9uIHRoZSBVSSB0aHJlYWQuXG4gKi9cbmV4cG9ydCBjb25zdCBtYWtlU2hhcmVhYmxlID0gU0hPVUxEX0JFX1VTRV9XRUJcbiAgPyBtYWtlU2hhcmVhYmxlSlNcbiAgOiBtYWtlU2hhcmVhYmxlTmF0aXZlO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFE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