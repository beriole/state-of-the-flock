8d0b921ed17daac8546bada138390d68
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useDerivedValue = useDerivedValue;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _react = require("react");
var _animation = require("../animation");
var _core = require("../core");
var _PlatformChecker = require("../PlatformChecker");
function useDerivedValue(updater, dependencies) {
  var _updater$__closure;
  var initRef = (0, _react.useRef)(null);
  var inputs = Object.values((_updater$__closure = updater.__closure) != null ? _updater$__closure : {});
  if ((0, _PlatformChecker.shouldBeUseWeb)()) {
    var _dependencies;
    if (!inputs.length && (_dependencies = dependencies) != null && _dependencies.length) {
      inputs = dependencies;
    }
  }
  if (dependencies === undefined) {
    dependencies = [].concat((0, _toConsumableArray2.default)(inputs), [updater.__workletHash]);
  } else {
    dependencies.push(updater.__workletHash);
  }
  if (initRef.current === null) {
    initRef.current = (0, _core.makeMutable)((0, _animation.initialUpdaterRun)(updater));
  }
  var sharedValue = initRef.current;
  (0, _react.useEffect)(function () {
    var fun = function fun() {
      'worklet';

      sharedValue.value = updater();
    };
    var mapperId = (0, _core.startMapper)(fun, inputs, [sharedValue]);
    return function () {
      (0, _core.stopMapper)(mapperId);
    };
  }, dependencies);
  (0, _react.useEffect)(function () {
    return function () {
      initRef.current = null;
    };
  }, []);
  return sharedValue;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwidXNlRGVyaXZlZFZhbHVlIiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsIl9yZWFjdCIsIl9hbmltYXRpb24iLCJfY29yZSIsIl9QbGF0Zm9ybUNoZWNrZXIiLCJ1cGRhdGVyIiwiZGVwZW5kZW5jaWVzIiwiX3VwZGF0ZXIkX19jbG9zdXJlIiwiaW5pdFJlZiIsInVzZVJlZiIsImlucHV0cyIsInZhbHVlcyIsIl9fY2xvc3VyZSIsInNob3VsZEJlVXNlV2ViIiwiX2RlcGVuZGVuY2llcyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbmNhdCIsImRlZmF1bHQiLCJfX3dvcmtsZXRIYXNoIiwicHVzaCIsImN1cnJlbnQiLCJtYWtlTXV0YWJsZSIsImluaXRpYWxVcGRhdGVyUnVuIiwic2hhcmVkVmFsdWUiLCJ1c2VFZmZlY3QiLCJmdW4iLCJtYXBwZXJJZCIsInN0YXJ0TWFwcGVyIiwic3RvcE1hcHBlciJdLCJzb3VyY2VzIjpbInVzZURlcml2ZWRWYWx1ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGluaXRpYWxVcGRhdGVyUnVuIH0gZnJvbSAnLi4vYW5pbWF0aW9uJztcbmltcG9ydCB0eXBlIHsgU2hhcmVkVmFsdWUsIFdvcmtsZXRGdW5jdGlvbiB9IGZyb20gJy4uL2NvbW1vblR5cGVzJztcbmltcG9ydCB7IG1ha2VNdXRhYmxlLCBzdGFydE1hcHBlciwgc3RvcE1hcHBlciB9IGZyb20gJy4uL2NvcmUnO1xuaW1wb3J0IHR5cGUgeyBEZXBlbmRlbmN5TGlzdCB9IGZyb20gJy4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgc2hvdWxkQmVVc2VXZWIgfSBmcm9tICcuLi9QbGF0Zm9ybUNoZWNrZXInO1xuXG5leHBvcnQgdHlwZSBEZXJpdmVkVmFsdWU8VmFsdWU+ID0gUmVhZG9ubHk8U2hhcmVkVmFsdWU8VmFsdWU+PjtcblxuLyoqXG4gKiBMZXRzIHlvdSBjcmVhdGUgbmV3IHNoYXJlZCB2YWx1ZXMgYmFzZWQgb24gZXhpc3Rpbmcgb25lcyB3aGlsZSBrZWVwaW5nIHRoZW0gcmVhY3RpdmUuXG4gKlxuICogQHBhcmFtIHVwZGF0ZXIgLSBBIGZ1bmN0aW9uIGNhbGxlZCB3aGVuZXZlciBhdCBsZWFzdCBvbmUgb2YgdGhlIHNoYXJlZCB2YWx1ZXMgb3Igc3RhdGUgdXNlZCBpbiB0aGUgZnVuY3Rpb24gYm9keSBjaGFuZ2VzLlxuICogQHBhcmFtIGRlcGVuZGVuY2llcyAtIEFuIG9wdGlvbmFsIGFycmF5IG9mIGRlcGVuZGVuY2llcy4gT25seSByZWxldmFudCB3aGVuIHVzaW5nIFJlYW5pbWF0ZWQgd2l0aG91dCB0aGUgQmFiZWwgcGx1Z2luIG9uIHRoZSBXZWIuXG4gKiBAcmV0dXJucyBBIG5ldyByZWFkb25seSBzaGFyZWQgdmFsdWUgYmFzZWQgb24gYSB2YWx1ZSByZXR1cm5lZCBmcm9tIHRoZSB1cGRhdGVyIGZ1bmN0aW9uXG4gKiBAc2VlIGh0dHBzOi8vZG9jcy5zd21hbnNpb24uY29tL3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkL2RvY3MvY29yZS91c2VEZXJpdmVkVmFsdWVcbiAqL1xuLy8gQHRzLWV4cGVjdC1lcnJvciBUaGlzIG92ZXJsb2FkIGlzIHJlcXVpcmVkIGJ5IG91ciBBUEkuXG5leHBvcnQgZnVuY3Rpb24gdXNlRGVyaXZlZFZhbHVlPFZhbHVlPihcbiAgdXBkYXRlcjogKCkgPT4gVmFsdWUsXG4gIGRlcGVuZGVuY2llcz86IERlcGVuZGVuY3lMaXN0XG4pOiBEZXJpdmVkVmFsdWU8VmFsdWU+O1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlRGVyaXZlZFZhbHVlPFZhbHVlPihcbiAgdXBkYXRlcjogV29ya2xldEZ1bmN0aW9uPFtdLCBWYWx1ZT4sXG4gIGRlcGVuZGVuY2llcz86IERlcGVuZGVuY3lMaXN0XG4pOiBEZXJpdmVkVmFsdWU8VmFsdWU+IHtcbiAgY29uc3QgaW5pdFJlZiA9IHVzZVJlZjxTaGFyZWRWYWx1ZTxWYWx1ZT4gfCBudWxsPihudWxsKTtcbiAgbGV0IGlucHV0cyA9IE9iamVjdC52YWx1ZXModXBkYXRlci5fX2Nsb3N1cmUgPz8ge30pO1xuICBpZiAoc2hvdWxkQmVVc2VXZWIoKSkge1xuICAgIGlmICghaW5wdXRzLmxlbmd0aCAmJiBkZXBlbmRlbmNpZXM/Lmxlbmd0aCkge1xuICAgICAgLy8gbGV0IHdlYiB3b3JrIHdpdGhvdXQgYSBCYWJlbC9TV0MgcGx1Z2luXG4gICAgICBpbnB1dHMgPSBkZXBlbmRlbmNpZXM7XG4gICAgfVxuICB9XG5cbiAgLy8gYnVpbGQgZGVwZW5kZW5jaWVzXG4gIGlmIChkZXBlbmRlbmNpZXMgPT09IHVuZGVmaW5lZCkge1xuICAgIGRlcGVuZGVuY2llcyA9IFsuLi5pbnB1dHMsIHVwZGF0ZXIuX193b3JrbGV0SGFzaF07XG4gIH0gZWxzZSB7XG4gICAgZGVwZW5kZW5jaWVzLnB1c2godXBkYXRlci5fX3dvcmtsZXRIYXNoKTtcbiAgfVxuXG4gIGlmIChpbml0UmVmLmN1cnJlbnQgPT09IG51bGwpIHtcbiAgICBpbml0UmVmLmN1cnJlbnQgPSBtYWtlTXV0YWJsZShpbml0aWFsVXBkYXRlclJ1bih1cGRhdGVyKSk7XG4gIH1cblxuICBjb25zdCBzaGFyZWRWYWx1ZTogU2hhcmVkVmFsdWU8VmFsdWU+ID0gaW5pdFJlZi5jdXJyZW50O1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgZnVuID0gKCkgPT4ge1xuICAgICAgJ3dvcmtsZXQnO1xuICAgICAgc2hhcmVkVmFsdWUudmFsdWUgPSB1cGRhdGVyKCk7XG4gICAgfTtcbiAgICBjb25zdCBtYXBwZXJJZCA9IHN0YXJ0TWFwcGVyKGZ1biwgaW5wdXRzLCBbc2hhcmVkVmFsdWVdKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgc3RvcE1hcHBlcihtYXBwZXJJZCk7XG4gICAgfTtcbiAgfSwgZGVwZW5kZW5jaWVzKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpbml0UmVmLmN1cnJlbnQgPSBudWxsO1xuICAgIH07XG4gIH0sIFtdKTtcblxuICByZXR1cm4gc2hhcmVkVmFsdWU7XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUMsSUFBQUEsc0JBQUEsR0FBQUMsT0FBQTtBQUFBQyxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxlQUFBLEdBQUFBLGVBQUE7QUFBQSxJQUFBQyxtQkFBQSxHQUFBUCxzQkFBQSxDQUFBQyxPQUFBO0FBQ2IsSUFBQU8sTUFBQSxHQUFBUCxPQUFBO0FBQ0EsSUFBQVEsVUFBQSxHQUFBUixPQUFBO0FBRUEsSUFBQVMsS0FBQSxHQUFBVCxPQUFBO0FBRUEsSUFBQVUsZ0JBQUEsR0FBQVYsT0FBQTtBQWtCTyxTQUFTSyxlQUFlQSxDQUM3Qk0sT0FBbUMsRUFDbkNDLFlBQTZCLEVBQ1I7RUFBQSxJQUFBQyxrQkFBQTtFQUNyQixJQUFNQyxPQUFPLEdBQUcsSUFBQUMsYUFBTSxFQUE0QixJQUFJLENBQUM7RUFDdkQsSUFBSUMsTUFBTSxHQUFHZixNQUFNLENBQUNnQixNQUFNLEVBQUFKLGtCQUFBLEdBQUNGLE9BQU8sQ0FBQ08sU0FBUyxZQUFBTCxrQkFBQSxHQUFJLENBQUMsQ0FBQyxDQUFDO0VBQ25ELElBQUksSUFBQU0sK0JBQWMsRUFBQyxDQUFDLEVBQUU7SUFBQSxJQUFBQyxhQUFBO0lBQ3BCLElBQUksQ0FBQ0osTUFBTSxDQUFDSyxNQUFNLEtBQUFELGFBQUEsR0FBSVIsWUFBWSxhQUFaUSxhQUFBLENBQWNDLE1BQU0sRUFBRTtNQUUxQ0wsTUFBTSxHQUFHSixZQUFZO0lBQ3ZCO0VBQ0Y7RUFHQSxJQUFJQSxZQUFZLEtBQUtVLFNBQVMsRUFBRTtJQUM5QlYsWUFBWSxNQUFBVyxNQUFBLEtBQUFqQixtQkFBQSxDQUFBa0IsT0FBQSxFQUFPUixNQUFNLElBQUVMLE9BQU8sQ0FBQ2MsYUFBYSxFQUFDO0VBQ25ELENBQUMsTUFBTTtJQUNMYixZQUFZLENBQUNjLElBQUksQ0FBQ2YsT0FBTyxDQUFDYyxhQUFhLENBQUM7RUFDMUM7RUFFQSxJQUFJWCxPQUFPLENBQUNhLE9BQU8sS0FBSyxJQUFJLEVBQUU7SUFDNUJiLE9BQU8sQ0FBQ2EsT0FBTyxHQUFHLElBQUFDLGlCQUFXLEVBQUMsSUFBQUMsNEJBQWlCLEVBQUNsQixPQUFPLENBQUMsQ0FBQztFQUMzRDtFQUVBLElBQU1tQixXQUErQixHQUFHaEIsT0FBTyxDQUFDYSxPQUFPO0VBRXZELElBQUFJLGdCQUFTLEVBQUMsWUFBTTtJQUNkLElBQU1DLEdBQUcsR0FBRyxTQUFOQSxHQUFHQSxDQUFBLEVBQVM7TUFDaEIsU0FBUzs7TUFDVEYsV0FBVyxDQUFDMUIsS0FBSyxHQUFHTyxPQUFPLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBQ0QsSUFBTXNCLFFBQVEsR0FBRyxJQUFBQyxpQkFBVyxFQUFDRixHQUFHLEVBQUVoQixNQUFNLEVBQUUsQ0FBQ2MsV0FBVyxDQUFDLENBQUM7SUFDeEQsT0FBTyxZQUFNO01BQ1gsSUFBQUssZ0JBQVUsRUFBQ0YsUUFBUSxDQUFDO0lBQ3RCLENBQUM7RUFDSCxDQUFDLEVBQUVyQixZQUFZLENBQUM7RUFFaEIsSUFBQW1CLGdCQUFTLEVBQUMsWUFBTTtJQUNkLE9BQU8sWUFBTTtNQUNYakIsT0FBTyxDQUFDYSxPQUFPLEdBQUcsSUFBSTtJQUN4QixDQUFDO0VBQ0gsQ0FBQyxFQUFFLEVBQUUsQ0FBQztFQUVOLE9BQU9HLFdBQVc7QUFDcEIiLCJpZ25vcmVMaXN0IjpbXX0=