273a82727c9b26bf6abf4f14fd657bbb
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withSpring = void 0;
var _util = require("./util");
var _springUtils = require("./springUtils");
var withSpring = exports.withSpring = function withSpring(toValue, userConfig, callback) {
  'worklet';

  return (0, _util.defineAnimation)(toValue, function () {
    'worklet';

    var defaultConfig = {
      damping: 10,
      mass: 1,
      stiffness: 100,
      overshootClamping: false,
      restDisplacementThreshold: 0.01,
      restSpeedThreshold: 2,
      velocity: 0,
      duration: 2000,
      dampingRatio: 0.5,
      reduceMotion: undefined,
      clamp: undefined
    };
    var config = Object.assign({}, defaultConfig, userConfig, {
      useDuration: !!(userConfig != null && userConfig.duration || userConfig != null && userConfig.dampingRatio),
      skipAnimation: false
    });
    config.skipAnimation = !(0, _springUtils.checkIfConfigIsValid)(config);
    if (config.duration === 0) {
      config.skipAnimation = true;
    }
    function springOnFrame(animation, now) {
      var toValue = animation.toValue,
        startTimestamp = animation.startTimestamp,
        current = animation.current;
      var timeFromStart = now - startTimestamp;
      if (config.useDuration && timeFromStart >= config.duration) {
        animation.current = toValue;
        animation.lastTimestamp = 0;
        return true;
      }
      if (config.skipAnimation) {
        animation.current = toValue;
        animation.lastTimestamp = 0;
        return true;
      }
      var lastTimestamp = animation.lastTimestamp,
        velocity = animation.velocity;
      var deltaTime = Math.min(now - lastTimestamp, 64);
      animation.lastTimestamp = now;
      var t = deltaTime / 1000;
      var v0 = -velocity;
      var x0 = toValue - current;
      var zeta = animation.zeta,
        omega0 = animation.omega0,
        omega1 = animation.omega1;
      var _ref = zeta < 1 ? (0, _springUtils.underDampedSpringCalculations)(animation, {
          zeta: zeta,
          v0: v0,
          x0: x0,
          omega0: omega0,
          omega1: omega1,
          t: t
        }) : (0, _springUtils.criticallyDampedSpringCalculations)(animation, {
          v0: v0,
          x0: x0,
          omega0: omega0,
          t: t
        }),
        newPosition = _ref.position,
        newVelocity = _ref.velocity;
      animation.current = newPosition;
      animation.velocity = newVelocity;
      var _isAnimationTerminati = (0, _springUtils.isAnimationTerminatingCalculation)(animation, config),
        isOvershooting = _isAnimationTerminati.isOvershooting,
        isVelocity = _isAnimationTerminati.isVelocity,
        isDisplacement = _isAnimationTerminati.isDisplacement;
      var springIsNotInMove = isOvershooting || isVelocity && isDisplacement;
      if (!config.useDuration && springIsNotInMove) {
        animation.velocity = 0;
        animation.current = toValue;
        animation.lastTimestamp = 0;
        return true;
      }
      return false;
    }
    function isTriggeredTwice(previousAnimation, animation) {
      return (previousAnimation == null ? void 0 : previousAnimation.lastTimestamp) && (previousAnimation == null ? void 0 : previousAnimation.startTimestamp) && (previousAnimation == null ? void 0 : previousAnimation.toValue) === animation.toValue && (previousAnimation == null ? void 0 : previousAnimation.duration) === animation.duration && (previousAnimation == null ? void 0 : previousAnimation.dampingRatio) === animation.dampingRatio;
    }
    function onStart(animation, value, now, previousAnimation) {
      animation.current = value;
      animation.startValue = value;
      var mass = config.mass;
      var triggeredTwice = isTriggeredTwice(previousAnimation, animation);
      var duration = config.duration;
      var x0 = triggeredTwice ? previousAnimation == null ? void 0 : previousAnimation.startValue : Number(animation.toValue) - value;
      if (previousAnimation) {
        animation.velocity = (triggeredTwice ? previousAnimation == null ? void 0 : previousAnimation.velocity : (previousAnimation == null ? void 0 : previousAnimation.velocity) + config.velocity) || 0;
      } else {
        animation.velocity = config.velocity || 0;
      }
      if (triggeredTwice) {
        animation.zeta = (previousAnimation == null ? void 0 : previousAnimation.zeta) || 0;
        animation.omega0 = (previousAnimation == null ? void 0 : previousAnimation.omega0) || 0;
        animation.omega1 = (previousAnimation == null ? void 0 : previousAnimation.omega1) || 0;
      } else {
        if (config.useDuration) {
          var actualDuration = triggeredTwice ? duration - (((previousAnimation == null ? void 0 : previousAnimation.lastTimestamp) || 0) - ((previousAnimation == null ? void 0 : previousAnimation.startTimestamp) || 0)) : duration;
          config.duration = actualDuration;
          mass = (0, _springUtils.calculateNewMassToMatchDuration)(x0, config, animation.velocity);
        }
        var _initialCalculations = (0, _springUtils.initialCalculations)(mass, config),
          zeta = _initialCalculations.zeta,
          omega0 = _initialCalculations.omega0,
          omega1 = _initialCalculations.omega1;
        animation.zeta = zeta;
        animation.omega0 = omega0;
        animation.omega1 = omega1;
        if (config.clamp !== undefined) {
          animation.zeta = (0, _springUtils.scaleZetaToMatchClamps)(animation, config.clamp);
        }
      }
      animation.lastTimestamp = (previousAnimation == null ? void 0 : previousAnimation.lastTimestamp) || now;
      animation.startTimestamp = triggeredTwice ? (previousAnimation == null ? void 0 : previousAnimation.startTimestamp) || now : now;
    }
    return {
      onFrame: springOnFrame,
      onStart: onStart,
      toValue: toValue,
      velocity: config.velocity || 0,
      current: toValue,
      startValue: 0,
      callback: callback,
      lastTimestamp: 0,
      startTimestamp: 0,
      zeta: 0,
      omega0: 0,
      omega1: 0,
      reduceMotion: (0, _util.getReduceMotionForAnimation)(config.reduceMotion)
    };
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIndpdGhTcHJpbmciLCJfdXRpbCIsInJlcXVpcmUiLCJfc3ByaW5nVXRpbHMiLCJ0b1ZhbHVlIiwidXNlckNvbmZpZyIsImNhbGxiYWNrIiwiZGVmaW5lQW5pbWF0aW9uIiwiZGVmYXVsdENvbmZpZyIsImRhbXBpbmciLCJtYXNzIiwic3RpZmZuZXNzIiwib3ZlcnNob290Q2xhbXBpbmciLCJyZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwicmVzdFNwZWVkVGhyZXNob2xkIiwidmVsb2NpdHkiLCJkdXJhdGlvbiIsImRhbXBpbmdSYXRpbyIsInJlZHVjZU1vdGlvbiIsInVuZGVmaW5lZCIsImNsYW1wIiwiY29uZmlnIiwiYXNzaWduIiwidXNlRHVyYXRpb24iLCJza2lwQW5pbWF0aW9uIiwiY2hlY2tJZkNvbmZpZ0lzVmFsaWQiLCJzcHJpbmdPbkZyYW1lIiwiYW5pbWF0aW9uIiwibm93Iiwic3RhcnRUaW1lc3RhbXAiLCJjdXJyZW50IiwidGltZUZyb21TdGFydCIsImxhc3RUaW1lc3RhbXAiLCJkZWx0YVRpbWUiLCJNYXRoIiwibWluIiwidCIsInYwIiwieDAiLCJ6ZXRhIiwib21lZ2EwIiwib21lZ2ExIiwiX3JlZiIsInVuZGVyRGFtcGVkU3ByaW5nQ2FsY3VsYXRpb25zIiwiY3JpdGljYWxseURhbXBlZFNwcmluZ0NhbGN1bGF0aW9ucyIsIm5ld1Bvc2l0aW9uIiwicG9zaXRpb24iLCJuZXdWZWxvY2l0eSIsIl9pc0FuaW1hdGlvblRlcm1pbmF0aSIsImlzQW5pbWF0aW9uVGVybWluYXRpbmdDYWxjdWxhdGlvbiIsImlzT3ZlcnNob290aW5nIiwiaXNWZWxvY2l0eSIsImlzRGlzcGxhY2VtZW50Iiwic3ByaW5nSXNOb3RJbk1vdmUiLCJpc1RyaWdnZXJlZFR3aWNlIiwicHJldmlvdXNBbmltYXRpb24iLCJvblN0YXJ0Iiwic3RhcnRWYWx1ZSIsInRyaWdnZXJlZFR3aWNlIiwiTnVtYmVyIiwiYWN0dWFsRHVyYXRpb24iLCJjYWxjdWxhdGVOZXdNYXNzVG9NYXRjaER1cmF0aW9uIiwiX2luaXRpYWxDYWxjdWxhdGlvbnMiLCJpbml0aWFsQ2FsY3VsYXRpb25zIiwic2NhbGVaZXRhVG9NYXRjaENsYW1wcyIsIm9uRnJhbWUiLCJnZXRSZWR1Y2VNb3Rpb25Gb3JBbmltYXRpb24iXSwic291cmNlcyI6WyJzcHJpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgZGVmaW5lQW5pbWF0aW9uLCBnZXRSZWR1Y2VNb3Rpb25Gb3JBbmltYXRpb24gfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHR5cGUge1xuICBBbmltYXRpb24sXG4gIEFuaW1hdGlvbkNhbGxiYWNrLFxuICBBbmltYXRhYmxlVmFsdWUsXG4gIFRpbWVzdGFtcCxcbn0gZnJvbSAnLi4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHR5cGUge1xuICBTcHJpbmdDb25maWcsXG4gIFNwcmluZ0FuaW1hdGlvbixcbiAgSW5uZXJTcHJpbmdBbmltYXRpb24sXG4gIFNwcmluZ0NvbmZpZ0lubmVyLFxuICBEZWZhdWx0U3ByaW5nQ29uZmlnLFxufSBmcm9tICcuL3NwcmluZ1V0aWxzJztcbmltcG9ydCB7XG4gIGluaXRpYWxDYWxjdWxhdGlvbnMsXG4gIGNhbGN1bGF0ZU5ld01hc3NUb01hdGNoRHVyYXRpb24sXG4gIHVuZGVyRGFtcGVkU3ByaW5nQ2FsY3VsYXRpb25zLFxuICBjcml0aWNhbGx5RGFtcGVkU3ByaW5nQ2FsY3VsYXRpb25zLFxuICBpc0FuaW1hdGlvblRlcm1pbmF0aW5nQ2FsY3VsYXRpb24sXG4gIHNjYWxlWmV0YVRvTWF0Y2hDbGFtcHMsXG4gIGNoZWNrSWZDb25maWdJc1ZhbGlkLFxufSBmcm9tICcuL3NwcmluZ1V0aWxzJztcblxuLy8gVE9ETyBUWVBFU0NSSVBUIFRoaXMgaXMgYSB0ZW1wb3JhcnkgdHlwZSB0byBnZXQgcmlkIG9mIC5kLnRzIGZpbGUuXG50eXBlIHdpdGhTcHJpbmdUeXBlID0gPFQgZXh0ZW5kcyBBbmltYXRhYmxlVmFsdWU+KFxuICB0b1ZhbHVlOiBULFxuICB1c2VyQ29uZmlnPzogU3ByaW5nQ29uZmlnLFxuICBjYWxsYmFjaz86IEFuaW1hdGlvbkNhbGxiYWNrXG4pID0+IFQ7XG5cbi8qKlxuICogTGV0cyB5b3UgY3JlYXRlIHNwcmluZy1iYXNlZCBhbmltYXRpb25zLlxuICpcbiAqIEBwYXJhbSB0b1ZhbHVlIC0gdGhlIHZhbHVlIGF0IHdoaWNoIHRoZSBhbmltYXRpb24gd2lsbCBjb21lIHRvIHJlc3QgLSB7QGxpbmsgQW5pbWF0YWJsZVZhbHVlfVxuICogQHBhcmFtIGNvbmZpZyAtIHRoZSBzcHJpbmcgYW5pbWF0aW9uIGNvbmZpZ3VyYXRpb24gLSB7QGxpbmsgU3ByaW5nQ29uZmlnfVxuICogQHBhcmFtIGNhbGxiYWNrIC0gYSBmdW5jdGlvbiBjYWxsZWQgb24gYW5pbWF0aW9uIGNvbXBsZXRlIC0ge0BsaW5rIEFuaW1hdGlvbkNhbGxiYWNrfVxuICogQHJldHVybnMgYW4gW2FuaW1hdGlvbiBvYmplY3RdKGh0dHBzOi8vZG9jcy5zd21hbnNpb24uY29tL3JlYWN0LW5hdGl2ZS1yZWFuaW1hdGVkL2RvY3MvZnVuZGFtZW50YWxzL2dsb3NzYXJ5I2FuaW1hdGlvbi1vYmplY3QpIHdoaWNoIGhvbGRzIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBhbmltYXRpb25cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLnN3bWFuc2lvbi5jb20vcmVhY3QtbmF0aXZlLXJlYW5pbWF0ZWQvZG9jcy9hbmltYXRpb25zL3dpdGhTcHJpbmdcbiAqL1xuZXhwb3J0IGNvbnN0IHdpdGhTcHJpbmcgPSAoKFxuICB0b1ZhbHVlOiBBbmltYXRhYmxlVmFsdWUsXG4gIHVzZXJDb25maWc/OiBTcHJpbmdDb25maWcsXG4gIGNhbGxiYWNrPzogQW5pbWF0aW9uQ2FsbGJhY2tcbik6IEFuaW1hdGlvbjxTcHJpbmdBbmltYXRpb24+ID0+IHtcbiAgJ3dvcmtsZXQnO1xuXG4gIHJldHVybiBkZWZpbmVBbmltYXRpb248U3ByaW5nQW5pbWF0aW9uPih0b1ZhbHVlLCAoKSA9PiB7XG4gICAgJ3dvcmtsZXQnO1xuICAgIGNvbnN0IGRlZmF1bHRDb25maWc6IERlZmF1bHRTcHJpbmdDb25maWcgPSB7XG4gICAgICBkYW1waW5nOiAxMCxcbiAgICAgIG1hc3M6IDEsXG4gICAgICBzdGlmZm5lc3M6IDEwMCxcbiAgICAgIG92ZXJzaG9vdENsYW1waW5nOiBmYWxzZSxcbiAgICAgIHJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ6IDAuMDEsXG4gICAgICByZXN0U3BlZWRUaHJlc2hvbGQ6IDIsXG4gICAgICB2ZWxvY2l0eTogMCxcbiAgICAgIGR1cmF0aW9uOiAyMDAwLFxuICAgICAgZGFtcGluZ1JhdGlvOiAwLjUsXG4gICAgICByZWR1Y2VNb3Rpb246IHVuZGVmaW5lZCxcbiAgICAgIGNsYW1wOiB1bmRlZmluZWQsXG4gICAgfSBhcyBjb25zdDtcblxuICAgIGNvbnN0IGNvbmZpZzogRGVmYXVsdFNwcmluZ0NvbmZpZyAmIFNwcmluZ0NvbmZpZ0lubmVyID0ge1xuICAgICAgLi4uZGVmYXVsdENvbmZpZyxcbiAgICAgIC4uLnVzZXJDb25maWcsXG4gICAgICB1c2VEdXJhdGlvbjogISEodXNlckNvbmZpZz8uZHVyYXRpb24gfHwgdXNlckNvbmZpZz8uZGFtcGluZ1JhdGlvKSxcbiAgICAgIHNraXBBbmltYXRpb246IGZhbHNlLFxuICAgIH07XG5cbiAgICBjb25maWcuc2tpcEFuaW1hdGlvbiA9ICFjaGVja0lmQ29uZmlnSXNWYWxpZChjb25maWcpO1xuXG4gICAgaWYgKGNvbmZpZy5kdXJhdGlvbiA9PT0gMCkge1xuICAgICAgY29uZmlnLnNraXBBbmltYXRpb24gPSB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNwcmluZ09uRnJhbWUoXG4gICAgICBhbmltYXRpb246IElubmVyU3ByaW5nQW5pbWF0aW9uLFxuICAgICAgbm93OiBUaW1lc3RhbXBcbiAgICApOiBib29sZWFuIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tc2hhZG93XG4gICAgICBjb25zdCB7IHRvVmFsdWUsIHN0YXJ0VGltZXN0YW1wLCBjdXJyZW50IH0gPSBhbmltYXRpb247XG5cbiAgICAgIGNvbnN0IHRpbWVGcm9tU3RhcnQgPSBub3cgLSBzdGFydFRpbWVzdGFtcDtcblxuICAgICAgaWYgKGNvbmZpZy51c2VEdXJhdGlvbiAmJiB0aW1lRnJvbVN0YXJ0ID49IGNvbmZpZy5kdXJhdGlvbikge1xuICAgICAgICBhbmltYXRpb24uY3VycmVudCA9IHRvVmFsdWU7XG4gICAgICAgIC8vIGNsZWFyIGxhc3RUaW1lc3RhbXAgdG8gYXZvaWQgdXNpbmcgc3RhbGUgdmFsdWUgYnkgdGhlIG5leHQgc3ByaW5nIGFuaW1hdGlvbiB0aGF0IHN0YXJ0cyBhZnRlciB0aGlzIG9uZVxuICAgICAgICBhbmltYXRpb24ubGFzdFRpbWVzdGFtcCA9IDA7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoY29uZmlnLnNraXBBbmltYXRpb24pIHtcbiAgICAgICAgYW5pbWF0aW9uLmN1cnJlbnQgPSB0b1ZhbHVlO1xuICAgICAgICBhbmltYXRpb24ubGFzdFRpbWVzdGFtcCA9IDA7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBsYXN0VGltZXN0YW1wLCB2ZWxvY2l0eSB9ID0gYW5pbWF0aW9uO1xuXG4gICAgICBjb25zdCBkZWx0YVRpbWUgPSBNYXRoLm1pbihub3cgLSBsYXN0VGltZXN0YW1wLCA2NCk7XG4gICAgICBhbmltYXRpb24ubGFzdFRpbWVzdGFtcCA9IG5vdztcblxuICAgICAgY29uc3QgdCA9IGRlbHRhVGltZSAvIDEwMDA7XG4gICAgICBjb25zdCB2MCA9IC12ZWxvY2l0eTtcbiAgICAgIGNvbnN0IHgwID0gdG9WYWx1ZSAtIGN1cnJlbnQ7XG5cbiAgICAgIGNvbnN0IHsgemV0YSwgb21lZ2EwLCBvbWVnYTEgfSA9IGFuaW1hdGlvbjtcblxuICAgICAgY29uc3QgeyBwb3NpdGlvbjogbmV3UG9zaXRpb24sIHZlbG9jaXR5OiBuZXdWZWxvY2l0eSB9ID1cbiAgICAgICAgemV0YSA8IDFcbiAgICAgICAgICA/IHVuZGVyRGFtcGVkU3ByaW5nQ2FsY3VsYXRpb25zKGFuaW1hdGlvbiwge1xuICAgICAgICAgICAgICB6ZXRhLFxuICAgICAgICAgICAgICB2MCxcbiAgICAgICAgICAgICAgeDAsXG4gICAgICAgICAgICAgIG9tZWdhMCxcbiAgICAgICAgICAgICAgb21lZ2ExLFxuICAgICAgICAgICAgICB0LFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICA6IGNyaXRpY2FsbHlEYW1wZWRTcHJpbmdDYWxjdWxhdGlvbnMoYW5pbWF0aW9uLCB7XG4gICAgICAgICAgICAgIHYwLFxuICAgICAgICAgICAgICB4MCxcbiAgICAgICAgICAgICAgb21lZ2EwLFxuICAgICAgICAgICAgICB0LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gbmV3UG9zaXRpb247XG4gICAgICBhbmltYXRpb24udmVsb2NpdHkgPSBuZXdWZWxvY2l0eTtcblxuICAgICAgY29uc3QgeyBpc092ZXJzaG9vdGluZywgaXNWZWxvY2l0eSwgaXNEaXNwbGFjZW1lbnQgfSA9XG4gICAgICAgIGlzQW5pbWF0aW9uVGVybWluYXRpbmdDYWxjdWxhdGlvbihhbmltYXRpb24sIGNvbmZpZyk7XG5cbiAgICAgIGNvbnN0IHNwcmluZ0lzTm90SW5Nb3ZlID1cbiAgICAgICAgaXNPdmVyc2hvb3RpbmcgfHwgKGlzVmVsb2NpdHkgJiYgaXNEaXNwbGFjZW1lbnQpO1xuXG4gICAgICBpZiAoIWNvbmZpZy51c2VEdXJhdGlvbiAmJiBzcHJpbmdJc05vdEluTW92ZSkge1xuICAgICAgICBhbmltYXRpb24udmVsb2NpdHkgPSAwO1xuICAgICAgICBhbmltYXRpb24uY3VycmVudCA9IHRvVmFsdWU7XG4gICAgICAgIC8vIGNsZWFyIGxhc3RUaW1lc3RhbXAgdG8gYXZvaWQgdXNpbmcgc3RhbGUgdmFsdWUgYnkgdGhlIG5leHQgc3ByaW5nIGFuaW1hdGlvbiB0aGF0IHN0YXJ0cyBhZnRlciB0aGlzIG9uZVxuICAgICAgICBhbmltYXRpb24ubGFzdFRpbWVzdGFtcCA9IDA7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNUcmlnZ2VyZWRUd2ljZShcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uOiBTcHJpbmdBbmltYXRpb24gfCB1bmRlZmluZWQsXG4gICAgICBhbmltYXRpb246IFNwcmluZ0FuaW1hdGlvblxuICAgICkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgcHJldmlvdXNBbmltYXRpb24/Lmxhc3RUaW1lc3RhbXAgJiZcbiAgICAgICAgcHJldmlvdXNBbmltYXRpb24/LnN0YXJ0VGltZXN0YW1wICYmXG4gICAgICAgIHByZXZpb3VzQW5pbWF0aW9uPy50b1ZhbHVlID09PSBhbmltYXRpb24udG9WYWx1ZSAmJlxuICAgICAgICBwcmV2aW91c0FuaW1hdGlvbj8uZHVyYXRpb24gPT09IGFuaW1hdGlvbi5kdXJhdGlvbiAmJlxuICAgICAgICBwcmV2aW91c0FuaW1hdGlvbj8uZGFtcGluZ1JhdGlvID09PSBhbmltYXRpb24uZGFtcGluZ1JhdGlvXG4gICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uU3RhcnQoXG4gICAgICBhbmltYXRpb246IFNwcmluZ0FuaW1hdGlvbixcbiAgICAgIHZhbHVlOiBudW1iZXIsXG4gICAgICBub3c6IFRpbWVzdGFtcCxcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uOiBTcHJpbmdBbmltYXRpb24gfCB1bmRlZmluZWRcbiAgICApOiB2b2lkIHtcbiAgICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gdmFsdWU7XG4gICAgICBhbmltYXRpb24uc3RhcnRWYWx1ZSA9IHZhbHVlO1xuXG4gICAgICBsZXQgbWFzcyA9IGNvbmZpZy5tYXNzO1xuICAgICAgY29uc3QgdHJpZ2dlcmVkVHdpY2UgPSBpc1RyaWdnZXJlZFR3aWNlKHByZXZpb3VzQW5pbWF0aW9uLCBhbmltYXRpb24pO1xuXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGNvbmZpZy5kdXJhdGlvbjtcblxuICAgICAgY29uc3QgeDAgPSB0cmlnZ2VyZWRUd2ljZVxuICAgICAgICA/IC8vIElmIGFuaW1hdGlvbiBpcyB0cmlnZ2VyZWQgdHdpY2Ugd2Ugd2FudCB0byBjb250aW51ZSB0aGUgcHJldmlvdXMgYW5pbWF0aW9uXG4gICAgICAgICAgLy8gZm9ybSB0aGUgcHJldmlvdXMgc3RhcnRpbmcgcG9pbnRcbiAgICAgICAgICBwcmV2aW91c0FuaW1hdGlvbj8uc3RhcnRWYWx1ZVxuICAgICAgICA6IE51bWJlcihhbmltYXRpb24udG9WYWx1ZSkgLSB2YWx1ZTtcblxuICAgICAgaWYgKHByZXZpb3VzQW5pbWF0aW9uKSB7XG4gICAgICAgIGFuaW1hdGlvbi52ZWxvY2l0eSA9XG4gICAgICAgICAgKHRyaWdnZXJlZFR3aWNlXG4gICAgICAgICAgICA/IHByZXZpb3VzQW5pbWF0aW9uPy52ZWxvY2l0eVxuICAgICAgICAgICAgOiBwcmV2aW91c0FuaW1hdGlvbj8udmVsb2NpdHkgKyBjb25maWcudmVsb2NpdHkpIHx8IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhbmltYXRpb24udmVsb2NpdHkgPSBjb25maWcudmVsb2NpdHkgfHwgMDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRyaWdnZXJlZFR3aWNlKSB7XG4gICAgICAgIGFuaW1hdGlvbi56ZXRhID0gcHJldmlvdXNBbmltYXRpb24/LnpldGEgfHwgMDtcbiAgICAgICAgYW5pbWF0aW9uLm9tZWdhMCA9IHByZXZpb3VzQW5pbWF0aW9uPy5vbWVnYTAgfHwgMDtcbiAgICAgICAgYW5pbWF0aW9uLm9tZWdhMSA9IHByZXZpb3VzQW5pbWF0aW9uPy5vbWVnYTEgfHwgMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChjb25maWcudXNlRHVyYXRpb24pIHtcbiAgICAgICAgICBjb25zdCBhY3R1YWxEdXJhdGlvbiA9IHRyaWdnZXJlZFR3aWNlXG4gICAgICAgICAgICA/IC8vIElmIGFuaW1hdGlvbiBpcyB0cmlnZ2VyZWQgdHdpY2Ugd2Ugd2FudCB0byBjb250aW51ZSB0aGUgcHJldmlvdXMgYW5pbWF0aW9uXG4gICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gaW5jbHVkZSB0aGUgdGltZSB0aGF0IGFscmVhZHkgZWxhcHNlZFxuICAgICAgICAgICAgICBkdXJhdGlvbiAtXG4gICAgICAgICAgICAgICgocHJldmlvdXNBbmltYXRpb24/Lmxhc3RUaW1lc3RhbXAgfHwgMCkgLVxuICAgICAgICAgICAgICAgIChwcmV2aW91c0FuaW1hdGlvbj8uc3RhcnRUaW1lc3RhbXAgfHwgMCkpXG4gICAgICAgICAgICA6IGR1cmF0aW9uO1xuXG4gICAgICAgICAgY29uZmlnLmR1cmF0aW9uID0gYWN0dWFsRHVyYXRpb247XG4gICAgICAgICAgbWFzcyA9IGNhbGN1bGF0ZU5ld01hc3NUb01hdGNoRHVyYXRpb24oXG4gICAgICAgICAgICB4MCBhcyBudW1iZXIsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbmltYXRpb24udmVsb2NpdHlcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB6ZXRhLCBvbWVnYTAsIG9tZWdhMSB9ID0gaW5pdGlhbENhbGN1bGF0aW9ucyhtYXNzLCBjb25maWcpO1xuICAgICAgICBhbmltYXRpb24uemV0YSA9IHpldGE7XG4gICAgICAgIGFuaW1hdGlvbi5vbWVnYTAgPSBvbWVnYTA7XG4gICAgICAgIGFuaW1hdGlvbi5vbWVnYTEgPSBvbWVnYTE7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5jbGFtcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgYW5pbWF0aW9uLnpldGEgPSBzY2FsZVpldGFUb01hdGNoQ2xhbXBzKGFuaW1hdGlvbiwgY29uZmlnLmNsYW1wKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBhbmltYXRpb24ubGFzdFRpbWVzdGFtcCA9IHByZXZpb3VzQW5pbWF0aW9uPy5sYXN0VGltZXN0YW1wIHx8IG5vdztcblxuICAgICAgYW5pbWF0aW9uLnN0YXJ0VGltZXN0YW1wID0gdHJpZ2dlcmVkVHdpY2VcbiAgICAgICAgPyBwcmV2aW91c0FuaW1hdGlvbj8uc3RhcnRUaW1lc3RhbXAgfHwgbm93XG4gICAgICAgIDogbm93O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBvbkZyYW1lOiBzcHJpbmdPbkZyYW1lLFxuICAgICAgb25TdGFydCxcbiAgICAgIHRvVmFsdWUsXG4gICAgICB2ZWxvY2l0eTogY29uZmlnLnZlbG9jaXR5IHx8IDAsXG4gICAgICBjdXJyZW50OiB0b1ZhbHVlLFxuICAgICAgc3RhcnRWYWx1ZTogMCxcbiAgICAgIGNhbGxiYWNrLFxuICAgICAgbGFzdFRpbWVzdGFtcDogMCxcbiAgICAgIHN0YXJ0VGltZXN0YW1wOiAwLFxuICAgICAgemV0YTogMCxcbiAgICAgIG9tZWdhMDogMCxcbiAgICAgIG9tZWdhMTogMCxcbiAgICAgIHJlZHVjZU1vdGlvbjogZ2V0UmVkdWNlTW90aW9uRm9yQW5pbWF0aW9uKGNvbmZpZy5yZWR1Y2VNb3Rpb24pLFxuICAgIH0gYXMgU3ByaW5nQW5pbWF0aW9uO1xuICB9KTtcbn0pIGFzIHdpdGhTcHJpbmdUeXBlO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDQSxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxVQUFBO0FBQ2IsSUFBQUMsS0FBQSxHQUFBQyxPQUFBO0FBY0EsSUFBQUMsWUFBQSxHQUFBRCxPQUFBO0FBMEJPLElBQU1GLFVBQVUsR0FBQUYsT0FBQSxDQUFBRSxVQUFBLEdBQUksU0FBZEEsVUFBVUEsQ0FDckJJLE9BQXdCLEVBQ3hCQyxV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