27566a3935fc3c079bcdb4c0030dd4dd
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _BatchedBridge = _interopRequireDefault(require("../BatchedBridge/BatchedBridge"));
var _BugReporting = _interopRequireDefault(require("../BugReporting/BugReporting"));
var _createPerformanceLogger = _interopRequireDefault(require("../Utilities/createPerformanceLogger"));
var _infoLog = _interopRequireDefault(require("../Utilities/infoLog"));
var _SceneTracker = _interopRequireDefault(require("../Utilities/SceneTracker"));
var _DisplayMode = require("./DisplayMode");
var _HeadlessJsTaskError = _interopRequireDefault(require("./HeadlessJsTaskError"));
var _NativeHeadlessJsTaskSupport = _interopRequireDefault(require("./NativeHeadlessJsTaskSupport"));
var _renderApplication = _interopRequireDefault(require("./renderApplication"));
var _RendererProxy = require("./RendererProxy");
var _invariant = _interopRequireDefault(require("invariant"));
var runnables = {};
var runCount = 1;
var sections = {};
var taskProviders = new Map();
var taskCancelProviders = new Map();
var componentProviderInstrumentationHook = function componentProviderInstrumentationHook(component) {
  return component();
};
var wrapperComponentProvider;
var rootViewStyleProvider;
var showArchitectureIndicator = false;
var AppRegistry = {
  setWrapperComponentProvider: function setWrapperComponentProvider(provider) {
    wrapperComponentProvider = provider;
  },
  setRootViewStyleProvider: function setRootViewStyleProvider(provider) {
    rootViewStyleProvider = provider;
  },
  enableArchitectureIndicator: function enableArchitectureIndicator(enabled) {
    showArchitectureIndicator = enabled;
  },
  registerConfig: function registerConfig(config) {
    config.forEach(function (appConfig) {
      if (appConfig.run) {
        AppRegistry.registerRunnable(appConfig.appKey, appConfig.run);
      } else {
        (0, _invariant.default)(appConfig.component != null, 'AppRegistry.registerConfig(...): Every config is expected to set ' + 'either `run` or `component`, but `%s` has neither.', appConfig.appKey);
        AppRegistry.registerComponent(appConfig.appKey, appConfig.component, appConfig.section);
      }
    });
  },
  registerComponent: function registerComponent(appKey, componentProvider, section) {
    var scopedPerformanceLogger = (0, _createPerformanceLogger.default)();
    runnables[appKey] = function (appParameters, displayMode) {
      var _appParameters$initia;
      var concurrentRootEnabled = Boolean(((_appParameters$initia = appParameters.initialProps) == null ? void 0 : _appParameters$initia.concurrentRoot) || appParameters.concurrentRoot);
      (0, _renderApplication.default)(componentProviderInstrumentationHook(componentProvider, scopedPerformanceLogger), appParameters.initialProps, appParameters.rootTag, wrapperComponentProvider && wrapperComponentProvider(appParameters), rootViewStyleProvider && rootViewStyleProvider(appParameters), appParameters.fabric, showArchitectureIndicator, scopedPerformanceLogger, appKey === 'LogBox', appKey, displayMode, concurrentRootEnabled);
    };
    if (section) {
      sections[appKey] = runnables[appKey];
    }
    return appKey;
  },
  registerRunnable: function registerRunnable(appKey, run) {
    runnables[appKey] = run;
    return appKey;
  },
  registerSection: function registerSection(appKey, component) {
    AppRegistry.registerComponent(appKey, component, true);
  },
  getAppKeys: function getAppKeys() {
    return Object.keys(runnables);
  },
  getSectionKeys: function getSectionKeys() {
    return Object.keys(sections);
  },
  getSections: function getSections() {
    return Object.assign({}, sections);
  },
  getRunnable: function getRunnable(appKey) {
    return runnables[appKey];
  },
  getRegistry: function getRegistry() {
    return {
      sections: AppRegistry.getSectionKeys(),
      runnables: Object.assign({}, runnables)
    };
  },
  setComponentProviderInstrumentationHook: function setComponentProviderInstrumentationHook(hook) {
    componentProviderInstrumentationHook = hook;
  },
  runApplication: function runApplication(appKey, appParameters, displayMode) {
    if (appKey !== 'LogBox') {
      var logParams = __DEV__ ? ` with ${JSON.stringify(appParameters)}` : '';
      var msg = `Running "${appKey}"${logParams}`;
      (0, _infoLog.default)(msg);
      _BugReporting.default.addSource('AppRegistry.runApplication' + runCount++, function () {
        return msg;
      });
    }
    (0, _invariant.default)(runnables[appKey], `"${appKey}" has not been registered. This can happen if:\n` + '* Metro (the local dev server) is run from the wrong folder. ' + 'Check if Metro is running, stop it and restart it in the current project.\n' + "* A module failed to load due to an error and `AppRegistry.registerComponent` wasn't called.");
    _SceneTracker.default.setActiveScene({
      name: appKey
    });
    runnables[appKey](appParameters, (0, _DisplayMode.coerceDisplayMode)(displayMode));
  },
  setSurfaceProps: function setSurfaceProps(appKey, appParameters, displayMode) {
    if (appKey !== 'LogBox') {
      var msg = 'Updating props for Surface "' + appKey + '" with ' + JSON.stringify(appParameters);
      (0, _infoLog.default)(msg);
      _BugReporting.default.addSource('AppRegistry.setSurfaceProps' + runCount++, function () {
        return msg;
      });
    }
    (0, _invariant.default)(runnables[appKey], `"${appKey}" has not been registered. This can happen if:\n` + '* Metro (the local dev server) is run from the wrong folder. ' + 'Check if Metro is running, stop it and restart it in the current project.\n' + "* A module failed to load due to an error and `AppRegistry.registerComponent` wasn't called.");
    runnables[appKey](appParameters, (0, _DisplayMode.coerceDisplayMode)(displayMode));
  },
  unmountApplicationComponentAtRootTag: function unmountApplicationComponentAtRootTag(rootTag) {
    (0, _RendererProxy.unmountComponentAtNodeAndRemoveContainer)(rootTag);
  },
  registerHeadlessTask: function registerHeadlessTask(taskKey, taskProvider) {
    this.registerCancellableHeadlessTask(taskKey, taskProvider, function () {
      return function () {};
    });
  },
  registerCancellableHeadlessTask: function registerCancellableHeadlessTask(taskKey, taskProvider, taskCancelProvider) {
    if (taskProviders.has(taskKey)) {
      console.warn(`registerHeadlessTask or registerCancellableHeadlessTask called multiple times for same key '${taskKey}'`);
    }
    taskProviders.set(taskKey, taskProvider);
    taskCancelProviders.set(taskKey, taskCancelProvider);
  },
  startHeadlessTask: function startHeadlessTask(taskId, taskKey, data) {
    var taskProvider = taskProviders.get(taskKey);
    if (!taskProvider) {
      console.warn(`No task registered for key ${taskKey}`);
      if (_NativeHeadlessJsTaskSupport.default) {
        _NativeHeadlessJsTaskSupport.default.notifyTaskFinished(taskId);
      }
      return;
    }
    taskProvider()(data).then(function () {
      if (_NativeHeadlessJsTaskSupport.default) {
        _NativeHeadlessJsTaskSupport.default.notifyTaskFinished(taskId);
      }
    }).catch(function (reason) {
      console.error(reason);
      if (_NativeHeadlessJsTaskSupport.default && reason instanceof _HeadlessJsTaskError.default) {
        _NativeHeadlessJsTaskSupport.default.notifyTaskRetry(taskId).then(function (retryPosted) {
          if (!retryPosted) {
            _NativeHeadlessJsTaskSupport.default.notifyTaskFinished(taskId);
          }
        });
      }
    });
  },
  cancelHeadlessTask: function cancelHeadlessTask(taskId, taskKey) {
    var taskCancelProvider = taskCancelProviders.get(taskKey);
    if (!taskCancelProvider) {
      throw new Error(`No task canceller registered for key '${taskKey}'`);
    }
    taskCancelProvider()();
  }
};
AppRegistry.registerComponent('LogBox', function () {
  if (__DEV__ && typeof jest === 'undefined') {
    return require('../LogBox/LogBoxInspectorContainer').default;
  } else {
    return function NoOp() {
      return null;
    };
  }
});
global.RN$AppRegistry = AppRegistry;
global.RN$SurfaceRegistry = {
  renderSurface: AppRegistry.runApplication,
  setSurfaceProps: AppRegistry.setSurfaceProps
};
if (global.RN$Bridgeless === true) {
  console.log('Bridgeless mode is enabled');
} else {
  _BatchedBridge.default.registerCallableModule('AppRegistry', AppRegistry);
}
module.exports = AppRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQmF0Y2hlZEJyaWRnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0J1Z1JlcG9ydGluZyIsIl9jcmVhdGVQZXJmb3JtYW5jZUxvZ2dlciIsIl9pbmZvTG9nIiwiX1NjZW5lVHJhY2tlciIsIl9EaXNwbGF5TW9kZSIsIl9IZWFkbGVzc0pzVGFza0Vycm9yIiwiX05hdGl2ZUhlYWRsZXNzSnNUYXNrU3VwcG9ydCIsIl9yZW5kZXJBcHBsaWNhdGlvbiIsIl9SZW5kZXJlclByb3h5IiwiX2ludmFyaWFudCIsInJ1bm5hYmxlcyIsInJ1bkNvdW50Iiwic2VjdGlvbnMiLCJ0YXNrUHJvdmlkZXJzIiwiTWFwIiwidGFza0NhbmNlbFByb3ZpZGVycyIsImNvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayIsImNvbXBvbmVudCIsIndyYXBwZXJDb21wb25lbnRQcm92aWRlciIsInJvb3RWaWV3U3R5bGVQcm92aWRlciIsInNob3dBcmNoaXRlY3R1cmVJbmRpY2F0b3IiLCJBcHBSZWdpc3RyeSIsInNldFdyYXBwZXJDb21wb25lbnRQcm92aWRlciIsInByb3ZpZGVyIiwic2V0Um9vdFZpZXdTdHlsZVByb3ZpZGVyIiwiZW5hYmxlQXJjaGl0ZWN0dXJlSW5kaWNhdG9yIiwiZW5hYmxlZCIsInJlZ2lzdGVyQ29uZmlnIiwiY29uZmlnIiwiZm9yRWFjaCIsImFwcENvbmZpZyIsInJ1biIsInJlZ2lzdGVyUnVubmFibGUiLCJhcHBLZXkiLCJpbnZhcmlhbnQiLCJyZWdpc3RlckNvbXBvbmVudCIsInNlY3Rpb24iLCJjb21wb25lbnRQcm92aWRlciIsInNjb3BlZFBlcmZvcm1hbmNlTG9nZ2VyIiwiY3JlYXRlUGVyZm9ybWFuY2VMb2dnZXIiLCJhcHBQYXJhbWV0ZXJzIiwiZGlzcGxheU1vZGUiLCJfYXBwUGFyYW1ldGVycyRpbml0aWEiLCJjb25jdXJyZW50Um9vdEVuYWJsZWQiLCJCb29sZWFuIiwiaW5pdGlhbFByb3BzIiwiY29uY3VycmVudFJvb3QiLCJyZW5kZXJBcHBsaWNhdGlvbiIsInJvb3RUYWciLCJmYWJyaWMiLCJyZWdpc3RlclNlY3Rpb24iLCJnZXRBcHBLZXlzIiwiT2JqZWN0Iiwia2V5cyIsImdldFNlY3Rpb25LZXlzIiwiZ2V0U2VjdGlvbnMiLCJhc3NpZ24iLCJnZXRSdW5uYWJsZSIsImdldFJlZ2lzdHJ5Iiwic2V0Q29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rIiwiaG9vayIsInJ1bkFwcGxpY2F0aW9uIiwibG9nUGFyYW1zIiwiX19ERVZfXyIsIkpTT04iLCJzdHJpbmdpZnkiLCJtc2ciLCJpbmZvTG9nIiwiQnVnUmVwb3J0aW5nIiwiYWRkU291cmNlIiwiU2NlbmVUcmFja2VyIiwic2V0QWN0aXZlU2NlbmUiLCJuYW1lIiwiY29lcmNlRGlzcGxheU1vZGUiLCJzZXRTdXJmYWNlUHJvcHMiLCJ1bm1vdW50QXBwbGljYXRpb25Db21wb25lbnRBdFJvb3RUYWciLCJ1bm1vdW50Q29tcG9uZW50QXROb2RlQW5kUmVtb3ZlQ29udGFpbmVyIiwicmVnaXN0ZXJIZWFkbGVzc1Rhc2siLCJ0YXNrS2V5IiwidGFza1Byb3ZpZGVyIiwicmVnaXN0ZXJDYW5jZWxsYWJsZUhlYWRsZXNzVGFzayIsInRhc2tDYW5jZWxQcm92aWRlciIsImhhcyIsImNvbnNvbGUiLCJ3YXJuIiwic2V0Iiwic3RhcnRIZWFkbGVzc1Rhc2siLCJ0YXNrSWQiLCJkYXRhIiwiZ2V0IiwiTmF0aXZlSGVhZGxlc3NKc1Rhc2tTdXBwb3J0Iiwibm90aWZ5VGFza0ZpbmlzaGVkIiwidGhlbiIsImNhdGNoIiwicmVhc29uIiwiZXJyb3IiLCJIZWFkbGVzc0pzVGFza0Vycm9yIiwibm90aWZ5VGFza1JldHJ5IiwicmV0cnlQb3N0ZWQiLCJjYW5jZWxIZWFkbGVzc1Rhc2siLCJFcnJvciIsImplc3QiLCJkZWZhdWx0IiwiTm9PcCIsImdsb2JhbCIsIlJOJEFwcFJlZ2lzdHJ5IiwiUk4kU3VyZmFjZVJlZ2lzdHJ5IiwicmVuZGVyU3VyZmFjZSIsIlJOJEJyaWRnZWxlc3MiLCJsb2ciLCJCYXRjaGVkQnJpZGdlIiwicmVnaXN0ZXJDYWxsYWJsZU1vZHVsZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJBcHBSZWdpc3RyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7Vmlld1N0eWxlUHJvcH0gZnJvbSAnLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0JztcbmltcG9ydCB0eXBlIHtSb290VGFnfSBmcm9tICcuLi9UeXBlcy9Sb290VGFnVHlwZXMnO1xuaW1wb3J0IHR5cGUge0lQZXJmb3JtYW5jZUxvZ2dlcn0gZnJvbSAnLi4vVXRpbGl0aWVzL2NyZWF0ZVBlcmZvcm1hbmNlTG9nZ2VyJztcbmltcG9ydCB0eXBlIHtEaXNwbGF5TW9kZVR5cGV9IGZyb20gJy4vRGlzcGxheU1vZGUnO1xuXG5pbXBvcnQgQmF0Y2hlZEJyaWRnZSBmcm9tICcuLi9CYXRjaGVkQnJpZGdlL0JhdGNoZWRCcmlkZ2UnO1xuaW1wb3J0IEJ1Z1JlcG9ydGluZyBmcm9tICcuLi9CdWdSZXBvcnRpbmcvQnVnUmVwb3J0aW5nJztcbmltcG9ydCBjcmVhdGVQZXJmb3JtYW5jZUxvZ2dlciBmcm9tICcuLi9VdGlsaXRpZXMvY3JlYXRlUGVyZm9ybWFuY2VMb2dnZXInO1xuaW1wb3J0IGluZm9Mb2cgZnJvbSAnLi4vVXRpbGl0aWVzL2luZm9Mb2cnO1xuaW1wb3J0IFNjZW5lVHJhY2tlciBmcm9tICcuLi9VdGlsaXRpZXMvU2NlbmVUcmFja2VyJztcbmltcG9ydCB7Y29lcmNlRGlzcGxheU1vZGV9IGZyb20gJy4vRGlzcGxheU1vZGUnO1xuaW1wb3J0IEhlYWRsZXNzSnNUYXNrRXJyb3IgZnJvbSAnLi9IZWFkbGVzc0pzVGFza0Vycm9yJztcbmltcG9ydCBOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQgZnJvbSAnLi9OYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQnO1xuaW1wb3J0IHJlbmRlckFwcGxpY2F0aW9uIGZyb20gJy4vcmVuZGVyQXBwbGljYXRpb24nO1xuaW1wb3J0IHt1bm1vdW50Q29tcG9uZW50QXROb2RlQW5kUmVtb3ZlQ29udGFpbmVyfSBmcm9tICcuL1JlbmRlcmVyUHJveHknO1xuaW1wb3J0IGludmFyaWFudCBmcm9tICdpbnZhcmlhbnQnO1xuXG50eXBlIFRhc2sgPSAodGFza0RhdGE6IGFueSkgPT4gUHJvbWlzZTx2b2lkPjtcbmV4cG9ydCB0eXBlIFRhc2tQcm92aWRlciA9ICgpID0+IFRhc2s7XG50eXBlIFRhc2tDYW5jZWxsZXIgPSAoKSA9PiB2b2lkO1xudHlwZSBUYXNrQ2FuY2VsUHJvdmlkZXIgPSAoKSA9PiBUYXNrQ2FuY2VsbGVyO1xuXG5leHBvcnQgdHlwZSBDb21wb25lbnRQcm92aWRlciA9ICgpID0+IFJlYWN0JENvbXBvbmVudFR5cGU8YW55PjtcbmV4cG9ydCB0eXBlIENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayA9IChcbiAgY29tcG9uZW50XzogQ29tcG9uZW50UHJvdmlkZXIsXG4gIHNjb3BlZFBlcmZvcm1hbmNlTG9nZ2VyOiBJUGVyZm9ybWFuY2VMb2dnZXIsXG4pID0+IFJlYWN0JENvbXBvbmVudFR5cGU8YW55PjtcbmV4cG9ydCB0eXBlIEFwcENvbmZpZyA9IHtcbiAgYXBwS2V5OiBzdHJpbmcsXG4gIGNvbXBvbmVudD86IENvbXBvbmVudFByb3ZpZGVyLFxuICBydW4/OiBSdW5uYWJsZSxcbiAgc2VjdGlvbj86IGJvb2xlYW4sXG4gIC4uLlxufTtcbnR5cGUgQXBwUGFyYW1ldGVycyA9IHtcbiAgaW5pdGlhbFByb3BzOiAkUmVhZE9ubHk8e1tzdHJpbmddOiBtaXhlZCwgLi4ufT4sXG4gIHJvb3RUYWc6IFJvb3RUYWcsXG4gIGZhYnJpYz86IGJvb2xlYW4sXG4gIGNvbmN1cnJlbnRSb290PzogYm9vbGVhbixcbn07XG5leHBvcnQgdHlwZSBSdW5uYWJsZSA9IChcbiAgYXBwUGFyYW1ldGVyczogQXBwUGFyYW1ldGVycyxcbiAgZGlzcGxheU1vZGU6IERpc3BsYXlNb2RlVHlwZSxcbikgPT4gdm9pZDtcbmV4cG9ydCB0eXBlIFJ1bm5hYmxlcyA9IHtbYXBwS2V5OiBzdHJpbmddOiBSdW5uYWJsZX07XG5leHBvcnQgdHlwZSBSZWdpc3RyeSA9IHtcbiAgc2VjdGlvbnM6ICRSZWFkT25seUFycmF5PHN0cmluZz4sXG4gIHJ1bm5hYmxlczogUnVubmFibGVzLFxuICAuLi5cbn07XG5leHBvcnQgdHlwZSBXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgPSAoXG4gIGFwcFBhcmFtZXRlcnM6IE9iamVjdCxcbikgPT4gUmVhY3QkQ29tcG9uZW50VHlwZTxhbnk+O1xuZXhwb3J0IHR5cGUgUm9vdFZpZXdTdHlsZVByb3ZpZGVyID0gKGFwcFBhcmFtZXRlcnM6IE9iamVjdCkgPT4gVmlld1N0eWxlUHJvcDtcblxuY29uc3QgcnVubmFibGVzOiBSdW5uYWJsZXMgPSB7fTtcbmxldCBydW5Db3VudCA9IDE7XG5jb25zdCBzZWN0aW9uczogUnVubmFibGVzID0ge307XG5jb25zdCB0YXNrUHJvdmlkZXJzOiBNYXA8c3RyaW5nLCBUYXNrUHJvdmlkZXI+ID0gbmV3IE1hcCgpO1xuY29uc3QgdGFza0NhbmNlbFByb3ZpZGVyczogTWFwPHN0cmluZywgVGFza0NhbmNlbFByb3ZpZGVyPiA9IG5ldyBNYXAoKTtcbmxldCBjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2s6IENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayA9XG4gIChjb21wb25lbnQ6IENvbXBvbmVudFByb3ZpZGVyKSA9PiBjb21wb25lbnQoKTtcblxubGV0IHdyYXBwZXJDb21wb25lbnRQcm92aWRlcjogP1dyYXBwZXJDb21wb25lbnRQcm92aWRlcjtcbmxldCByb290Vmlld1N0eWxlUHJvdmlkZXI6ID9Sb290Vmlld1N0eWxlUHJvdmlkZXI7XG5sZXQgc2hvd0FyY2hpdGVjdHVyZUluZGljYXRvciA9IGZhbHNlO1xuXG4vKipcbiAqIGBBcHBSZWdpc3RyeWAgaXMgdGhlIEphdmFTY3JpcHQgZW50cnkgcG9pbnQgdG8gcnVubmluZyBhbGwgUmVhY3QgTmF0aXZlIGFwcHMuXG4gKlxuICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYXBwcmVnaXN0cnlcbiAqL1xuY29uc3QgQXBwUmVnaXN0cnkgPSB7XG4gIHNldFdyYXBwZXJDb21wb25lbnRQcm92aWRlcihwcm92aWRlcjogV3JhcHBlckNvbXBvbmVudFByb3ZpZGVyKSB7XG4gICAgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyID0gcHJvdmlkZXI7XG4gIH0sXG5cbiAgc2V0Um9vdFZpZXdTdHlsZVByb3ZpZGVyKHByb3ZpZGVyOiBSb290Vmlld1N0eWxlUHJvdmlkZXIpIHtcbiAgICByb290Vmlld1N0eWxlUHJvdmlkZXIgPSBwcm92aWRlcjtcbiAgfSxcblxuICBlbmFibGVBcmNoaXRlY3R1cmVJbmRpY2F0b3IoZW5hYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHNob3dBcmNoaXRlY3R1cmVJbmRpY2F0b3IgPSBlbmFibGVkO1xuICB9LFxuXG4gIHJlZ2lzdGVyQ29uZmlnKGNvbmZpZzogQXJyYXk8QXBwQ29uZmlnPik6IHZvaWQge1xuICAgIGNvbmZpZy5mb3JFYWNoKGFwcENvbmZpZyA9PiB7XG4gICAgICBpZiAoYXBwQ29uZmlnLnJ1bikge1xuICAgICAgICBBcHBSZWdpc3RyeS5yZWdpc3RlclJ1bm5hYmxlKGFwcENvbmZpZy5hcHBLZXksIGFwcENvbmZpZy5ydW4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgIGFwcENvbmZpZy5jb21wb25lbnQgIT0gbnVsbCxcbiAgICAgICAgICAnQXBwUmVnaXN0cnkucmVnaXN0ZXJDb25maWcoLi4uKTogRXZlcnkgY29uZmlnIGlzIGV4cGVjdGVkIHRvIHNldCAnICtcbiAgICAgICAgICAgICdlaXRoZXIgYHJ1bmAgb3IgYGNvbXBvbmVudGAsIGJ1dCBgJXNgIGhhcyBuZWl0aGVyLicsXG4gICAgICAgICAgYXBwQ29uZmlnLmFwcEtleSxcbiAgICAgICAgKTtcbiAgICAgICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoXG4gICAgICAgICAgYXBwQ29uZmlnLmFwcEtleSxcbiAgICAgICAgICBhcHBDb25maWcuY29tcG9uZW50LFxuICAgICAgICAgIGFwcENvbmZpZy5zZWN0aW9uLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYW4gYXBwJ3Mgcm9vdCBjb21wb25lbnQuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FwcHJlZ2lzdHJ5I3JlZ2lzdGVyY29tcG9uZW50XG4gICAqL1xuICByZWdpc3RlckNvbXBvbmVudChcbiAgICBhcHBLZXk6IHN0cmluZyxcbiAgICBjb21wb25lbnRQcm92aWRlcjogQ29tcG9uZW50UHJvdmlkZXIsXG4gICAgc2VjdGlvbj86IGJvb2xlYW4sXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3Qgc2NvcGVkUGVyZm9ybWFuY2VMb2dnZXIgPSBjcmVhdGVQZXJmb3JtYW5jZUxvZ2dlcigpO1xuICAgIHJ1bm5hYmxlc1thcHBLZXldID0gKGFwcFBhcmFtZXRlcnMsIGRpc3BsYXlNb2RlKSA9PiB7XG4gICAgICBjb25zdCBjb25jdXJyZW50Um9vdEVuYWJsZWQgPSBCb29sZWFuKFxuICAgICAgICBhcHBQYXJhbWV0ZXJzLmluaXRpYWxQcm9wcz8uY29uY3VycmVudFJvb3QgfHxcbiAgICAgICAgICBhcHBQYXJhbWV0ZXJzLmNvbmN1cnJlbnRSb290LFxuICAgICAgKTtcbiAgICAgIHJlbmRlckFwcGxpY2F0aW9uKFxuICAgICAgICBjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2soXG4gICAgICAgICAgY29tcG9uZW50UHJvdmlkZXIsXG4gICAgICAgICAgc2NvcGVkUGVyZm9ybWFuY2VMb2dnZXIsXG4gICAgICAgICksXG4gICAgICAgIGFwcFBhcmFtZXRlcnMuaW5pdGlhbFByb3BzLFxuICAgICAgICBhcHBQYXJhbWV0ZXJzLnJvb3RUYWcsXG4gICAgICAgIHdyYXBwZXJDb21wb25lbnRQcm92aWRlciAmJiB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIoYXBwUGFyYW1ldGVycyksXG4gICAgICAgIHJvb3RWaWV3U3R5bGVQcm92aWRlciAmJiByb290Vmlld1N0eWxlUHJvdmlkZXIoYXBwUGFyYW1ldGVycyksXG4gICAgICAgIGFwcFBhcmFtZXRlcnMuZmFicmljLFxuICAgICAgICBzaG93QXJjaGl0ZWN0dXJlSW5kaWNhdG9yLFxuICAgICAgICBzY29wZWRQZXJmb3JtYW5jZUxvZ2dlcixcbiAgICAgICAgYXBwS2V5ID09PSAnTG9nQm94JywgLy8gaXMgbG9nYm94XG4gICAgICAgIGFwcEtleSxcbiAgICAgICAgZGlzcGxheU1vZGUsXG4gICAgICAgIGNvbmN1cnJlbnRSb290RW5hYmxlZCxcbiAgICAgICk7XG4gICAgfTtcbiAgICBpZiAoc2VjdGlvbikge1xuICAgICAgc2VjdGlvbnNbYXBwS2V5XSA9IHJ1bm5hYmxlc1thcHBLZXldO1xuICAgIH1cbiAgICByZXR1cm4gYXBwS2V5O1xuICB9LFxuXG4gIHJlZ2lzdGVyUnVubmFibGUoYXBwS2V5OiBzdHJpbmcsIHJ1bjogUnVubmFibGUpOiBzdHJpbmcge1xuICAgIHJ1bm5hYmxlc1thcHBLZXldID0gcnVuO1xuICAgIHJldHVybiBhcHBLZXk7XG4gIH0sXG5cbiAgcmVnaXN0ZXJTZWN0aW9uKGFwcEtleTogc3RyaW5nLCBjb21wb25lbnQ6IENvbXBvbmVudFByb3ZpZGVyKTogdm9pZCB7XG4gICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoYXBwS2V5LCBjb21wb25lbnQsIHRydWUpO1xuICB9LFxuXG4gIGdldEFwcEtleXMoKTogJFJlYWRPbmx5QXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHJ1bm5hYmxlcyk7XG4gIH0sXG5cbiAgZ2V0U2VjdGlvbktleXMoKTogJFJlYWRPbmx5QXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNlY3Rpb25zKTtcbiAgfSxcblxuICBnZXRTZWN0aW9ucygpOiBSdW5uYWJsZXMge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zZWN0aW9ucyxcbiAgICB9O1xuICB9LFxuXG4gIGdldFJ1bm5hYmxlKGFwcEtleTogc3RyaW5nKTogP1J1bm5hYmxlIHtcbiAgICByZXR1cm4gcnVubmFibGVzW2FwcEtleV07XG4gIH0sXG5cbiAgZ2V0UmVnaXN0cnkoKTogUmVnaXN0cnkge1xuICAgIHJldHVybiB7XG4gICAgICBzZWN0aW9uczogQXBwUmVnaXN0cnkuZ2V0U2VjdGlvbktleXMoKSxcbiAgICAgIHJ1bm5hYmxlczogey4uLnJ1bm5hYmxlc30sXG4gICAgfTtcbiAgfSxcblxuICBzZXRDb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2soXG4gICAgaG9vazogQ29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rLFxuICApIHtcbiAgICBjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2sgPSBob29rO1xuICB9LFxuXG4gIC8qKlxuICAgKiBMb2FkcyB0aGUgSmF2YVNjcmlwdCBidW5kbGUgYW5kIHJ1bnMgdGhlIGFwcC5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYXBwcmVnaXN0cnkjcnVuYXBwbGljYXRpb25cbiAgICovXG4gIHJ1bkFwcGxpY2F0aW9uKFxuICAgIGFwcEtleTogc3RyaW5nLFxuICAgIGFwcFBhcmFtZXRlcnM6IEFwcFBhcmFtZXRlcnMsXG4gICAgZGlzcGxheU1vZGU/OiBudW1iZXIsXG4gICk6IHZvaWQge1xuICAgIGlmIChhcHBLZXkgIT09ICdMb2dCb3gnKSB7XG4gICAgICBjb25zdCBsb2dQYXJhbXMgPSBfX0RFVl9fID8gYCB3aXRoICR7SlNPTi5zdHJpbmdpZnkoYXBwUGFyYW1ldGVycyl9YCA6ICcnO1xuICAgICAgY29uc3QgbXNnID0gYFJ1bm5pbmcgXCIke2FwcEtleX1cIiR7bG9nUGFyYW1zfWA7XG4gICAgICBpbmZvTG9nKG1zZyk7XG4gICAgICBCdWdSZXBvcnRpbmcuYWRkU291cmNlKFxuICAgICAgICAnQXBwUmVnaXN0cnkucnVuQXBwbGljYXRpb24nICsgcnVuQ291bnQrKyxcbiAgICAgICAgKCkgPT4gbXNnLFxuICAgICAgKTtcbiAgICB9XG4gICAgaW52YXJpYW50KFxuICAgICAgcnVubmFibGVzW2FwcEtleV0sXG4gICAgICBgXCIke2FwcEtleX1cIiBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZC4gVGhpcyBjYW4gaGFwcGVuIGlmOlxcbmAgK1xuICAgICAgICAnKiBNZXRybyAodGhlIGxvY2FsIGRldiBzZXJ2ZXIpIGlzIHJ1biBmcm9tIHRoZSB3cm9uZyBmb2xkZXIuICcgK1xuICAgICAgICAnQ2hlY2sgaWYgTWV0cm8gaXMgcnVubmluZywgc3RvcCBpdCBhbmQgcmVzdGFydCBpdCBpbiB0aGUgY3VycmVudCBwcm9qZWN0LlxcbicgK1xuICAgICAgICBcIiogQSBtb2R1bGUgZmFpbGVkIHRvIGxvYWQgZHVlIHRvIGFuIGVycm9yIGFuZCBgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnRgIHdhc24ndCBjYWxsZWQuXCIsXG4gICAgKTtcblxuICAgIFNjZW5lVHJhY2tlci5zZXRBY3RpdmVTY2VuZSh7bmFtZTogYXBwS2V5fSk7XG4gICAgcnVubmFibGVzW2FwcEtleV0oYXBwUGFyYW1ldGVycywgY29lcmNlRGlzcGxheU1vZGUoZGlzcGxheU1vZGUpKTtcbiAgfSxcblxuICAvKipcbiAgICogVXBkYXRlIGluaXRpYWwgcHJvcHMgZm9yIGEgc3VyZmFjZSB0aGF0J3MgYWxyZWFkeSByZW5kZXJlZFxuICAgKi9cbiAgc2V0U3VyZmFjZVByb3BzKFxuICAgIGFwcEtleTogc3RyaW5nLFxuICAgIGFwcFBhcmFtZXRlcnM6IE9iamVjdCxcbiAgICBkaXNwbGF5TW9kZT86IG51bWJlcixcbiAgKTogdm9pZCB7XG4gICAgaWYgKGFwcEtleSAhPT0gJ0xvZ0JveCcpIHtcbiAgICAgIGNvbnN0IG1zZyA9XG4gICAgICAgICdVcGRhdGluZyBwcm9wcyBmb3IgU3VyZmFjZSBcIicgK1xuICAgICAgICBhcHBLZXkgK1xuICAgICAgICAnXCIgd2l0aCAnICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoYXBwUGFyYW1ldGVycyk7XG4gICAgICBpbmZvTG9nKG1zZyk7XG4gICAgICBCdWdSZXBvcnRpbmcuYWRkU291cmNlKFxuICAgICAgICAnQXBwUmVnaXN0cnkuc2V0U3VyZmFjZVByb3BzJyArIHJ1bkNvdW50KyssXG4gICAgICAgICgpID0+IG1zZyxcbiAgICAgICk7XG4gICAgfVxuICAgIGludmFyaWFudChcbiAgICAgIHJ1bm5hYmxlc1thcHBLZXldLFxuICAgICAgYFwiJHthcHBLZXl9XCIgaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQuIFRoaXMgY2FuIGhhcHBlbiBpZjpcXG5gICtcbiAgICAgICAgJyogTWV0cm8gKHRoZSBsb2NhbCBkZXYgc2VydmVyKSBpcyBydW4gZnJvbSB0aGUgd3JvbmcgZm9sZGVyLiAnICtcbiAgICAgICAgJ0NoZWNrIGlmIE1ldHJvIGlzIHJ1bm5pbmcsIHN0b3AgaXQgYW5kIHJlc3RhcnQgaXQgaW4gdGhlIGN1cnJlbnQgcHJvamVjdC5cXG4nICtcbiAgICAgICAgXCIqIEEgbW9kdWxlIGZhaWxlZCB0byBsb2FkIGR1ZSB0byBhbiBlcnJvciBhbmQgYEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29tcG9uZW50YCB3YXNuJ3QgY2FsbGVkLlwiLFxuICAgICk7XG5cbiAgICBydW5uYWJsZXNbYXBwS2V5XShhcHBQYXJhbWV0ZXJzLCBjb2VyY2VEaXNwbGF5TW9kZShkaXNwbGF5TW9kZSkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTdG9wcyBhbiBhcHBsaWNhdGlvbiB3aGVuIGEgdmlldyBzaG91bGQgYmUgZGVzdHJveWVkLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hcHByZWdpc3RyeSN1bm1vdW50YXBwbGljYXRpb25jb21wb25lbnRhdHJvb3R0YWdcbiAgICovXG4gIHVubW91bnRBcHBsaWNhdGlvbkNvbXBvbmVudEF0Um9vdFRhZyhyb290VGFnOiBSb290VGFnKTogdm9pZCB7XG4gICAgdW5tb3VudENvbXBvbmVudEF0Tm9kZUFuZFJlbW92ZUNvbnRhaW5lcihyb290VGFnKTtcbiAgfSxcblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBoZWFkbGVzcyB0YXNrLiBBIGhlYWRsZXNzIHRhc2sgaXMgYSBiaXQgb2YgY29kZSB0aGF0IHJ1bnMgd2l0aG91dCBhIFVJLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hcHByZWdpc3RyeSNyZWdpc3RlcmhlYWRsZXNzdGFza1xuICAgKi9cbiAgcmVnaXN0ZXJIZWFkbGVzc1Rhc2sodGFza0tleTogc3RyaW5nLCB0YXNrUHJvdmlkZXI6IFRhc2tQcm92aWRlcik6IHZvaWQge1xuICAgIC8vICRGbG93Rml4TWVbb2JqZWN0LXRoaXMtcmVmZXJlbmNlXVxuICAgIHRoaXMucmVnaXN0ZXJDYW5jZWxsYWJsZUhlYWRsZXNzVGFzayh0YXNrS2V5LCB0YXNrUHJvdmlkZXIsICgpID0+ICgpID0+IHtcbiAgICAgIC8qIENhbmNlbCBpcyBuby1vcCAqL1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGNhbmNlbGxhYmxlIGhlYWRsZXNzIHRhc2suIEEgaGVhZGxlc3MgdGFzayBpcyBhIGJpdCBvZiBjb2RlIHRoYXQgcnVucyB3aXRob3V0IGEgVUkuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FwcHJlZ2lzdHJ5I3JlZ2lzdGVyY2FuY2VsbGFibGVoZWFkbGVzc3Rhc2tcbiAgICovXG4gIHJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2soXG4gICAgdGFza0tleTogc3RyaW5nLFxuICAgIHRhc2tQcm92aWRlcjogVGFza1Byb3ZpZGVyLFxuICAgIHRhc2tDYW5jZWxQcm92aWRlcjogVGFza0NhbmNlbFByb3ZpZGVyLFxuICApOiB2b2lkIHtcbiAgICBpZiAodGFza1Byb3ZpZGVycy5oYXModGFza0tleSkpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYHJlZ2lzdGVySGVhZGxlc3NUYXNrIG9yIHJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2sgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBzYW1lIGtleSAnJHt0YXNrS2V5fSdgLFxuICAgICAgKTtcbiAgICB9XG4gICAgdGFza1Byb3ZpZGVycy5zZXQodGFza0tleSwgdGFza1Byb3ZpZGVyKTtcbiAgICB0YXNrQ2FuY2VsUHJvdmlkZXJzLnNldCh0YXNrS2V5LCB0YXNrQ2FuY2VsUHJvdmlkZXIpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBPbmx5IGNhbGxlZCBmcm9tIG5hdGl2ZSBjb2RlLiBTdGFydHMgYSBoZWFkbGVzcyB0YXNrLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hcHByZWdpc3RyeSNzdGFydGhlYWRsZXNzdGFza1xuICAgKi9cbiAgc3RhcnRIZWFkbGVzc1Rhc2sodGFza0lkOiBudW1iZXIsIHRhc2tLZXk6IHN0cmluZywgZGF0YTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdGFza1Byb3ZpZGVyID0gdGFza1Byb3ZpZGVycy5nZXQodGFza0tleSk7XG4gICAgaWYgKCF0YXNrUHJvdmlkZXIpIHtcbiAgICAgIGNvbnNvbGUud2FybihgTm8gdGFzayByZWdpc3RlcmVkIGZvciBrZXkgJHt0YXNrS2V5fWApO1xuICAgICAgaWYgKE5hdGl2ZUhlYWRsZXNzSnNUYXNrU3VwcG9ydCkge1xuICAgICAgICBOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQubm90aWZ5VGFza0ZpbmlzaGVkKHRhc2tJZCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRhc2tQcm92aWRlcigpKGRhdGEpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQpIHtcbiAgICAgICAgICBOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQubm90aWZ5VGFza0ZpbmlzaGVkKHRhc2tJZCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2gocmVhc29uID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQgJiZcbiAgICAgICAgICByZWFzb24gaW5zdGFuY2VvZiBIZWFkbGVzc0pzVGFza0Vycm9yXG4gICAgICAgICkge1xuICAgICAgICAgIC8vICRGbG93Rml4TWVbdW51c2VkLXByb21pc2VdXG4gICAgICAgICAgTmF0aXZlSGVhZGxlc3NKc1Rhc2tTdXBwb3J0Lm5vdGlmeVRhc2tSZXRyeSh0YXNrSWQpLnRoZW4oXG4gICAgICAgICAgICByZXRyeVBvc3RlZCA9PiB7XG4gICAgICAgICAgICAgIGlmICghcmV0cnlQb3N0ZWQpIHtcbiAgICAgICAgICAgICAgICBOYXRpdmVIZWFkbGVzc0pzVGFza1N1cHBvcnQubm90aWZ5VGFza0ZpbmlzaGVkKHRhc2tJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE9ubHkgY2FsbGVkIGZyb20gbmF0aXZlIGNvZGUuIENhbmNlbHMgYSBoZWFkbGVzcyB0YXNrLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hcHByZWdpc3RyeSNjYW5jZWxoZWFkbGVzc3Rhc2tcbiAgICovXG4gIGNhbmNlbEhlYWRsZXNzVGFzayh0YXNrSWQ6IG51bWJlciwgdGFza0tleTogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgdGFza0NhbmNlbFByb3ZpZGVyID0gdGFza0NhbmNlbFByb3ZpZGVycy5nZXQodGFza0tleSk7XG4gICAgaWYgKCF0YXNrQ2FuY2VsUHJvdmlkZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gdGFzayBjYW5jZWxsZXIgcmVnaXN0ZXJlZCBmb3Iga2V5ICcke3Rhc2tLZXl9J2ApO1xuICAgIH1cbiAgICB0YXNrQ2FuY2VsUHJvdmlkZXIoKSgpO1xuICB9LFxufTtcblxuLy8gUmVnaXN0ZXIgTG9nQm94IGFzIGEgZGVmYXVsdCBzdXJmYWNlXG5BcHBSZWdpc3RyeS5yZWdpc3RlckNvbXBvbmVudCgnTG9nQm94JywgKCkgPT4ge1xuICBpZiAoX19ERVZfXyAmJiB0eXBlb2YgamVzdCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gcmVxdWlyZSgnLi4vTG9nQm94L0xvZ0JveEluc3BlY3RvckNvbnRhaW5lcicpLmRlZmF1bHQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIE5vT3AoKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICB9XG59KTtcblxuZ2xvYmFsLlJOJEFwcFJlZ2lzdHJ5ID0gQXBwUmVnaXN0cnk7XG5cbi8vIEJhY2t3YXJkcyBjb21wYXQgd2l0aCBTdXJmYWNlUmVnaXN0cnksIHJlbW92ZSBtZSBsYXRlclxuZ2xvYmFsLlJOJFN1cmZhY2VSZWdpc3RyeSA9IHtcbiAgcmVuZGVyU3VyZmFjZTogQXBwUmVnaXN0cnkucnVuQXBwbGljYXRpb24sXG4gIHNldFN1cmZhY2VQcm9wczogQXBwUmVnaXN0cnkuc2V0U3VyZmFjZVByb3BzLFxufTtcblxuaWYgKGdsb2JhbC5STiRCcmlkZ2VsZXNzID09PSB0cnVlKSB7XG4gIGNvbnNvbGUubG9nKCdCcmlkZ2VsZXNzIG1vZGUgaXMgZW5hYmxlZCcpO1xufSBlbHNlIHtcbiAgQmF0Y2hlZEJyaWRnZS5yZWdpc3RlckNhbGxhYmxlTW9kdWxlKCdBcHBSZWdpc3RyeScsIEFwcFJlZ2lzdHJ5KTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBcHBSZWdpc3RyeTtcbiJdLCJtYXBwaW5ncyI6IjtBQWVBLElBQUFBLGNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGFBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLHdCQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSSxhQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxvQkFBQSxHQUFBUCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU8sNEJBQUEsR0FBQVIsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFRLGtCQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUyxjQUFBLEdBQUFULE9BQUE7QUFDQSxJQUFBVSxVQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUF3Q0EsSUFBTVcsU0FBb0IsR0FBRyxDQUFDLENBQUM7QUFDL0IsSUFBSUMsUUFBUSxHQUFHLENBQUM7QUFDaEIsSUFBTUMsUUFBbUIsR0FBRyxDQUFDLENBQUM7QUFDOUIsSUFBTUMsYUFBd0MsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQztBQUMxRCxJQUFNQyxtQkFBb0QsR0FBRyxJQUFJRCxHQUFHLENBQUMsQ0FBQztBQUN0RSxJQUFJRSxvQ0FBMEUsR0FDNUUsU0FERUEsb0NBQTBFQSxDQUMzRUMsU0FBNEI7RUFBQSxPQUFLQSxTQUFTLENBQUMsQ0FBQztBQUFBO0FBRS9DLElBQUlDLHdCQUFtRDtBQUN2RCxJQUFJQyxxQkFBNkM7QUFDakQsSUFBSUMseUJBQXlCLEdBQUcsS0FBSztBQU9yQyxJQUFNQyxXQUFXLEdBQUc7RUFDbEJDLDJCQUEyQixXQUEzQkEsMkJBQTJCQSxDQUFDQyxRQUFrQyxFQUFFO0lBQzlETCx3QkFBd0IsR0FBR0ssUUFBUTtFQUNyQyxDQUFDO0VBRURDLHdCQUF3QixXQUF4QkEsd0JBQXdCQSxDQUFDRCxRQUErQixFQUFFO0lBQ3hESixxQkFBcUIsR0FBR0ksUUFBUTtFQUNsQyxDQUFDO0VBRURFLDJCQUEyQixXQUEzQkEsMkJBQTJCQSxDQUFDQyxPQUFnQixFQUFRO0lBQ2xETix5QkFBeUIsR0FBR00sT0FBTztFQUNyQyxDQUFDO0VBRURDLGNBQWMsV0FBZEEsY0FBY0EsQ0FBQ0MsTUFBd0IsRUFBUTtJQUM3Q0EsTUFBTSxDQUFDQyxPQUFPLENBQUMsVUFBQUMsU0FBUyxFQUFJO01BQzFCLElBQUlBLFNBQVMsQ0FBQ0MsR0FBRyxFQUFFO1FBQ2pCVixXQUFXLENBQUNXLGdCQUFnQixDQUFDRixTQUFTLENBQUNHLE1BQU0sRUFBRUgsU0FBUyxDQUFDQyxHQUFHLENBQUM7TUFDL0QsQ0FBQyxNQUFNO1FBQ0wsSUFBQUcsa0JBQVMsRUFDUEosU0FBUyxDQUFDYixTQUFTLElBQUksSUFBSSxFQUMzQixtRUFBbUUsR0FDakUsb0RBQW9ELEVBQ3REYSxTQUFTLENBQUNHLE1BQ1osQ0FBQztRQUNEWixXQUFXLENBQUNjLGlCQUFpQixDQUMzQkwsU0FBUyxDQUFDRyxNQUFNLEVBQ2hCSCxTQUFTLENBQUNiLFNBQVMsRUFDbkJhLFNBQVMsQ0FBQ00sT0FDWixDQUFDO01BQ0g7SUFDRixDQUFDLENBQUM7RUFDSixDQUFDO0VBT0RELGlCQUFpQixXQUFqQkEsaUJBQWlCQSxDQUNmRixNQUFjLEVBQ2RJLGlCQUFvQyxFQUNwQ0QsT0FBaUIsRUFDVDtJQUNSLElBQU1FLHVCQUF1QixHQUFHLElBQUFDLGdDQUF1QixFQUFDLENBQUM7SUFDekQ3QixTQUFTLENBQUN1QixNQUFNLENBQUMsR0FBRyxVQUFDTyxhQUFhLEVBQUVDLFdBQVcsRUFBSztNQUFBLElBQUFDLHFCQUFBO01BQ2xELElBQU1DLHFCQUFxQixHQUFHQyxPQUFPLENBQ25DLEVBQUFGLHFCQUFBLEdBQUFGLGFBQWEsQ0FBQ0ssWUFBWSxxQkFBMUJILHFCQUFBLENBQTRCSSxjQUFjLEtBQ3hDTixhQUFhLENBQUNNLGNBQ2xCLENBQUM7TUFDRCxJQUFBQywwQkFBaUIsRUFDZi9CLG9DQUFvQyxDQUNsQ3FCLGlCQUFpQixFQUNqQkMsdUJBQ0YsQ0FBQyxFQUNERSxhQUFhLENBQUNLLFlBQVksRUFDMUJMLGFBQWEsQ0FBQ1EsT0FBTyxFQUNyQjlCLHdCQUF3QixJQUFJQSx3QkFBd0IsQ0FBQ3NCLGFBQWEsQ0FBQyxFQUNuRXJCLHFCQUFxQixJQUFJQSxxQkFBcUIsQ0FBQ3FCLGFBQWEsQ0FBQyxFQUM3REEsYUFBYSxDQUFDUyxNQUFNLEVBQ3BCN0IseUJBQXlCLEVBQ3pCa0IsdUJBQXVCLEVBQ3ZCTCxNQUFNLEtBQUssUUFBUSxFQUNuQkEsTUFBTSxFQUNOUSxXQUFXLEVBQ1hFLHFCQUNGLENBQUM7SUFDSCxDQUFDO0lBQ0QsSUFBSVAsT0FBTyxFQUFFO01BQ1h4QixRQUFRLENBQUNxQixNQUFNLENBQUMsR0FBR3ZCLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQztJQUN0QztJQUNBLE9BQU9BLE1BQU07RUFDZixDQUFDO0VBRURELGdCQUFnQixXQUFoQkEsZ0JBQWdCQSxDQUFDQyxNQUFjLEVBQUVGLEdBQWEsRUFBVTtJQUN0RHJCLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxHQUFHRixHQUFHO0lBQ3ZCLE9BQU9FLE1BQU07RUFDZixDQUFDO0VBRURpQixlQUFlLFdBQWZBLGVBQWVBLENBQUNqQixNQUFjLEVBQUVoQixTQUE0QixFQUFRO0lBQ2xFSSxXQUFXLENBQUNjLGlCQUFpQixDQUFDRixNQUFNLEVBQUVoQixTQUFTLEVBQUUsSUFBSSxDQUFDO0VBQ3hELENBQUM7RUFFRGtDLFVBQVUsV0FBVkEsVUFBVUEsQ0FBQSxFQUEyQjtJQUNuQyxPQUFPQyxNQUFNLENBQUNDLElBQUksQ0FBQzNDLFNBQVMsQ0FBQztFQUMvQixDQUFDO0VBRUQ0QyxjQUFjLFdBQWRBLGNBQWNBLENBQUEsRUFBMkI7SUFDdkMsT0FBT0YsTUFBTSxDQUFDQyxJQUFJLENBQUN6QyxRQUFRLENBQUM7RUFDOUIsQ0FBQztFQUVEMkMsV0FBVyxXQUFYQSxXQUFXQSxDQUFBLEVBQWM7SUFDdkIsT0FBQUgsTUFBQSxDQUFBSSxNQUFBLEtBQ0s1QyxRQUFRO0VBRWYsQ0FBQztFQUVENkMsV0FBVyxXQUFYQSxXQUFXQSxDQUFDeEIsTUFBYyxFQUFhO0lBQ3JDLE9BQU92QixTQUFTLENBQUN1QixNQUFNLENBQUM7RUFDMUIsQ0FBQztFQUVEeUIsV0FBVyxXQUFYQSxXQUFXQSxDQUFBLEVBQWE7SUFDdEIsT0FBTztNQUNMOUMsUUFBUSxFQUFFUyxXQUFXLENBQUNpQyxjQUFjLENBQUMsQ0FBQztNQUN0QzVDLFNBQVMsRUFBQTBDLE1BQUEsQ0FBQUksTUFBQSxLQUFNOUMsU0FBUztJQUMxQixDQUFDO0VBQ0gsQ0FBQztFQUVEaUQsdUNBQXVDLFdBQXZDQSx1Q0FBdUNBLENBQ3JDQyxJQUEwQyxFQUMxQztJQUNBNUMsb0NBQW9DLEdBQUc0QyxJQUFJO0VBQzdDLENBQUM7RUFPREMsY0FBYyxXQUFkQSxjQUFjQSxDQUNaNUIsTUFBYyxFQUNkTyxhQUE0QixFQUM1QkMsV0FBb0IsRUFDZDtJQUNOLElBQUlSLE1BQU0sS0FBSyxRQUFRLEVBQUU7TUFDdkIsSUFBTTZCLFNBQVMsR0FBR0MsT0FBTyxHQUFHLFNBQVNDLElBQUksQ0FBQ0MsU0FBUyxDQUFDekIsYUFBYSxDQUFDLEVBQUUsR0FBRyxFQUFFO01BQ3pFLElBQU0wQixHQUFHLEdBQUcsWUFBWWpDLE1BQU0sSUFBSTZCLFNBQVMsRUFBRTtNQUM3QyxJQUFBSyxnQkFBTyxFQUFDRCxHQUFHLENBQUM7TUFDWkUscUJBQVksQ0FBQ0MsU0FBUyxDQUNwQiw0QkFBNEIsR0FBRzFELFFBQVEsRUFBRSxFQUN6QztRQUFBLE9BQU11RCxHQUFHO01BQUEsQ0FDWCxDQUFDO0lBQ0g7SUFDQSxJQUFBaEMsa0JBQVMsRUFDUHhCLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxFQUNqQixJQUFJQSxNQUFNLGtEQUFrRCxHQUMxRCwrREFBK0QsR0FDL0QsNkVBQTZFLEdBQzdFLDhGQUNKLENBQUM7SUFFRHFDLHFCQUFZLENBQUNDLGNBQWMsQ0FBQztNQUFDQyxJQUFJLEVBQUV2QztJQUFNLENBQUMsQ0FBQztJQUMzQ3ZCLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxDQUFDTyxhQUFhLEVBQUUsSUFBQWlDLDhCQUFpQixFQUFDaEMsV0FBVyxDQUFDLENBQUM7RUFDbEUsQ0FBQztFQUtEaUMsZUFBZSxXQUFmQSxlQUFlQSxDQUNiekMsTUFBYyxFQUNkTyxhQUFxQixFQUNyQkMsV0FBb0IsRUFDZDtJQUNOLElBQUlSLE1BQU0sS0FBSyxRQUFRLEVBQUU7TUFDdkIsSUFBTWlDLEdBQUcsR0FDUCw4QkFBOEIsR0FDOUJqQyxNQUFNLEdBQ04sU0FBUyxHQUNUK0IsSUFBSSxDQUFDQyxTQUFTLENBQUN6QixhQUFhLENBQUM7TUFDL0IsSUFBQTJCLGdCQUFPLEVBQUNELEdBQUcsQ0FBQztNQUNaRSxxQkFBWSxDQUFDQyxTQUFTLENBQ3BCLDZCQUE2QixHQUFHMUQsUUFBUSxFQUFFLEVBQzFDO1FBQUEsT0FBTXVELEdBQUc7TUFBQSxDQUNYLENBQUM7SUFDSDtJQUNBLElBQUFoQyxrQkFBUyxFQUNQeEIsU0FBUyxDQUFDdUIsTUFBTSxDQUFDLEVBQ2pCLElBQUlBLE1BQU0sa0RBQWtELEdBQzFELCtEQUErRCxHQUMvRCw2RUFBNkUsR0FDN0UsOEZBQ0osQ0FBQztJQUVEdkIsU0FBUyxDQUFDdUIsTUFBTSxDQUFDLENBQUNPLGFBQWEsRUFBRSxJQUFBaUMsOEJBQWlCLEVBQUNoQyxXQUFXLENBQUMsQ0FBQztFQUNsRSxDQUFDO0VBT0RrQyxvQ0FBb0MsV0FBcENBLG9DQUFvQ0EsQ0FBQzNCLE9BQWdCLEVBQVE7SUFDM0QsSUFBQTRCLHVEQUF3QyxFQUFDNUIsT0FBTyxDQUFDO0VBQ25ELENBQUM7RUFPRDZCLG9CQUFvQixXQUFwQkEsb0JBQW9CQSxDQUFDQyxPQUFlLEVBQUVDLFlBQTBCLEVBQVE7SUFFdEUsSUFBSSxDQUFDQywrQkFBK0IsQ0FBQ0YsT0FBTyxFQUFFQyxZQUFZLEVBQUU7TUFBQSxPQUFNLFlBQU0sQ0FFeEUsQ0FBQztJQUFBLEVBQUM7RUFDSixDQUFDO0VBT0RDLCtCQUErQixXQUEvQkEsK0JBQStCQSxDQUM3QkYsT0FBZSxFQUNmQyxZQUEwQixFQUMxQkUsa0JBQXNDLEVBQ2hDO0lBQ04sSUFBSXBFLGFBQWEsQ0FBQ3FFLEdBQUcsQ0FBQ0osT0FBTyxDQUFDLEVBQUU7TUFDOUJLLE9BQU8sQ0FBQ0MsSUFBSSxDQUNWLCtGQUErRk4sT0FBTyxHQUN4RyxDQUFDO0lBQ0g7SUFDQWpFLGFBQWEsQ0FBQ3dFLEdBQUcsQ0FBQ1AsT0FBTyxFQUFFQyxZQUFZLENBQUM7SUFDeENoRSxtQkFBbUIsQ0FBQ3NFLEdBQUcsQ0FBQ1AsT0FBTyxFQUFFRyxrQkFBa0IsQ0FBQztFQUN0RCxDQUFDO0VBT0RLLGlCQUFpQixXQUFqQkEsaUJBQWlCQSxDQUFDQyxNQUFjLEVBQUVULE9BQWUsRUFBRVUsSUFBUyxFQUFRO0lBQ2xFLElBQU1ULFlBQVksR0FBR2xFLGFBQWEsQ0FBQzRFLEdBQUcsQ0FBQ1gsT0FBTyxDQUFDO0lBQy9DLElBQUksQ0FBQ0MsWUFBWSxFQUFFO01BQ2pCSSxPQUFPLENBQUNDLElBQUksQ0FBQyw4QkFBOEJOLE9BQU8sRUFBRSxDQUFDO01BQ3JELElBQUlZLG9DQUEyQixFQUFFO1FBQy9CQSxvQ0FBMkIsQ0FBQ0Msa0JBQWtCLENBQUNKLE1BQU0sQ0FBQztNQUN4RDtNQUNBO0lBQ0Y7SUFDQVIsWUFBWSxDQUFDLENBQUMsQ0FBQ1MsSUFBSSxDQUFDLENBQ2pCSSxJQUFJLENBQUMsWUFBTTtNQUNWLElBQUlGLG9DQUEyQixFQUFFO1FBQy9CQSxvQ0FBMkIsQ0FBQ0Msa0JBQWtCLENBQUNKLE1BQU0sQ0FBQztNQUN4RDtJQUNGLENBQUMsQ0FBQyxDQUNETSxLQUFLLENBQUMsVUFBQUMsTUFBTSxFQUFJO01BQ2ZYLE9BQU8sQ0FBQ1ksS0FBSyxDQUFDRCxNQUFNLENBQUM7TUFFckIsSUFDRUosb0NBQTJCLElBQzNCSSxNQUFNLFlBQVlFLDRCQUFtQixFQUNyQztRQUVBTixvQ0FBMkIsQ0FBQ08sZUFBZSxDQUFDVixNQUFNLENBQUMsQ0FBQ0ssSUFBSSxDQUN0RCxVQUFBTSxXQUFXLEVBQUk7VUFDYixJQUFJLENBQUNBLFdBQVcsRUFBRTtZQUNoQlIsb0NBQTJCLENBQUNDLGtCQUFrQixDQUFDSixNQUFNLENBQUM7VUFDeEQ7UUFDRixDQUNGLENBQUM7TUFDSDtJQUNGLENBQUMsQ0FBQztFQUNOLENBQUM7RUFPRFksa0JBQWtCLFdBQWxCQSxrQkFBa0JBLENBQUNaLE1BQWMsRUFBRVQsT0FBZSxFQUFRO0lBQ3hELElBQU1HLGtCQUFrQixHQUFHbEUsbUJBQW1CLENBQUMwRSxHQUFHLENBQUNYLE9BQU8sQ0FBQztJQUMzRCxJQUFJLENBQUNHLGtCQUFrQixFQUFFO01BQ3ZCLE1BQU0sSUFBSW1CLEtBQUssQ0FBQyx5Q0FBeUN0QixPQUFPLEdBQUcsQ0FBQztJQUN0RTtJQUNBRyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUN4QjtBQUNGLENBQUM7QUFHRDVELFdBQVcsQ0FBQ2MsaUJBQWlCLENBQUMsUUFBUSxFQUFFLFlBQU07RUFDNUMsSUFBSTRCLE9BQU8sSUFBSSxPQUFPc0MsSUFBSSxLQUFLLFdBQVcsRUFBRTtJQUMxQyxPQUFPdEcsT0FBTyxDQUFDLG9DQUFvQyxDQUFDLENBQUN1RyxPQUFPO0VBQzlELENBQUMsTUFBTTtJQUNMLE9BQU8sU0FBU0MsSUFBSUEsQ0FBQSxFQUFHO01BQ3JCLE9BQU8sSUFBSTtJQUNiLENBQUM7RUFDSDtBQUNGLENBQUMsQ0FBQztBQUVGQyxNQUFNLENBQUNDLGNBQWMsR0FBR3BGLFdBQVc7QUFHbkNtRixNQUFNLENBQUNFLGtCQUFrQixHQUFHO0VBQzFCQyxhQUFhLEVBQUV0RixXQUFXLENBQUN3QyxjQUFjO0VBQ3pDYSxlQUFlLEVBQUVyRCxXQUFXLENBQUNxRDtBQUMvQixDQUFDO0FBRUQsSUFBSThCLE1BQU0sQ0FBQ0ksYUFBYSxLQUFLLElBQUksRUFBRTtFQUNqQ3pCLE9BQU8sQ0FBQzBCLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQztBQUMzQyxDQUFDLE1BQU07RUFDTEMsc0JBQWEsQ0FBQ0Msc0JBQXNCLENBQUMsYUFBYSxFQUFFMUYsV0FBVyxDQUFDO0FBQ2xFO0FBRUEyRixNQUFNLENBQUNDLE9BQU8sR0FBRzVGLFdBQVciLCJpZ25vcmVMaXN0IjpbXX0=